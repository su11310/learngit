;24C16以16单元为一组,比如0-15,16-31,32-47,如从中间写入,头上的那个单元容易错,比如从42写入,31单元就出错
;24C16一次读写太多容易出错！！！
;05-07-16
;
;LJJY:967320
;CLER QX:347185
;SET QX:983472
;SET BCMM:907766 设置编程密码
;disp bcmm:9876  查看编程密码
;DISP QX:963
;SR      EQU     p2.5
;RW      EQU     p2.6
;E       EQU     p2.7
JP_READ EQU 02H
jp_sel EQU 05H
PR_SEL EQU 00H

S2CON EQU 9AH
IE2   EQU 0AFH
S2SBUF EQU 9BH
BRT EQU 9CH
IAP_CONTR EQU 0C7H
RELOAD_COUNT EQU 0FBH
auxr  EQU 8EH
auxr1 equ 0a2h
      P4 EQU 0c0H
LED_QD EQU P4.1
;P2.1-启动灯
        P0M1 EQU 93H
        P0M0 EQU 94H
        BUS_SPEED EQU 0A1H
        CLK_DIV EQU 97H
C12887_CS_ADDRESS EQU 14D         ;参数1
C12887_DJ_ADDRESS EQU 56D         ;单价
C12887_RLJ_ADDRESS EQU 68D          ;日累计
C12887_ZLJ_ADDRESS EQU 98D          ;总累计
C12887_QX_ADDRESS EQU 104D           ;期限
C12887_JSDY_ADDRESS EQU 107D      ;计数单元1
C12887_ZHJLZ_ADDRESS EQU 111D     ;最后计量值
C12887_KGL_ADDRESS EQU 115D       ;公斤/升
C12887_QXSET1_ADDRESS EQU 116D
C12887_QXSET2_ADDRESS EQU 117D
;第1扇区：2000H-21FFH 当量                         :
;第2扇区：2200H-23FFH 密度
;第3扇区：2400H-25FFH 余量
;第4扇区：2600H-27FFH 调速
;第5扇区：2800H-29FFH 预置值
;第6扇区：2a00H-2bFFH 累计、 计数单元
;第7扇区：2c00H-2dFFH 限期
;第8扇区：2e00H-2fFFH 公斤、升标志
ISP_DATA EQU 0C2H
ISP_ADDRH EQU 0C3H
ISP_ADDRL EQU 0C4H
ISP_CMD EQU 0C5H
ISP_TRIG EQU 0C6H
ISP_CONTR EQU 0C7H
ENABLE_ISP   EQU 81H
ISP_IAP_BYTE_PROGRAM  EQU  2H
ISP_IAP_BYTE_READ   EQU 1H
ISP_IAP_SECTOR_ERASE EQU 3H

DATA_FLASH_START_ADDRESS EQU 0000H
FLASH_CS1_ADDRESS EQU 0200H         ;参数1
FLASH_CS2_ADDRESS EQU 0400H         ;参数2
FLASH_QX_ADDRESS EQU 0600H          ;期限
FLASH_LJ_ADDRESS EQU 0800H          ;累计
FLASH_LUHAO_ADDRESS EQU 0a00H     ;路号
FLASH_DD_ADDRESS  EQU 0C000H       ;掉电标志
FLASH_YDWD_ADDRESS EQU 0E00H    ;已打未打
FLASH_BCMM_ADDRESS EQU 1000H    ;编程密码
FLASH_DCJL_ADDRESS EQU 1200H    ;单次计量
FLASH_DJ1_ADDRESS EQU 1400H      ;单价1
FLASH_DJ2_ADDRESS EQU 1600H      ;单价2
FLASH_FLJ1_ADDRESS EQU 1800H     ;分累计1
FLASH_FLJ2_ADDRESS EQU 1A00H     ;分累计2
FLASH_JSDY1_ADDRESS EQU 1C00H      ;计数单元1
FLASH_JSDY2_ADDRESS EQU 1e00H      ;计数单元2
FLASH_ZHJLZ1_ADDRESS EQU 2000H     ;最后计量值
FLASH_ZHJLZ2_ADDRESS EQU 2200H     ;最后计量值
FLASH_ZJE_ADDRESS EQU 2400H      ;总金额
FLASH_ZJL_ADDRESS EQU 2600H      ;总计量
FLASH_ZLJ1_ADDRESS EQU 2800H      ;总累计
FLASH_ZLJ2_ADDRESS EQU 2800H      ;总累计
FLASH_KGL_ADDRESS EQU 2A00H       ;公斤/升
JDQ_1 EQU P1.0
JDQ_2 EQU P1.1
IN_YK EQU P1.4
RTC_E EQU P2.3
AS      EQU     P2.4
SEL_1OR2 EQU P4.2
;#0ACH:存1路或2路标志  #3EH为2路
;//////////////////////////液晶脚定义
;sclk    EQU P2.7
;sid     EQU P2.6
;////////////////////////// 后备电源开、关电池和电压检测脚定义
;kj equ p2.5
;gj EQU P2.7
;CHECK_POWER EQU P2.6
;//////////////////////////
;CS      EQU     P1.7
;SK      EQU     P1.5
;DI      EQU     P1.6
;DO      EQU     P2.0
;HIBYTE  EQU     2Eh
;LOWBYTE EQU     2Fh
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;打印管脚
PR10 EQU P1.4
PR11 EQU P1.5
PR12 EQU P1.6
PR13 EQU P1.7
BUSY EQU P2.7
STB EQU P2.6

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;


COM     EQU     26H
DAT     EQU     27H
TIME_ADDR EQU 19H
TIME_DATA EQU 1AH
AUAX EQU  8EH
;           VI2C_SDA	   EQU         P2.2 ;数据线
;           VI2C_SCL	   EQU	       P2.1 ;时钟线
T_RST Bit P4.0 ;实时时钟复位线引脚
T_CLK Bit P2.0 ;实时时钟时钟线引脚
T_IO Bit P1.5 ;实时时钟数据线引脚
 ;         VI2C_SDA	   EQU         p2.1;P1.6;数据线
  ;         VI2C_SCL	   EQU	       P1.5;时钟线
          VI2C_SDA	   EQU         p1.3;P1.6;数据线
           VI2C_SCL	   EQU	       P1.2;时钟线
;           ;变量定义
           EE240X_AD  	  DATA        2EH  ;存放器件的三位可编程地址或页地址(0-7)
           EE240X_SUBA    DATA        2FH  ;存放片内寻址字节
           EE240X_NUMBYT  DATA        03H  ;存放传送的字节数
           EE240X_TDA     DATA        72H  ;存放发送数据缓冲区首地址
           EE240X_RDA     DATA        73H  ;存放接收数据缓冲区首地址
           DELAYMS_NUM    DATA        07H  ;存放延时的毫秒数
;24c16:第1页：01-03H：存期限  10H：存设定路号（1 OR 2）6DH为1路，39H为2路； 50H-5BH为各路单价
;24c16:第2页：0-41h,存参数;42H-存掉电后计量值
;0DAH,0DBH,0DCH:大小流暂存
	ORG 0000H
	LJMP MN         ;主程序跳转
	ORG 0003H
;
        LJMP AIN1
	ORG 000BH
	LJMP TMI0       ;计量
	ORG 0013H
        LJMP PINT       ;掉电停止
;	LJMP AIN1       ;停止
;       ORG 001BH
;        LJMP TMI1
	ORG 001FH
	LJMP DC6;SWC        ;参数
	ORG 0022H
;        LJMP BGKG
	LJMP DC5;XDATD ;
	ORG 0025H
	LJMP DC4;BGKG;ENTER	;OFN
	ORG 0028H
	LJMP XDATE;PTOL       ;累计
	ORG 002BH
	LJMP PPD;PAP1       ;走纸
	ORG 002EH
	LJMP DC3;ZH;DC4        ;打印
	ORG 0031H
	LJMP DC2;DC6        ;6#
	ORG 0034H
	LJMP DC1;TDIS       ;温度
	ORG 0037H
	LJMP DC5;DATE       ;日期
	ORG 003AH
        ljmp cler       ;清除
	ORG 004FH
LJMP D6;	LJMP SWC
	ORG 0052H
LJMP D5;	LJMP CLER;DATE_TIME         ;密度
	ORG 0055H
LJMP D4;	LJMP ENTER;DATE_EDIT         ;当量
	ORG 0058H
LJMP DATE_EDIT;	LJMP cler;D6;TIME_EDIT         ;余量
	ORG 005BH
	LJMP PPD        ;小数点
	ORG 005EH
LJMP D3;	LJMP ZHERR;       LJMP D4		;；4#
	ORG 0061H
LJMP D2;	LJMP D6         ;QD
	ORG 0064H
LJMP D1;	LJMP D4	;LJMP VD
	ORG 006AH
	LJMP CLER       ;清除
;	ORG 006DH
;	LJMP CP         ;定量（编程）
;	ORG 0070H
;	LJMP D1         ;1＃
;	ORG 0073H
;	LJMP D2         ;2＃
;	ORG 0076H
;	LJMP D3         ;3＃
        ORG 008CH
        LJMP XC        ; 传送带
        ORG 008FH
        LJMP OFN
        ORG 0092H
        LJMP SWC;ZH
        ORG 0095H
        LJMP DPR;ENTER
        ORG 0098H
        LJMP ZHUANHUAN  ;1、2路转换

;LJMP BGKG;        LJMP PAP1      ;     走纸键
        ORG 009BH
        LJMP TDIS;DPR ;     确认
        ORG 009EH
        LJMP PTOL;
        ORG 00A1H
      LJMP XTIME;
ORG 00BFH
LJMP CP
ORG 00C2H
LJMP SWC
ORG 00C5H
LJMP DJ  ;单价
ORG 00C8H
LJMP LD  ;余量
ORG 00CBH
LJMP VD
ORG 00CEH
LJMP QD
ORG 00D1H
LJMP TIME_EDIT
	ORG 00E0H
;TMI1:PUSH PSW
;    PUSH 0E0H
;     PUSH 00H
;     PUSH 01H
;     CLR EX1
;     CLR ET0
;     CLR ET1
;     CLR TR1
;TMI10:DJNZ JS_COUNT,TMI11
;      SETB P1.4
;      CLR 04H
;      MOV A,5CH
;      ADD A,#01H
;      DA A
;      MOV 5CH,A
;      CJNE A,5DH,TIM12
;      CLR 0CH
;	CLR 0DH
;TIM12:NOP
;;      SETB 1CH	;无信号，停机
;      POP 01H
;      POP 00H
;      POP 0E0H
;      POP PSW
;      RETI
;TMI11:MOV TH1,#0H
;      MOV TL1,#0H
;      SETB EX1
;      SETB ET0
;     SETB ET1
;      SETB TR1
;      POP 01H
;      POP 00H
;      POP 0E0H
;      POP PSW
;      RETI
;DISPSET:MOV     COM,#30H           ;功能设置---8BIT控制界面，基本指令集
 ;       ACALL   WRI           ;调用写指令子程序
;        LCALL   DELADY              ;延迟39uS
;        MOV     COM,#0CH           ;显示打开，光标关，反白显示关
;        ACALL WRI         ;调用写指令子程序
;        LCALL   DELADY              ;延迟39uS
;        MOV  COM,#01H           ;清除屏幕显示，将DDRAM的地址计数器归零
;        ACALL   WRI                ;调用写指令子程序
;        LCALL   DELADY              ;延迟39uS
;	   MOV COM,#06H           ;DDRAM的地址计数器（AC）加1
;        ACALL   WRI           ;调用写指令子程序
;        LCALL   DELADY              ;延迟39uS
;	   RET
;DISBW0:ACALL WRI
;MOV A,@R1		;显示半位
;	ANL A,#0FH		;入口:r1-显示字符首址;COM:显示位置
;	ADD A,#30H
;	MOV DAT,A
;	ACALL WRD
;	RET

;DISNW0: CLR 21H
;	ACALL   WRI
;DIS6W1:	MOV A,@R1		;显示R2*2位
;	ANL A,#0F0H		;入口:r1-显示字符首址;r2-字符个数（*2）;COM:显示位置
;	SWAP A
;	JB 21H,DIS6W4
;	JZ DIS6W2
;DIS6W4:	ADD A,#30H
;	SETB 21H
;	AJMP DIS6W3
;DIS6W2:	ADD A,#20H
;DIS6W3:	MOV DAT,A
;	ACALL WRD
;	MOV A,@R1
;	ANL A,#0FH
;	JB 21H,DIS6W5
;	JZ DIS6W6
;DIS6W5:	ADD A,#30H
;	SETB 21H
;	AJMP DIS6W7
;DIS6W6:	MOV B,A
;MOV A,R2
;XRL A,#1
;JZ DIS6WZ
;MOV A,B
;ADD A,#20H
;AJMP DIS6W7
;DIS6WZ:MOV A,B
;       ADD A,#30H
;DIS6W7:	MOV DAT,A
;	ACALL WRD
;	INC R1
;	DJNZ R2,DIS6W1
;	MOV DAT,#20H
;	ACALL WRD
;	CLR 21H
;	RET

;DISBW:MOV R1,#0B4H	;显示字符首址
;	MOV COM,#9CH	;显示位置
;	ACALL DISBW0
;	RET
;DIS4W:MOV R1,#0B1H	;显示字符首址
;	MOV R2,#2		;字符个数（*2）
;	MOV COM,#8BH	;显示位置
;	ACALL DISNW0
;	RET
;DI6WM:MOV R1,#32H;0B1H	;显示字符首址
;	MOV R2,#3		;字符个数（*2）
;	MOV COM,#93H	;显示位置
;	ACALL DISNW0
;	RET
;DIS6W:MOV R1,#0B1H	;显示字符首址
;	MOV R2,#3		;字符个数（*2）
;	MOV COM,#8bH	;显示位置
;	ACALL DISNW0
;	RET

;DGCSL:MOV R1,#36H
;MOV COM,#93H
;MOV R2,#8
;LCALL DGCS
;RET

;DGCSL2:MOV R1,#36H
;MOV COM,#93H
;MOV R2,#8
;LCALL DGCS
;RET
DISP_SMG:LCALL SEND_LG8012
RET
;DISPNUM:JNB 02H,ZCZT	;；正常状态
;	JB 25H,DGCSL	;25H=1，改密度
;	JB 26H,DGCSL	;当量
;	JB 27H,DGCSL2	;余量
;	JB 2EH,DIS6W	;日期
;	JB 2FH,DIS4W	;时间
;	JB 28H,DISBW	;时间
;	JB 29H,DGCSL2          ;DGCYS	;延时
;	JB 2DH,DISBW	;打印设置
;	JB 2BH,DISBW	;修改参数
;;	JB 10H,DGCSL	;打脉冲
; ;       JB 2AH,DIS6W    ;DGCSL	;打脉冲
;        JB 2AH,DI6WM    ;DGCSL	;打脉冲
;	JB 24H,DISBW	;24H=1，菜单选择14
;	JB 23H,DIS6W	;按过转换键，显示输入密码
;ZCZT:	JB 2CH,DIS6W	;按过累计键，该输密码
;	JNB 22H,DIS6	;22H=1 按过定量键，该输桶数
;	MOV COM,#8EH	;输入的桶数显示位置
;	AJMP DIS60
;DGCYS:MOV COM,#93H
;DIS60:	ACALL WRI
;	MOV R1,#0B0h
 ;       LCALL DIS5T
  ;      RET

;DIS6:LJMP DISP_LED          ;不在液晶上显示
;MOV     R2,#8        ;字符个数
;     MOV     R1,#31H
;     MOV     COM,#92H      ;DD RAM 地址
;     ACALL   WRI
;	MOV DAT,#3AH	;显示“：”
;	ACALL WRD
;	CLR 21H
;DISPA:MOV A,@R1
;	ANL A,#0F0H
;	SWAP A
;	JB 21H,DIS0
;	JZ DIS00
;	SETB 21H	;21H=1，有不为零的数
;DIS0:ADD A,#30H
;	AJMP DIS1
;DIS00:ADD A,#20H
;DIS1: MOV DAT,A
 ;       ACALL   WRD           ;写入第二字节数据
;	DEC R2
;	MOV A,R2
;	XRL A,#1	;判断是否到达个位
;	JNZ DIS4
;	MOV A,@R1
;	ANL A,#0FH
;	AJMP DIS2
;DIS4:	MOV A,@R1
;	ANL A,#0FH
;	JB 21H ,DIS2
;	JZ DIS03
;	SETB 21H
;DIS2:ADD A,#30H	;显示数字
;	AJMP DIS3
;DIS03:ADD A,#20H	;为零，显示空位
;DIS3:MOV DAT,A
;	ACALL WRD
 ;       INC     R1
;        DJNZ    R2,DISPA
;	MOV DAT,#2EH		;显示小数点
;	ACALL WRD
;DIS5:	MOV A,@r1		;显示末位或单独单元
;	ANL A,#0F0H
;	SWAP A
;	ADD A,#30H
;	MOV DAT,A
;	ACALL WRD
;	MOV A,@r1
;	ANL A,#0FH
;	ADD A,#30H
;	MOV DAT,A
;	ACALL WRD
;	CLR 21H
;DISP_LED:
;LCALL SEND_LG8012
;MOV R0,#0ACH  ;选1路还是2路
;MOV A,@R0
;XRL A,#39H
;JNZ LH01
;MOV COM,#98H
;lcall wri
;MOV R1,#0
;     MOV R2,#6
 ;    MOV DPTR,#XLH2
  ;   LCALL SDZF
   ;  LJMP XLH_OVE
;LH01:MOV COM,#98H
;lcall wri
;MOV R1,#0
 ;    MOV R2,#6
  ;   MOV DPTR,#XLH1
   ;  LCALL SDZF
;XLH_OVE:JNB 18H,PR_LINE
;MOV COM,#9CH
;lcall wri
;MOV R1,#0
 ;    MOV R2,#8
  ;   MOV DPTR,#PR_CLOSE
   ;  LCALL SDZF
;LJMP PRCHE_OVER
;PR_LINE:MOV COM,#9CH
;lcall wri
;MOV R1,#0
 ;    MOV R2,#8
  ;   MOV DPTR,#PR_OPEN
   ;  LCALL SDZF

PRCHE_OVER:RET

;DIS5T:LJMP DISP_TS_LED        ;不在液晶上显示
;	MOV A,@r1		;显示末位或单独单元
;	ANL A,#0F0H
;	SWAP A
;	ADD A,#30H
;	MOV DAT,A
;	ACALL WRD
;	MOV A,@r1
;	ANL A,#0FH
;	ADD A,#30H
;	MOV DAT,A
;	ACALL WRD
;	CLR 21H
;DISP_TS_LED:mov r0,#0b0h
;LCALL SEND_TS
;        RET
DISH:   JC DH2
	MOV A,@R0
	ANL A,#0F0H
	JZ DH1
	SETB C
	RET
DH1:    MOV A,@R0
	ORL A,#0F0H
	MOV @R0,A
	CLR C
DH2:    RET
DISL:   JC DL2
	MOV A,@R0
	ANL A,#0FH
	JZ DL1
	SETB C
	RET
DL1:    MOV @R0,#0FFH
	CLR C
	INC R0
DL2:    RET

SEND_LG8012:MOV A,#097H
CLR TI
MOV SBUF,A
JNB TI,$
CLR TI
NOP
NOP
NOP
MOV A,#0ADH
CLR TI
MOV SBUF,A
JNB TI,$
CLR TI
NOP
NOP
NOP
MOV A,#01H      ;命令
CLR TI
MOV SBUF,A
JNB TI,$
CLR TI
NOP
NOP
NOP
MOV R0,#34H
DY2:MOV A,@R0
MOV SBUF,A
JNB TI,$
CLR TI
NOP
NOP
NOP
DEC R0
MOV A,#30H
XRL A,R0
JNZ DY2
MOV A,10H
MOV SBUF,A
JNB TI,$
CLR TI
jb 02h,QQ80
LCALL TD
MOV R0,#0CH
MOV A,@R0
MOV SBUF,A
JNB TI,$
CLR TI
NOP
NOP
NOP
INC R0
MOV A,@R0      ;命令
CLR TI
MOV SBUF,A
JNB TI,$
CLR TI
NOP
INC R0
MOV A,@R0      ;命令
CLR TI
MOV SBUF,A
JNB TI,$
CLR TI
NOP
INC R0
MOV A,@R0      ;命令
CLR TI
MOV SBUF,A
JNB TI,$
CLR TI
NOP
CLR C
MOV A,#01H
ADD A,34H
ADD A,33H
ADD A,32H
ADD A,31H
ADD A,0cH
ADD A,0DH
ADD A,0EH
ADD A,0FH
ADD A,10H
MOV SBUF,A
JNB TI,$
CLR TI
ljmp Q80
QQ80:;MOV R0,#0CH
MOV A,#0
MOV SBUF,A
JNB TI,$
CLR TI
NOP
NOP
NOP

MOV A,#0      ;命令
CLR TI
MOV SBUF,A
JNB TI,$
CLR TI
NOP
MOV A,#0      ;命令
CLR TI
MOV SBUF,A
JNB TI,$
CLR TI
NOP
MOV A,#0      ;命令
CLR TI
MOV SBUF,A
JNB TI,$
CLR TI
NOP
CLR C
MOV A,#01H
ADD A,34H
ADD A,33H
ADD A,32H
ADD A,31H
ADD A,#0H
ADD A,#0H
ADD A,#0H
ADD A,#0H
ADD A,10H
MOV SBUF,A
JNB TI,$
CLR TI
Q80:	RET
SEND_TS:MOV A,#097H
CLR TI
MOV SBUF,A
JNB TI,$
CLR TI
NOP
NOP
NOP
MOV A,#0ADH
CLR TI
MOV SBUF,A
JNB TI,$
CLR TI
NOP
NOP
NOP
MOV A,#02H      ;命令
CLR TI
MOV SBUF,A
JNB TI,$
CLR TI
NOP
NOP
NOP
;MOV R0,#0B0H
MOV A,@R0
MOV SBUF,A
JNB TI,$
CLR TI
NOP
NOP
NOP
MOV A,#0H      ;命令
CLR TI
MOV SBUF,A
JNB TI,$
CLR TI
NOP
;MOV A,#0H      ;命令
;CLR TI
;MOV SBUF,A
;JNB TI,$
;CLR TI
;NOP
MOV A,#0H      ;命令
CLR TI
MOV SBUF,A
JNB TI,$
CLR TI
NOP
MOV A,#0H      ;命令
CLR TI
MOV SBUF,A
JNB TI,$
CLR TI
NOP

MOV A,10H
MOV SBUF,A
JNB TI,$
CLR TI
CLR C
;MOV R0,#0B0H
MOV A,@R0
ADD A,#02H
ADD A,10H
MOV SBUF,A
JNB TI,$
CLR TI
	RET

SEND_WD:CLR 09H
LCALL TD
MOV A,#097H
CLR TI
MOV SBUF,A
JNB TI,$
CLR TI
NOP
NOP
NOP
MOV A,#0ADH
CLR TI
MOV SBUF,A
JNB TI,$
CLR TI
NOP
NOP
NOP
MOV A,#05H      ;命令
CLR TI
MOV SBUF,A
JNB TI,$
CLR TI
NOP
NOP
NOP
MOV R0,#0CH
MOV A,@R0
MOV SBUF,A
JNB TI,$
CLR TI
NOP
NOP
NOP
INC R0
MOV A,@R0      ;命令
CLR TI
MOV SBUF,A
JNB TI,$
CLR TI
NOP
INC R0
MOV A,@R0      ;命令
CLR TI
MOV SBUF,A
JNB TI,$
CLR TI
NOP
INC R0
MOV A,@R0      ;命令
CLR TI
MOV SBUF,A
JNB TI,$
CLR TI
NOP
MOV A,10H
MOV SBUF,A
JNB TI,$
CLR TI
CLR C
MOV A,0CH
ADD A,#05H
ADD A,10H
ADD A,0DH
ADD A,0EH
ADD A,0FH
MOV SBUF,A
JNB TI,$
CLR TI
	RET
SEND_KGL:MOV A,#097H
CLR TI
MOV SBUF,A
JNB TI,$
CLR TI
NOP
NOP
NOP
MOV A,#0ADH
CLR TI
MOV SBUF,A
JNB TI,$
CLR TI
NOP
NOP
NOP
MOV A,#16H      ;命令
CLR TI
MOV SBUF,A
JNB TI,$
CLR TI
NOP
NOP
NOP
MOV A,72H
MOV SBUF,A
JNB TI,$
CLR TI
NOP
NOP
NOP
MOV A,#0H      ;命令
CLR TI
MOV SBUF,A
JNB TI,$
CLR TI
NOP
MOV A,#0H      ;命令
CLR TI
MOV SBUF,A
JNB TI,$
CLR TI
NOP
MOV A,#0H      ;命令
CLR TI
MOV SBUF,A
JNB TI,$
CLR TI
NOP

MOV A,10H
MOV SBUF,A
JNB TI,$
CLR TI
MOV A,#0H      ;命令
CLR TI
MOV SBUF,A
JNB TI,$
CLR TI
NOP
MOV A,#0H      ;命令
CLR TI
MOV SBUF,A
JNB TI,$
CLR TI
NOP
MOV A,#0H      ;命令
CLR TI
MOV SBUF,A
JNB TI,$
CLR TI
NOP
MOV A,#0H      ;命令
CLR TI
MOV SBUF,A
JNB TI,$
CLR TI
NOP
CLR C
MOV A,72H
ADD A,#16H
ADD A,10H
MOV SBUF,A
JNB TI,$
CLR TI
	RET
SEND_PR:MOV A,#097H
CLR TI
MOV SBUF,A
JNB TI,$
CLR TI
NOP
NOP
NOP
MOV A,#0ADH
CLR TI
MOV SBUF,A
JNB TI,$
CLR TI
NOP
NOP
NOP
MOV A,#07H      ;命令
CLR TI
MOV SBUF,A
JNB TI,$
CLR TI
NOP
NOP
NOP
MOV A,72H
MOV SBUF,A
JNB TI,$
CLR TI
NOP
NOP
NOP
MOV A,#0H      ;命令
CLR TI
MOV SBUF,A
JNB TI,$
CLR TI
NOP
MOV A,#0H      ;命令
CLR TI
MOV SBUF,A
JNB TI,$
CLR TI
NOP
MOV A,#0H      ;命令
CLR TI
MOV SBUF,A
JNB TI,$
CLR TI
NOP

MOV A,10H
MOV SBUF,A
JNB TI,$
CLR TI
MOV A,#0H      ;命令
CLR TI
MOV SBUF,A
JNB TI,$
CLR TI
NOP
MOV A,#0H      ;命令
CLR TI
MOV SBUF,A
JNB TI,$
CLR TI
NOP
MOV A,#0H      ;命令
CLR TI
MOV SBUF,A
JNB TI,$
CLR TI
NOP
MOV A,#0H      ;命令
CLR TI
MOV SBUF,A
JNB TI,$
CLR TI
NOP

CLR C
MOV A,72H
ADD A,#07H
ADD A,10H
MOV SBUF,A
JNB TI,$
CLR TI
	RET

;DG8W:MOV A,R2
;RR A
;MOV R2,A
;	LCALL DISNW0
;	RET

;DGCS:MOV A,10H
;	JZ DG8W
;	CLR 20H
;	ACALL   WRI
;DGCS1:	MOV A,@R1		;
;	ANL A,#0F0H		;入口:r1-显示字符首址;r2-字符个数（*2）;COM:显示位置
;	SWAP A
;	JB 20H,DGCS00
;	JZ DGCS03
;	SETB 20H		;26H=1，有不为零的数
;DGCS00:ADD A,#30H	;有不为零的数，显示
;	AJMP DG04
;DGCS03:	MOV B,A	;数为零，判断是否在小数点前，是：显示零；否：不显示
;	MOV A,10H
;	XRL A,R2
;	JNZ DG05
;	MOV A,B
;	ADD A,#30H
;	AJMP DG04
;DG05:MOV A,B
;	ADD A,#20H
;DG04:MOV DAT,A
;	ACALL WRD
;	MOV A,10H		;到小数点位，显示，不到，显示低位
;	XRL A,R2
;	JNZ DGCS2
;	MOV DAT,#2EH		;显示小数点
;	ACALL WRD
;setb 20h
;DGCS2:DEC R2		;低位显示
;	MOV A,@R1
;	ANL A,#0FH
;	JB 20H,DG06	;有不为零的数，转显示
;	JZ DGCS01		;为零，转判断
;	SETB 20H	;26H=1，有不为零的数
;DG06:	ADD A,#30H
;	AJMP DG07
;DGCS01:	MOV B,A	;为零判断
;	MOV A,10H		;判断是否在小数点前，是：显示零；否：不显示
;	XRL A,R2
;	JNZ DG08
;	MOV A,B
;	ADD A,#30H
;	AJMP DG07
;DG08:MOV A,B
;	ADD A,#20H
;DG07:MOV DAT,A
;	ACALL WRD
;	MOV A,10H		;到小数点位，显示，不到，显示低位
;	XRL A,R2
;	JNZ DGCS3
;	MOV DAT,#2EH		;显示小数点
;	ACALL WRD
;setb 20h
;DGCS3:INC R1
;	DEC R2
;	MOV A,R2
;	JNZ DGCS1
;	CLR 20H
;	MOV DAT,#20H	;打2空位
;	ACALL WRD
;	ACALL WRD
;	RET

;HZBXS:  MOV R7,#00H	;入口：DPTR-表地址
 ;       MOV R4,#00H
  ;      MOV A,#00H
   ;     MOVC A,@A+DPTR
    ;    MOV R6,A
;LNUM:   CJNE R6,#4,LINE3
;	MOV     COM,#80H      ;DD RAM 地址-----0000000
;	AJMP LAD
;	LINE3:CJNE R6,#3,LINE2
;	MOV COM,#90H
;	AJMP LAD
;	LINE2:CJNE R6,#2,LINE1
;	MOV COM,#88H
;	AJMP LAD
;	LINE1:MOV COM,#98H
;	LAD:NOP
;	ACALL   WRI
;	INC R7
 ;       MOV A,R7
  ;      MOVC A,@a+dptr
   ;     mov r5,a
;LCOD:   INC R7
 ;       MOV A,R7
  ;      MOVC A,@A+DPTR
;MOV DAT,A
;ACALL WRD
;NEXT:   DJNZ R5,LCOD
 ;       DJNZ R6,LNUM
  ;      RET

;WRI:	call check
;	setb cs
;	mov a,#0f8h
;	call SdDat
;	mov a,COM;r7
;	anl a,#0f0h
;	call SdDat
;	mov a,COM;r7
;	swap a
;	anl a,#0f0h
;	call SdDat
;	clr cs
;nop
;nop
;nop
;nop
;	ret
;-------------------------------
;WRD:	call check
;	setb cs
;	mov a,#0fah
;	call SdDat
;	mov a,DAT;r7
;	anl a,#0f0h
;	call SdDat

;	mov a,DAT;r7
;	swap a
;	anl a,#0f0h
;	call SdDat

;	clr cs
;nop
;nop
;nop
;nop
;	ret
;-------------------------------
;Check:
;	setb cs
;	mov a,#0fch
;	call SdDat
 ;
;	call ReDat
;	push acc
;	call Redat
;	clr cs
;	pop acc
 ;
;	jb acc.7,check
;	ret
;-----------------------------
;SdDat:
;	mov r3,#8
;sd_lp:
;	rlc a
;	mov sid,c
;	setb sclk
;	nop
;nop
;nop
;	clr sclk
;	nop
;nop
;nop
;	djnz r3,sd_lp
;	ret
;---------------------------
;ReDat:
;	mov r3,#8
;rd_lp:
;	setb sclk
;	mov c,sid
;	clr sclk
;nop
;nop
;nop
;	rlc a
;	djnz r3,rd_lp
;	ret
;--------------------------
;delayms:
 ;   mov r3,#185
;dl:
 ;   nop
  ;  nop
   ; nop
    ;djnz r3,dl
;    djnz r4,delayms
 ;   ret

;WRI:    PUSH    ACC
;        CLR     SR
;        SETB    RW
;WRI1:   ;MOV     P0,#0FFH
  ;      SETB    E
  ;      MOV     A,P0
  ;      CLR     E
  ;      JB      ACC.7,WRI1
;        CLR     RW
;        MOV     P0,COM
;        SETB    E
;        CLR     E
;        POP     ACC
;        RET

;******************************************以上是写指令子程序

;WRD:    PUSH    ACC
;        CLR     SR
;        SETB    RW
;WRD1: ;  MOV     P0,#0FFH
       ; SETB    E
       ; MOV     A,P0
       ; CLR     E
       ; JB      ACC.7,WRD1
;        SETB    SR
 ;       CLR     RW
;        MOV     P0,DAT
  ;      SETB    E
;        CLR     E
 ;       POP     ACC
  ;      RET
;DISPT:    ACALL   WRI
;DIST1:	MOV A,@R1		;显示R2*2位
;	ANL A,#0F0H		;入口:r1-显示字符首址;r2-字符个数（*2）;COM:显示位置
;	SWAP A			;R3：间隔符个数
;	ADD A,#30H
;	MOV DAT,A
;	ACALL WRD
;	MOV A,@R1
;	ANL A,#0FH
;	ADD A,#30H
;	MOV DAT,A
;	ACALL WRD
;	INC R1
;MOV A,R3
;JZ DIST2
;MOV DAT,1AH	;1AH：间隔符
;ACALL WRD
;DEC R3
;DIST2:NOP
;	DJNZ R2,DIST1
;	RET

cle:ljmp cler
XDATE:;jb 2ch,cle
;LCALL DISPSET
;MOV DPTR,#TIWD
;LCALL ZBXS
;xdatd1:LCALL TD

;lcall timl6
XDAC:ACALL DISDATE
;lcall timl6
;lcall timl6
;lcall timl6
;MOV 31H,#0
;MOV 32H,#0
;MOV 33H,#0
;MOV 34H,#0
;MOV 35H,#0
;	MOV DPTR,#MAIN_B;#BXS
;	LCALL HZBXS
CLR 0FH
LJMP MN0
XTIME:;jb 2ch,cle
;LCALL DISPSET
;MOV DPTR,#TIWD
;LCALL ZBXS
;xdatd1:LCALL TD
;lCALL TIML6
;lCALL TIML6
lCALL TIML6
lCALL TIML6
XTIM:ACALL DISTIME
;JnB CHECK_POWER,XPASS
;lcall timl6
;lcall timl6
;JnB CHECK_POWER,XPASS
;lcall timl6
;lcall timl6
;JnB CHECK_POWER,XPASS
;LCALL SON
;LCALL TIML6
;LCALL TIML6
;LCALL SON
;LCALL TIML6
;LCALL TIML6
;LCALL SON
;LCALL TIML6
;LCALL TIML6
;CLR GJ;关掉电池继电器
;setb kj;

;XPASS:MOV A,#08H		;时间键
;MOV R0,#02H		;键盘地址02H
;MOVX @R0,A
;lCALL TIML
;MOV R0,#02H
;MOVX A,@R0
;CJNE A,#01H, XTIM
;lCALL TIML6
;lCALL TIML6
;MOV 31H,#0
;MOV 32H,#0
;MOV 33H,#0
;MOV 34H,#0
;CLR 0FH

lCALL TIML6
lCALL TIML6
;MOV 35H,#0
;	MOV DPTR,#MAIN_B;#BXS
;	LCALL HZBXS
LJMP MN0
DISDATE:  MOV R0,#34H
lcall GET1302_RQ

MOV 31H,#20H
;LCALL DISP_SMG
RET

DISTIME:; SETB 1DH
;MOV TIME_ADDR,#7
 ;       LCALL RTC_READ
  ;      MOV A,TIME_DATA
;	MOV 34H,A
;	MOV TIME_ADDR,#8
 ;       LCALL RTC_READ
  ;      MOV A,TIME_DATA
;	MOV 33H,A
;	MOV TIME_ADDR,#9
 ;       LCALL RTC_READ
  ;      MOV A,TIME_DATA
;	MOV 32H,A
;MOV COM,#8BH
;MOV R1,#32H
;MOV R2,#3
;MOV R3,#2
;MOV 1AH,#2DH
;LCALL DISPT
        MOV R0,#34H
LCALL GET1302_SJ
;MOV COM,#9BH
;MOV R1,#32H
;MOV R2,#3
;MOV R3,#2
;MOV 1AH,#3AH
;LCALL DISPT
MOV 31H,#0FFH
LCALL DISP_SMG
RET

;DISTD:    ACALL   WRI   ;显示温度：入口-33h,34h,35h
 ;       JNB 09H,DISTDA0
  ;    MOV DAT,#2DH
   ;   ACALL WRD
;DISTDA0:CLR 21H
;DISTDA:MOV A,@R1
;	ANL A,#0F0H
;	SWAP A
;	JB 21H,DISTD0
;	JZ DISTD00
;	SETB 21H	;21H=1，有不为零的数
;DISTD0:ADD A,#30H
;	AJMP DISTD1
;DISTD00:ADD A,#20H
;DISTD1: MOV DAT,A
;        ACALL   WRD           ;写入第二字节数据
;	DEC R2
;	MOV A,R2
;	XRL A,#1	;判断是否到达个位
;	JNZ DISTD4
;	MOV A,@R1
;	ANL A,#0FH
;	AJMP DISTD2
;DISTD4:	MOV A,@R1
;	ANL A,#0FH
;	JB 21H ,DISTD2
;	JZ DISTD03
;	SETB 21H
;DISTD2:ADD A,#30H	;显示数字
;	AJMP DISTD3
;DISTD03:ADD A,#20H	;为零，显示空位
;DISTD3:MOV DAT,A
;	ACALL WRD
 ;       INC     R1
;        DJNZ    R2,DISTDA
;	MOV DAT,#2EH		;显示小数点
;	ACALL WRD
;DISTD5:	MOV A,@r1		;显示末位或单独单元
;	ANL A,#0F0H
;	SWAP A
;	ADD A,#30H
;	MOV DAT,A
;	ACALL WRD
;	MOV A,@r1
;	ANL A,#0FH
;	ADD A,#30H
;	MOV DAT,A
;	ACALL WRD
;	CLR 21H
;	RET

GL0:   	MOV R0,#08h;4H
	MOV R4,#00H
GL1:    MOV R2,#08H
	MOV R1,#02H
	MOV A,R0
	MOVX @R1,A
        LCALL TIML
       MOVX A,@R1
        MOV B,A
lcall timl0
lcall timl0
        MOVX A,@R1
        MOV R7,A             ;R7为键盘值暂存
        XRL A,B              ;比较是否相同
        JNZ GK1
        MOV A,R7
	MOV R3,A
GL6:    MOV A,R3
INC R4
INC R4
INC R4
	RLC A
	MOV R3,A
	JC GL2
DEC R2
MOV A,R2
JNZ GL6
GL2: SETB 01H
CLR 00H
MOV A,R4
ADD A,#79H
MOV R4,A
;MOV 1CH,R4
;LCALL DISP
LCALL TIML6
LCALL TIML6
LCALL TIML6
LCALL TIML6
LCALL TIML6
LCALL TIML6
LCALL TIML6
LCALL TIML6
RET

GL0L:LJMP GL0

CKB:    JB 08H,GK1              ;键盘扫描
	SETB 00H
	AJMP CK
CT3:    SETB 08H
	RET
GK:     MOV A,#08H
	MOV R0,#jp_sel
	MOVX @R0,A
	MOVX @R0,A
	MOVX @R0,A
	MOVX @R0,A
	MOVX @R0,A
	MOVX @R0,A
	ACALL TIML0
	MOV R0,#JP_READ
	MOVX A,@R0
	MOVX A,@R0
	MOVX A,@R0
	MOVX A,@R0
	MOVX A,@R0
	MOVX A,@R0
	MOVX A,@R0
	ADD A,#0FFH
        JC GL0L

        MOV A,#07H
	MOV R0,#jp_sel
	MOVX @R0,A
	ACALL TIML0
;	ACALL TIML
;       ACALL TIML
	MOV R0,#JP_READ
	MOVX A,@R0

	ADD A,#0FFH
	JC CKB
	CLR 08H
GK1:    CLR 01H
	RET
CTD2L:AJMP CTD2
CK:     JB 08H,GK1
	MOV R0,#04H
	MOV R4,#00H
	MOV R5,#00H
CT1:    MOV R2,#08H
	MOV R1,#JP_SEL
	MOV A,R0
	MOVX @R1,A
	MOVX @R1,A
      LCALL TIML
      	MOV R1,#JP_READ
        MOVX A,@R1
        MOVX A,@R1
        MOV B,A
        LCALL TIML0
;        MOV A,R0
;	MOVX @R1,A                 ;;第二次读键盘
         MOVX A,@R1          ;第二次读键盘
         MOVX A,@R1

        MOV R7,A             ;R7为键盘值暂存
        XRL A,B              ;比较是否相同
        JNZ GK1
          MOV A,R7
	MOV R3,A
CT6:    MOV A,R3
	RLC A
	MOV R3,A
	JC CTD2L
	JB 01H,CT10L2
	INC R4
	INC R4
	INC R4
	MOV A,R4
	SUBB A,#0AH
	JNC CT44
	SETB 00H
CT5:    DEC R2
	MOV A,R2
	JNZ CT6
	MOV A,R0
	RR A
	MOV R0,A
	INC R5
	MOV A,R5
	MOV R4,A
	CLR 01H
	SETB 00H
	AJMP CT1
CT44:LJMP CT4
CT10L2:LJMP CT10
;G4KEY:MOV R0,#0B2H	;四位输入键盘处理
;	MOV R1,#0B1H
;	MOV 18H,#02H
;	ACALL RSD
;	MOV A,R4
;	MOV R1,#0B2H
;	MOV B,@R1
;	ORL B,A
;	MOV @R1,B
;	SETB 08H
;	RET
;PROG1:MOV A,R4
;	MOV R1,#0B4H
;	MOV @R1,A
;	SETB 08H
;	RET
;MMSR: MOV R0,#0B2H
;	MOV R1,#0B1H
;	MOV 18H,#03H
;	ACALL RSD
;	MOV A,R4
;	MOV R1,#0B3H
;	MOV B,@R1
;	ORL B,A
;	MOV @R1,B
;	SETB 08H
;JNB 2AH,MMSRQ
;MOV R1,#0B1H
;MOV 37H,@R1
;INC R1
;MOV 38H,@R1
;INC R1
;MOV 39H,@R1
;MMSRQ:	RET
;GMDKEY:MOV R0,#37H	;八位输入键盘处理
;	MOV R1,#36H
;	MOV 18H,#04H
;	ACALL RSD
;	MOV A,R4
;	ORL 39H,A
;	SETB 08H
;	RET
;TSDIS:MOV R0,#0B0H	;两位输入键盘处理
;	MOV A,@R0
;	ANL A,#0FH
;	SWAP A
;	MOV @R0,A
;	MOV A,R4
;	MOV B,@R0
;	ORL B,A
;	MOV @R0,B
;	SETB 08H
;	RET
CT3L:LJMP CT3
CTZCL:MOV 10H,#0
          LJMP CTZC
;PROG1L:AJMP PROG1
;MMSRL:AJMP MMSR
CTD2:   JNB 00H,CT3L
	JNB 05H,CTP
	INC 10H
	MOV A,#09H
	CJNE A,10H,CTP
	MOV 10H,#00H
	CLR 05H
CTP:    INC R4
	MOV A,R4
	XRL A,#0AH
	JNZ CT7
	MOV R4,A
CT7:    JB 02H,CTZC
        JB 22H,CTZCL
	JB 05H,DPDY		;小数点按下
ctzc:   MOV R0,#37H
	MOV R1,#36H
	MOV 18H,#04H
	ACALL RSD
	MOV A,R4
	ORL 39H,A
	SETB 08H
	RET
CT4:CLR 00H
	CJNE R5,#01,CT8
	MOV A,R4
	ADD A,#0EH
	MOV R4,A
	LJMP CT10
DPDY:MOV A,67H
         XRL A,#0
         JNZ DPW2
      MOV R0,#37H
	MOV R1,#36H
	MOV 18H,#04H
	ACALL RSD
	MOV A,R4
	ORL 39H,A
	SETB 08H

;        MOV A,R4
 ;        SWAP A
;	ORL 39H,A
        AJMP DPW4
DPW2:MOV A,67H
         XRL A,#1
         JNZ DPW3
      MOV R0,#37H
	MOV R1,#36H
	MOV 18H,#04H
	ACALL RSD
	MOV A,R4
	ORL 39H,A
	SETB 08H

;         MOV A,R4
;	ORL 39H,A
DPW4:   INC 67H
        SETB 08H
        AJMP DPW5
DPW3:mov 10h,#3
         SETB 0EH
	CLR p3.2
;MOV A,3AH
;ANL A,#0FH
;SWAP A
;MOV 3AH,A
;MOV A,R4
;	ORL 3AH,A
;SETB 08H
;AJMP DYEN
;DPY1:MOV A,R4
;	ORL 3AH,A
;MOV A,3AH
;SWAP A
;MOV 3AH,A
;SETB 08H
;DYEN:RET
DPW5:RET
CT10L:LJMP CT10
CT8:    CJNE R5,#02,CT10L
	MOV A,R4
	ADD A,#1CH
	MOV R4,A
CT10:   INC R4
	INC R4
	INC R4
	SETB 01H
	AJMP CT5
RSD:    MOV A,@R0               ;移位处理
	MOV B,@R1
	ANL B,#0FH
	ANL A,#0F0H
	ORL A,B
	SWAP A
	MOV @R1,A
	INC R0
	INC R1
	DEC 18H
	MOV A,18H
	JNZ RSD
	DEC R1
	MOV A,@R1
	ANL A,#0F0H
	MOV @R1,A
	RET
TIML:   MOV R7,#16H             ;延时
TIM1:   MOV R6,#0FFH
TIM2:   NOP
	NOP
	NOP
	DJNZ R6,TIM2
	DJNZ R7,TIM1
	RET
TIML0:   MOV R7,#128;08H             ;延时
TIM10:   MOV R6,#0FFH
TIM20:   NOP
	NOP
	NOP
	DJNZ R6,TIM20
	DJNZ R7,TIM10
	RET

TIMGK:   MOV R6,#0FFH
TIM2GK:   NOP
	NOP
	NOP
   NOP
	NOP
	NOP
     NOP
	NOP
	NOP

	DJNZ R6,TIM2GK
RET

TIML6: MOV R7,#0F0H             ;延时
TIM16:   MOV R6,#0F0H
TIM26:   NOP
	NOP
	NOP
        NOP
	NOP
	NOP
        NOP
	NOP
	NOP
        NOP
	NOP
	NOP
	DJNZ R6,TIM26
	DJNZ R7,TIM16
	RET
PQUIT2:CLR P3.2
;     MOV DPTR,#PR_ERR
;	LCALL HZBXS
LJMP $
PQUIT:RET
PRINT:JB 18H,PQUIT
CLR 1BH
CLR 03H
      MOV R7,#00H
        MOV A,#00H
        MOVC A,@A+DPTR
        MOV R6,A
PLNUM:        INC R7
        MOV A,R7
        MOVC A,@A+dptr
        mov r5,a
PLCOD:
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
   INC R7
        MOV A,R7
        MOVC A,@A+DPTR
        JZ PBCD
        LCALL PDTP
        SJMP PNEXT
PBCD:    LCALL PXTP
	INC R1
PNEXT:   DJNZ R5,PLCODL
        DJNZ R6,PLNUML
        clr 03h
        CLR 1BH
        RET
PLCODL:LJMP PLCOD
PLNUML:LJMP PLNUM
PDTP: ;  JB BUSY,$
NOP
 NOP
 NOP
 NOP
 NOP
 NOP
NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
NOP
 NOP
 NOP
 NOP
 NOP
 NOP
NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
NOP
 NOP
 NOP
 NOP
 NOP
 NOP
NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
NOP
 NOP
 NOP
 NOP
 NOP
 NOP
NOP
 NOP
 NOP
 NOP
NOP
 NOP
 NOP
 NOP
 NOP
 NOP
NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
NOP
 NOP
 NOP
 NOP
 NOP
 NOP
NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
NOP
 NOP
 NOP
 NOP
 NOP
 NOP
NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
NOP
 NOP
 NOP
 NOP
 NOP
 NOP
NOP
 NOP
 NOP
 NOP

; CLR STB
;MOV P0,#0FFH
mov r0,#pr_sel
movx @r0,a
; MOV P0,A
 CLR STB
 NOP
 NOP
 NOP
 NOP
 NOP
  NOP
 NOP
 NOP
 NOP
 NOP
  NOP
 NOP
 NOP
 NOP
 NOP
  NOP
 NOP
 NOP
 NOP
 NOP
NOP
 NOP
 NOP
 NOP
 NOP
  NOP
 NOP
 NOP
 NOP
 NOP
  NOP
 NOP
 NOP
 NOP
 NOP
  NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
  NOP
 NOP
 NOP
 NOP
 NOP
  NOP
 NOP
 NOP
 NOP
 NOP
  NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
  NOP
 NOP
 NOP
 NOP
 NOP
  NOP
 NOP
 NOP
 NOP
 NOP
  NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
  NOP
 NOP
 NOP
 NOP
 NOP
  NOP
 NOP
 NOP
 NOP
 NOP
  NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
  NOP
 NOP
 NOP
 NOP
 NOP
  NOP
 NOP
 NOP
 NOP
 NOP
  NOP
 NOP
 NOP
 NOP
 NOP
NOP
 NOP
 NOP
 NOP
 NOP
  NOP
 NOP
 NOP
 NOP
 NOP
  NOP
 NOP
 NOP
 NOP
 NOP
  NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
  NOP
 NOP
 NOP
 NOP
 NOP
  NOP
 NOP
 NOP
 NOP
 NOP
  NOP
 NOP
 NOP
 NOP
 NOP
NOP
 NOP
 NOP
 NOP
 NOP
  NOP
 NOP
 NOP
 NOP
 NOP
  NOP
 NOP
 NOP
 NOP
 NOP
  NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
  NOP
 NOP
 NOP
 NOP
 NOP
  NOP
 NOP
 NOP
 NOP
 NOP
  NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
  NOP
 NOP
 NOP
 NOP
 NOP
  NOP
 NOP
 NOP
 NOP
 NOP
  NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
  NOP
 NOP
 NOP
 NOP
 NOP
  NOP
 NOP
 NOP
 NOP
 NOP
  NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
  NOP
 NOP
 NOP
 NOP
 NOP
  NOP
 NOP
 NOP
 NOP
 NOP
  NOP
 NOP
 NOP
 NOP
 NOP
NOP
 NOP
 NOP
 NOP
 NOP
  NOP
 NOP
 NOP
 NOP
 NOP
  NOP
 NOP
 NOP
 NOP
 NOP
  NOP
 NOP

 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
  NOP
 NOP
 NOP
 NOP
 NOP
  NOP
 NOP
 NOP
 NOP
 NOP
  NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
  NOP
 NOP
 NOP
 NOP
 NOP
  NOP
 NOP
 NOP
 NOP
 NOP
  NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
  NOP
 NOP
 NOP
 NOP
 NOP
  NOP
 NOP
 NOP
 NOP
 NOP
  NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
  NOP
 NOP
 NOP
 NOP
 NOP
  NOP
 NOP
 NOP
 NOP
 NOP
  NOP
 NOP
 NOP
 NOP
 NOP
NOP
 NOP
 NOP
 NOP
 NOP
  NOP
 NOP
 NOP
 NOP
 NOP
  NOP
 NOP
 NOP
 NOP
 NOP
  NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
  NOP
 NOP
 NOP
 NOP
 NOP
  NOP
 NOP
 NOP
 NOP
 NOP
  NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
  NOP
 NOP
 NOP
 NOP
 NOP
  NOP
 NOP
 NOP
 NOP
 NOP
  NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
  NOP
 NOP
 NOP
 NOP
 NOP
  NOP
 NOP
 NOP
 NOP
 NOP
  NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
  NOP
 NOP
 NOP
 NOP
 NOP
  NOP
 NOP
 NOP
 NOP
 NOP
  NOP
 NOP
 NOP
 NOP
 NOP
NOP
 NOP
 NOP
 NOP
 NOP
  NOP
 NOP
 NOP
 NOP
 NOP
  NOP
 NOP
 NOP
 NOP
 NOP
  NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
  NOP
 NOP
 NOP
 NOP
 NOP
  NOP
 NOP
 NOP
 NOP
 NOP
  NOP
 NOP
 NOP
 NOP
 NOP
NOP
 NOP
 NOP
 NOP
 NOP
  NOP
 NOP
 NOP
 NOP
 NOP
  NOP
 NOP
 NOP
 NOP
 NOP
  NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
  NOP
 NOP
 NOP
 NOP
 NOP
  NOP
 NOP
 NOP
 NOP
 NOP
  NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
  NOP
 NOP
 NOP
 NOP
 NOP
  NOP
 NOP
 NOP
 NOP
 NOP
  NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
  NOP
 NOP
 NOP
 NOP
 NOP
  NOP
 NOP
 NOP
 NOP
 NOP
  NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
  NOP
 NOP
 NOP
 NOP
 NOP
  NOP
 NOP
 NOP
 NOP
 NOP
  NOP
 NOP
 NOP
 NOP
 NOP
NOP
 NOP
 NOP
 NOP
 NOP
  NOP
 NOP
 NOP
 NOP
 NOP
  NOP
 NOP
 NOP
 NOP
 NOP
  NOP
 NOP

 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
  NOP
 NOP
 NOP
 NOP
 NOP
  NOP
 NOP
 NOP
 NOP
 NOP
  NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
  NOP
 NOP
 NOP
 NOP
 NOP
  NOP
 NOP
 NOP
 NOP
 NOP
  NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
  NOP
 NOP
 NOP
 NOP
 NOP
  NOP
 NOP
 NOP
 NOP
 NOP
  NOP
 NOP
 NOP
 NOP
 NOP

 SETB STB
;JB 1BH,WAIT
;JB 03H,pquit;PQUIT2;pquit
;MOV 65H,#0FFH
;ZSH:     MOV 66H,#0ffh
;ZSYH:	JNB BUSY,$;ZSS0H
;	DJNZ 66H,ZSYH
;	DJNZ 65H,ZSH
;       SETB 03H
;LJMP PQUIT;ljmp pquit2;	LJMP PQUIT
;ZSS0H:SETB 1BH
;AJMP ZSSH
;WAIT:   JB BUSY,WAIT
ZSSH:
  nop
nop
nop
nop
nop
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
  NOP
 NOP
 NOP
 NOP
 NOP

  nop
nop
nop
nop
nop
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
  NOP
 NOP
 NOP
 NOP
 NOP

  nop
nop
nop
nop
nop
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
  NOP
 NOP
 NOP
 NOP
 NOP

  nop
nop
nop
nop
nop
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
  NOP
 NOP
 NOP
 NOP
 NOP

  nop
nop
nop
nop
nop
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
  NOP
 NOP
 NOP
 NOP
 NOP
  nop
nop
nop
nop
nop
 NOP
 NOP
  nop
nop
nop
nop
nop
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
  NOP
 NOP
 NOP
 NOP
 NOP

  nop
nop
nop
nop
nop
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
  NOP
 NOP
 NOP
 NOP
 NOP

  nop
nop
nop
nop
nop
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
  NOP
 NOP
 NOP
 NOP
 NOP

  nop
nop
nop
nop
nop
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
  NOP
 NOP
 NOP
 NOP
 NOP

  nop
nop
nop
nop
nop
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
  NOP
 NOP
 NOP
 NOP
 NOP
  nop
nop
nop
nop
nop
 NOP
 NOP

 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
  NOP
 NOP
 NOP
 NOP
 NOP

  nop
nop
nop
nop
nop
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
  NOP
 NOP
 NOP
 NOP
 NOP

  nop
nop
nop
nop
nop
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
  NOP
 NOP
 NOP
 NOP
 NOP

  nop
nop
nop
nop
nop
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
  NOP
 NOP
 NOP
 NOP
 NOP

  nop
nop
nop
nop
nop
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
 NOP
  NOP
 NOP
 NOP
 NOP
 NOP

        RET

PXTP:nop
 NOP
 NOP
 NOP
 NOP
 NOP
NOP
nop
 NOP
 NOP
 NOP
 NOP
 NOP
NOP
nop
 NOP
 NOP
 NOP
 NOP
 NOP
NOP
nop
 NOP
 NOP
 NOP
 NOP
 NOP
NOP
nop
 NOP
 NOP
 NOP
 NOP
 NOP
NOP
nop
 NOP
 NOP
 NOP
 NOP
 NOP
NOP
nop
 NOP
 NOP
 NOP
 NOP
 NOP
NOP
nop
 NOP
 NOP
 NOP
 NOP
 NOP
NOP
 NOP
 NOP
 NOP
 NOP
 NOP
NOP
nop
 NOP
 NOP
 NOP
 NOP
 NOP
NOP
nop
 NOP
 NOP
 NOP
 NOP
 NOP
NOP
nop
 NOP
 NOP
 NOP
 NOP
 NOP
NOP
nop
 NOP
 NOP
 NOP
 NOP
 NOP
NOP
nop
 NOP
 NOP
 NOP
 NOP
 NOP
NOP
nop
 NOP
 NOP
 NOP
 NOP
 NOP
NOP
nop
 NOP
 NOP
 NOP
 NOP
 NOP
NOP

nop
 NOP
 NOP
 NOP
 NOP
 NOP
NOP
nop
 NOP
 NOP
 NOP
 NOP
 NOP
NOP
 NOP
 NOP
 NOP
 NOP
 NOP
NOP
nop
 NOP
 NOP
 NOP
 NOP
 NOP
NOP
nop
 NOP
 NOP
 NOP
 NOP
 NOP
NOP
nop
 NOP
 NOP
 NOP
 NOP
 NOP
NOP
nop
 NOP
 NOP
 NOP
 NOP
 NOP
NOP
nop
 NOP
 NOP
 NOP
 NOP
 NOP
NOP
nop
 NOP
 NOP
 NOP
 NOP
 NOP
NOP
nop
 NOP
 NOP
 NOP
 NOP
 NOP
NOP
 NOP
 NOP
 NOP
 NOP
 NOP
NOP
nop
 NOP
 NOP
 NOP
 NOP
 NOP
NOP
nop
 NOP
 NOP
 NOP
 NOP
 NOP
NOP
nop
 NOP
 NOP
 NOP
 NOP
 NOP
NOP
nop
 NOP
 NOP
 NOP
 NOP
 NOP
NOP
nop
 NOP
 NOP
 NOP
 NOP
 NOP
NOP
nop
 NOP
 NOP
 NOP
 NOP
 NOP
NOP
nop
 NOP
 NOP
 NOP
 NOP
 NOP
NOP

nop
 NOP
 NOP
 NOP
 NOP
 NOP
NOP
nop
 NOP
 NOP
 NOP
 NOP
 NOP
NOP

MOV A,@R1
	MOV B,A
     ANL A,#0F0H
xrl a,#0f0h     ;判断高位是否为“F“，如是，跳过（针对打当量）
jz pdnext
      mov a,b
     ANL A,#0F0H
	SWAP A
         ADD A,#030H
     lCALL PDTP
pdnext:	MOV A,B
	ANL A,#0FH
	ADD A,#030h
	lCALL PDTP
        RET

MULS:   MOV A,B
	CLR C
	SUBB A,#01H
	JC MU3
	MOV B,A
	MOV R0,#0FH
	MOV R1,#07H
MU1:    MOV A,@R0
	ADDC A,@R1
	DA A
	MOV @R0,A
	MOV A,#02H
	XRL A,R1
	JZ MU2
	DEC R0
	DEC R1
	LJMP MU1
MU2:    MOV A,09H
	ADDC A,#00H
	DA A
	MOV 09H,A
	MOV A,08H
	ADDC A,#00H
	DA A
	MOV 08H,A
	LJMP MULS
MU3:    RET
MULN:   MOV R0,#0FH             ;乘法
MUL1:   MOV @R0,#00H
	DEC R0
	MOV A,#07H
	XRL A,R0
	JNZ MUL1
	MOV A,65H;24H
	ANL A,#0F0H
	SWAP A
	MOV B,A
	LCALL MULS
	MOV R0,#09H
	MOV R1,#08H
	MOV 18H,#08H
	LCALL RSD
	ANL 0FH,#0F0H
	MOV B,65H;24H
	ANL B,#0FH
	LCALL MULS
	MOV R0,#09H
	MOV R1,#08H
	MOV 18H,#08H
	LCALL RSD
	ANL 0FH,#0F0H
	MOV A,66H;25H
	ANL A,#0F0H
	SWAP A
	MOV B,A
	LCALL MULS
	MOV R0,#09H
	MOV R1,#08H
	MOV 18H,#08H
	LCALL RSD
	ANL 0FH,#0F0H
	MOV B,66H;25H
	ANL B,#0FH
	LCALL MULS
	RET
Q20S:   MOV R0,#4DH             ;p*v
	MOV A,#01H
QS3:    CJNE A,30H,QS1
	MOV 65H,@R0
	INC R0
	MOV 66H,@R0
	MOV R0,#3BH
	MOV A,#01H
QS4:    CJNE A,30H,QS2
;        MOV R1,#0ACH
 ;       MOV A,@R1
  ;      XRL A,#39H
   ;     JZ QS4L
	MOV 02H,#00H
	MOV 03H,#00H
	MOV 04H,#00H
	MOV 05H,@R0
	INC R0
	MOV 06H,@R0
	INC R0
	MOV 07H,@R0
	LCALL MULN
	MOV R0,#0BH
	MOV R1,#0AH
	MOV 18H,#06H
	LCALL RSD
	MOV 2FH,0FH
	MOV 2EH,0EH
	MOV 2DH,0DH
	MOV 2CH,0CH
	MOV 2BH,0BH
        LJMP QS4EXIT
;QS4L:    MOV 2FH,#0H
;	MOV 2EH,#0H
;	MOV 2DH,07H
;	MOV 2CH,06h
 ;       mov 2Bh,05h
  ;	MOV R0,#2CH
;	MOV R1,#2BH
;	MOV 18H,#06H
;	ACALL RSD
QS4EXIT:	RET
QS1:    INC R0
	INC R0
	INC A
	lJMP QS3
QS2:    INC R0
	INC R0
	INC R0
	INC A
	LJMP QS4
COMS:   CLR C
	MOV R0,#00H
C1:     MOV A,R7
	SUBB A,R4
	MOV 0FH,A
	MOV A,R6
	SUBB A,R3
	MOV 0EH,A
	MOV A,R5
	SUBB A,R2
	JNC C2
	MOV A,R0
	RET
C2:     MOV R5,A
	MOV R6,0EH
	MOV R7,0FH
	INC R0
	LJMP C1
COMP:   MOV R2,#0FH             ;二十转换
	MOV R3,#42H
	MOV R4,#40H
	LCALL COMS
	MOV 0AH,A
	MOV R2,#01H
	MOV R3,#86H
	MOV R4,#0A0H
	LCALL COMS
	SWAP A
	MOV 0BH,A
	MOV R2,#00H
	MOV R3,#27H
	MOV R4,#10H
	LCALL COMS
	ORL 0BH,A
	MOV R3,#03H
	MOV R4,#0E8H
	LCALL COMS
	SWAP A
	MOV 0CH,A
	MOV R3,#00H
	MOV R4,#64H
	LCALL COMS
	ORL 0CH,A
	MOV R4,#0AH
	LCALL COMS
	SWAP A
	MOV 0DH,A
	MOV A,R7
	ORL 0DH,A
	RET
;RS2:    INC R0
;	INC R0
;	INC A
;	AJMP AA1
RS:     MOV 65H,#00H
	MOV 66H,#64H
	AJMP POR3
;	MOV R0,#4DH             ;r*v
;	MOV A,#01H
;AA1:    CJNE A,30H,RS2
;	MOV 0EH,@R0
;	INC R0
;	MOV 0FH,@R0
;	MOV R2,#00H
;	MOV R3,#38H
;	MOV DPTR,#1400H
;POR1:   MOV A,R2
;	CLR C
;	MOVC A,@A+DPTR
;	SUBB A,0FH
;	INC R2
;	MOV A,R2
;	MOVC A,@A+DPTR
;	SUBB A,0EH
;	JC POR2
;	INC R2
;	INC R2
;	DJNZ R3,POR1
;	SETB 0EH
;	RET
;POR2:   INC R2
;	MOV A,R2
;	MOVC A,@A+DPTR
;	MOV 07H,A
;	MOV 06H,#00H
;	MOV 05H,#00H
;	ACALL COMP
;	MOV 66H,0DH
;	MOV 65H,0CH
POR3:
; LCALL XYT86TO       ;加密效验，置0EH
        MOV R0,#3BH
	MOV A,#01H
RS4:    CJNE A,30H,RS3
	MOV 05H,@R0
	INC R0
	MOV 06H,@R0
	INC R0
	MOV 07H,@R0
	MOV 02H,#00H
	MOV 03H,#00H
	MOV 04H,#00H
	LCALL MULN
	MOV 6BH,0FH
	MOV 6AH,0EH
	MOV 69H,0DH
	MOV 68H,0CH
	RET
RS3:    INC R0
	INC R0
	INC R0
	INC A
	LJMP RS4
TV:
      MOV R0,#07H
	MOVX @R0,A
	LCALL TIML
MOV P0,#0FFH
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
     MOV R0,#07H             ;温度采集
	MOVX A,@R0
	MOV 07H,A
	MOV 06H,#00H
	MOV 05H,#00H
	MOV R0,#07H
	MOVX @R0,A
	LCALL COMP
	MOV 07H,0DH
	MOV 06H,0CH
	MOV A,#00H
	MOV 05H,A
	MOV 04H,A
	MOV 03H,A
	MOV 02H,A
	MOV 65H,A
	MOV 66H,#25H
	LCALL MULN
	MOV 65H,0EH
	MOV 66H,0FH
;	MOV A,0DH
;	JZ TV1	;高位无数，100度以下
;	MOV A,65H	;100度以上，06H总为1
;	ADD A,#80H
;	DA A
;	JC TV2	;有溢出，为正值
;	MOV 65H,A	;无溢出，为负值
;	SETB 06H
;	LJMP PO2
;TV2:    MOV 65H,#99H
;	MOV 66H,#99H
;	SETB 06H
;	LJMP PO2
TV1:    MOV A,65H
	ADD A,#80H
	DA A
	JNC PO1	;100度以下，负值
	SETB 06H	;100度以下，正值 06H=1
	MOV 65H,A
PO2:    MOV 07H,6BH
	MOV 06H,6AH
	MOV 05H,69H
	MOV 04H,68H
	MOV 03H,#00H
	MOV 02H,#00H
	LCALL MULN
        MOV 17H,0FH
	MOV 16H,0EH
	MOV 15H,0DH
	MOV 14H,0CH
	MOV 13H,0BH
	MOV 12H,0AH
	MOV 11H,#00H
	MOV 10H,#00H
        LJMP PO2EXIT
JSL:       MOV 17H,#0H
	MOV 16H,#0H
	MOV 15H,#0H
	MOV 14H,#0H
	MOV 13H,#0H
	MOV 12H,#0H
	MOV 11H,#00H
	MOV 10H,#00H
PO2EXIT:	RET
PO1:    CLR 06H		;100度以下，负值，06H=0
	MOV 18H,A
	MOV A,#99H
	CLR C
	SUBB A,18H
	MOV 18H,A
	CLR C
	MOV A,#99H
	SUBB A,66H
	ADD A,#01H
	DA A
	MOV 66H,A
	MOV A,18H
	ADDC A,#00H
	DA A
	MOV 65H,A
	LJMP PO2

TPI:    PUSH PSW                ;计量
	CLR EX0
	CLR ET0
;       CLR ET1
;       CLR TR1
	CLR TR0
;       CLR TF1
	SETB 1CH
        clr 22h
	MOV TH0,#0FFH
	MOV TL0,#0FFH
;        MOV JS_COUNT,#30D
;        MOV TH1,#0FFH
;        MOV TL1,#0FFH
;MOV 28H,#03H
;MOV 29H,#0E0H
;MOV 2AH,#0FFH
	LCALL TV
	MOV R0,#2FH
	MOV R1,#17H
	CLR C
	JNB 06H,PI17
	MOV A,#99H
	SUBB A,@R1
	MOV @R1,A
	DEC R1
PI3:    MOV A,#99H
	SUBB A,@R1
	MOV @R1,A
	DEC R1
	MOV A,R1
	XRL A,#11H
	JNZ PI3
	MOV R1,#17H
	SETB C
PI17:   MOV A,@R1
	ADDC A,#00H
	DA A
	MOV @R1,A
	DEC R1
PI15:   MOV A,@R0
	ADDC A,@R1
	DA A
	MOV @R1,A
	DEC R0
	DEC R1
	MOV A,#2AH
	XRL A,R0
	JNZ PI15
	MOV R0,#80H
	MOV R1,#18H
	CLR C
TPI1:   DEC R0
	DEC R1
	MOV A,@R0
	ADDC A,@R1
	DA A
	MOV @R0,A
	MOV A,#78H
	XRL A,R0
	JNZ TPI1
	MOV A,77H
	ADDC A,#00H
	DA A
	MOV 77H,A
	MOV A,76H
	ADDC A,#00H
	DA A
	MOV 76H,A
	JZ TPI4
;	MOV 35H,7AH
        LJMP TPI4
PI11D:  CLR JDQ_2
         mov r1,#0dfh
         mov a,#0adh
         mov @r1,a
        ;setb 18h
        LJMP TPNOOVER


	MOV 34H,79H
	MOV 33H,78H
	MOV 32H,77H
	MOV 31H,76H
	MOV 10H,#0
	AJMP TPI3
TPI4:   MOV 34H,7AH
	MOV 33H,79H
	MOV 32H,78H
        MOV 31H,77H
	MOV 10H,#03H
tpi3dd: mov r1,#0dfh
         mov a,@r1
         xrl a,#0adh
       Jz TPI3         ; 18H=1，  气阀已启动
tpI3d:  CLR C          ;计算是否打到启动气阀的油量
        MOV R1,#0DCH
	MOV A,#99H
	SUBB A,@R1
	MOV 0FH,A
        DEC R1
	MOV A,#99H
	SUBB A,@R1
	MOV 0EH,A
        DEC R1
	MOV A,#99H
	SUBB A,@R1
	MOV 0DH,A
	MOV A,#99H
        DEC R1
	SUBB A,@R1
	MOV 0CH,A

	SETB C
	MOV A,7AH
	ADDC A,0FH
	DA A
	MOV A,79H
	ADDC A,0EH
	DA A
        MOV A,78H
	ADDC A,0DH
	DA A
	MOV A,77H
	ADDC A,0CH
	DA A
 	JC PI11D
        LJMP TPNOOVER

TPI3:   CLR C
	MOV A,#99H
	SUBB A,1FH
	MOV 0FH,A
	MOV A,#99H
	SUBB A,1EH
	MOV 0EH,A
	MOV A,#99H
	SUBB A,1DH
	MOV 0DH,A
	MOV A,#99H
	SUBB A,1CH
	MOV 0CH,A
	MOV A,#99H
	SUBB A,1BH
	MOV 0BH,A
	SETB C
	MOV A,7AH
	ADDC A,0FH
	DA A
	MOV A,79H
	ADDC A,0EH
	DA A
	MOV A,78H
	ADDC A,0DH
	DA A
	MOV A,77H
	ADDC A,0CH
	DA A
	MOV A,76H
	ADDC A,0BH
	DA A
	JC PI11
TPNOOVER:LCALL SEND_LG8012
;        LCALL DISPNUM
	POP PSW
	SETB TR0
;       SETB TR1
       SETB ET0
;       SETB ET1
	SETB EX0
	RETI
PI11:   JB 0CH,DTS1	;#1
;	JB 0DH,DTS6	;#6
;	LJMP BT5
 DTS1:  MOV A,74H
	ADD A,#01H
	DA A
	MOV 74H,A
	MOV 31H,74H
	CJNE A,75H,BTXS
	CLR 0CH
        MOV 30H,#0
	LJMP BTXS

;DTS1:   MOV A,74H
 ;       XRL A,#99H
  ;      JZ NTS

   ;     MOV A,74H
;	ADD A,#01H
;	DA A
;	MOV 31H,74H
;NTS:    MOV A,75H
 ;       CJNE A,#99H,WTS
  ;      LJMP BTXS
;WTS:    MOV A,74H
 ;       CJNE A,75H,BTXS
; 	CLR 0CH
;	LJMP BTXS
DTS6:  MOV A,74H
	ADD A,#01H
	DA A
	MOV 74H,A
	MOV 31H,74H
	CJNE A,75H,BTXS
	CLR 0DH
;DTS4:   MOV A,74H
;	ADD A,#01H
;	DA A
 ;       MOV 74H,A
;	MOV 1AH,74H
 ;       CJNE A,75H,BTXS
;	CLR 0DH
;	LJMP BTXS
;BT5:    MOV 31H,76H
;	SETB P1.4
;	MOV 34H,79H
 ;;       MOV 33H,78H
   ;     MOV 32H,77H
;	MOV 35H,7AH
 ;       MOV 10H,#0
;	LCALL DISPNUM
;	lJMP BTEND
BTXS:	SETB JDQ_1	;付完
SETB JDQ_2
;SETB LED_QD
clr LED_QD
LCALL TIML
;	MOV DPTR,#MAIN_B;#BXS
;	LCALL HZBXS
;	MOV A,#00H
;	MOV R0,#01H
;	MOVX @R0,A
	MOV A,76H
	JZ TPI42
;	MOV 35H,7AH
	MOV 34H,79H
	MOV 33H,78H
	MOV 32H,77H
	MOV 31H,76H
	MOV 10H,#0
	LJMP TPI32
TPI42:   MOV 34H,7AH
	MOV 33H,79H
	MOV 32H,78H
mov 31h,74h
mov r0,#32h

	CLR C
	lCALL DISH
	lCALL DISL
	lCALL DISH
	MOV 10H,#03H
TPI32:LCALL DISP_SMG
;	LCALL DISPNUM
	;MOV DPTR,#MAIN_B;#BXS
	;LCALL HZBXS

;MOV COM,#98H
;lcall wri
;MOV DPTR,#tsxs
;MOV R1,#0
;MOV R2,#8
;ACALL SDZF
;MOV COM,#8EH
;LCALL WRI
;MOV R1,#75H
;MOV R2,#1
;LCALL DISNW0
;MOV COM,#9EH
;LCALL WRI
;MOV R1,#74H
;MOV R2,#1
;LCALL DISNW0
;mov r0,#74h
;lcall send_ts
BTEND:	POP PSW
	CLR TR0
;        CLR TR1
	CLR ET0
;        CLR ET1
	CLR EX0
	CLR 04H
	RETI
;SDZF:MOV A,R1
;	MOVC A,@A+DPTR
;	MOV DAT,A
;	LCALL WRD
;	INC R1
;	DJNZ R2,SDZF
;	RET

;RD1:    LCALL READ0
;	MOV @R0,LOWBYTE
;	INC 72H
;	INC R0
;	DJNZ R1,RD1
;	RET
MN:	MOV SP,#0DfH             ;主程序入口
        MOV P0M0,#0
        MOV P0M1,#0
       MOV TMOD,#25H
        MOV AUAX,#42H;#02h
        mov auxr1,#10000000b
 	SETB TR0
        SETB P1.0
        SETB P1.1
clr p4.1
;clr pr12
;clr pr13
;        CLR P1.0
;clr p1.3
;clr p2.6
	CLR 09H
	CLR 19H
	CLR 18H
	MOV 24H,#0 ;清20h-2fh
	MOV 25H,#0
        mov 67h,#0
	CLR 14H
	CLR 1EH
	CLR 1CH
	CLR 1DH
        CLR 1FH
;	CLR 1BH



CLR 22H
        clr 1ah
        clr 0bh
;SETB LED_QD
 clr LED_QD

;setb gj;
;clr kj;接通电池继电器
;MOV R1,#0D9H         ;3秒停泵后检测掉电标志位
;MOV @R1,#0
;SETB CHECK_POWER

	MOV IE,#81H
setb ex1
;clr p2.3
 ;    mov r4,#2
  ;  lcall delayms	;必须有足够的时间保证LCD复位完成
;setb p2.3
;	clr 0ah	;背光开关位
;lcall dispset
;MOV P0,#0FFH
mov r0,#pr_sel   ;设置打印字体
MOV A,#1BH
movX @R0,A
NOP
NOP
NOP
NOP
NOP
MOV A,#40h;#38H
MOVX @R0,A
lcall timl6
;ljmp rpl
MOV P0,#0FFH
        MOV SCON,#0D8H
        MOV PCON,#80H
        MOV TH1,#0FFH;#0FAH
        MOV TL1,#0FFH;#0FAH
        SETB TR1
;	CLR AS
;      	MOV TIME_ADDR,#0AH
;      	MOV TIME_DATA,#20H
;      	LCALL RTC_WRITE
;      	MOV TIME_ADDR,#0BH
;      	MOV TIME_DATA,#02H
;      	LCALL RTC_WRITE
;	MOV R7,#0FFH
;	LCALL TIM1
;MOV P0,#0FFH
ljmp time_jy
GOODL2:LJMP GOOD1
TIME_JY:;MOV R0,#69H   ;读8031时间
;	MOV 72H,#66
;	MOV R1,#3

;          MOV         EE240X_AD,#1H      ;第一页
;           MOV         EE240X_SUBA,#1  ;1-3   读设定限期
;          MOV         EE240X_NUMBYT,#3
;          MOV         EE240X_RDA,#69H
;          LCALL       EE240X_RDNBYT
;          lcall timgk
;          lcall timgk
;mov 72H,#C12887_QX_ADDRESS
;MOV R1,#69H
;MOV R7,#3

           MOV         EE240X_AD,#5H      ;第一页
           MOV         EE240X_SUBA,#1  ;1-3   读设定限期
          MOV         EE240X_NUMBYT,#3
          MOV         EE240X_RDA,#69H
          LCALL       EE240X_RDNBYT
          lcall timl
          lcall timl

;         MOV R0,#69H
;       MOV DPTR,#FLASH_QX_ADDRESS
;       MOV R2,#3
;       LCALL FLASH_READ

MOV A,69H       ;已解除期限
XRL A,#99H
JZ GOODl2

;MOV TIME_ADDR,72H
 ;        LCALL RTC_READ
  ;      MOV A,TIME_DATA
;	 MOV @R0,A
 ;        INC 72H
  ;       INC R0
   ;      DJNZ R1,RCS1
 MOV R0,#34H
lcall GET1302_RQ

;	MOV TIME_ADDR,#7	;读RTC时间
 ;    	LCALL RTC_READ
  ;   	MOV A,TIME_DATA
   ;  	MOV 34H,A	;日            34
;	MOV TIME_ADDR,#8
 ;       LCALL RTC_READ
  ;      MOV A,TIME_DATA
;	MOV 33H,A		;月  33
;	MOV TIME_ADDR,#9
 ;       LCALL RTC_READ
  ;      MOV A,TIME_DATA
;	MOV 32H,A		;年32
	CLR C
	MOV A,32H	;RTC(DATA)-CPU(SET)
	SUBB A,69H
	JC GOODL2
	JZ YUE_JY
	LJMP NOPASS
	YUE_JY:CLR C
	MOV A,33H
	SUBB A,6AH
	JC GOODL2
	JZ RI_JY
	LJMP NOPASS
	RI_JY:CLR C
	MOV A,34H
	SUBB A,6BH
	JC GOODL2
	JZ GOODL2
NOPASS:	SETB 1EH	;；未通过，设置标志位
CLR C
MOV A,32H
ADD A,#11H
MOV 05H,A
MOV 65H,#0
MOV 66H,#14H
MOV 07H,34H
MOV 06H,33H
;MOV 05H,#0H
MOV 04H,#0H
MOV 03H,#0
MOV 02H,#0
LCALL MULN
MOV R0,#0A6H
MOV @R0,0DH          ;按低、中、高次序输入   （年+11AAND  月AND 日）*14  解除期限
INC R0
MOV @R0,0EH
INC R0
MOV @R0,0FH

CLR C
MOV A,32H
ADD A,#20H
MOV 05H,A
MOV 65H,#0
MOV 66H,#6H
MOV 07H,34H
MOV 06H,33H
;MOV 05H,#0H
MOV 04H,#0H
MOV 03H,#0
MOV 02H,#0
LCALL MULN
MOV R0,#0A9H
MOV @R0,0DH          ;按低、中、高次序输入    （年+20AAND  月AND 日）*6   延期
INC R0
MOV @R0,0EH
INC R0
MOV @R0,0FH
CLR P3.2
LCALL TIML6
LCALL TIML6
LCALL TIML6
LCALL TIML6
LCALL TIML6
LCALL TIML6
LCALL TIML6
LCALL TIML6
LCALL TIML6
LCALL TIML6
SETB P3.2
;LCALL DISPSET
;MOV DPTR,#CQ
;LCALL ZBXS
;AJMP FMXH0
GOODL:LJMP GOOD1
;READNEXTL:LJMP READNEXT
GOOD:;SETB 1BH
;LCALL TD
;JNB 09H,JCTZ
;MOV A,34H
;XRL A,#20H      ;-20度
;JNZ GOODL
;MOV DPTR,#DLTS
;LCALL ZBXS
;AJMP FMXH0
;JCTZ:MOV A,33H    ;120度
;XRL A,#1
;JNZ GOODL
;MOV A,34H
;XRL A,#20H
;JNZ GOODL
;MOV DPTR,#KLTS
;LCALL ZBXS

;MOV COM,#90H	;显示超期提示1
;LCALL WRI
;MOV DPTR,#CQ1
;MOV R1,#0
;MOV R2,#12
;LCALL SDZF
;MOV COM,#88H	;显示超期提示2
;LCALL WRI
;MOV DPTR,#CQ2
;MOV R1,#0
;MOV R2,#14
;LCALL SDZF
;FMXH0:MOV R3,#3
;FMXH:	LCALL SON
;	MOV R7,#09FH
;	LCALL TIM1
;DJNZ R3,FMXH
;ENTJC:MOV A,#04H		;扫第一根行线
;MOV R0,#02H		;键盘地址02H
;MOVX @R0,A
;lCALL TIML
;MOV R0,#02H
;MOVX A,@R0
;CJNE A,#02H, ENTJC;

GOOD1:CLR 1BH
      MOV A,#00H
	MOV 20H,A
	MOV 21H,A
	MOV 22H,A
	MOV 71H,A
	MOV 70H,A
	MOV 6FH,A
	MOV 6EH,A
	MOV 6DH,A
	MOV 6CH,A
MOV R1,#0D7H     ;扫描温度时间寄存单元
MOV A,#0
MOV @R1,A
SETB P3.2
;        MOV R0,#39H
;       MOV DPTR,#FLASH_DD_ADDRESS     ;掉电标志
;       MOV R2,#1;8
;       LCALL FLASH_READ

;MOV A,39H
;XRL A,#8EH
;JNZ READNEXTL
;        MOV R0,#74H
;       MOV DPTR,#FLASH_YDWD_ADDRESS     ;已打未打
;       MOV R2,#2
;       LCALL FLASH_READ

;MOV R1,#0BBH    ;打印已打\未打次数
;MOV @R1,75H
;mov r1,#0bch
;mov @r1,74h
;	MOV DPTR,#PJLZ2
;	MOV R1,#0BBH
;	LCALL PRINT
;lcall timl6
;MOV 74H,#0
;MOV 75H,#0
;        MOV R0,#76H
;       MOV DPTR,#FLASH_DCJL_ADDRESS     ;单次计量值
;       MOV R2,#5
;       LCALL FLASH_READ

;lcall timl6
;lcall timl6
;mov r1,#0bbh           ;打印单次计量值
;mov @r1,76h
;INC R1
;MOV @R1,77H
;INC R1
;MOV @R1,78H
;INC R1
;MOV @R1,79H
;INC R1
;MOV @R1,7AH
;	MOV DPTR,#PDCJL
;	MOV R1,#0BBH
;	LCALL PRINT
;lcall timl6
;MOV 76H,#0
;MOV 77H,#0
;MOV 78H,#0
;MOV 79H,#0
;MOV 7AH,#0
;        MOV R0,#6DH
;       MOV DPTR,#FLASH_ZJL_ADDRESS     ;单次计量值
;       MOV R2,#5
;       LCALL FLASH_READ

;MOV R1,#0BBH                     ;总计量值
;  MOV @R1,6DH
;	INC R1
;	MOV @R1,6EH
;	INC R1
;	MOV @R1,6FH
;	INC R1
;	MOV @R1,70H
;	INC R1
;	MOV @R1,71H
;	MOV DPTR,#PZFY
;	MOV R1,#0BBH
;	LCALL PRINT
;lcall timl6
;MOV 6DH,#0
;MOV 6FH,#0
;MOV 70H,#0
;MOV 71H,#0
;MOV 6EH,#0
;        MOV R0,#0BBH
;       MOV DPTR,#FLASH_zje_ADDRESS     ;
;       MOV R2,#6
;       LCALL FLASH_READ

;lcall timl6
;MOV DPTR,#PSJ
;MOV R1,#0BBH
;LCALL PRINT
;MOV DPTR,#PHG
;LCALL PRINT
;lcall timl6
;MOV DPTR,#PPM
;LCALL PRINT
;MOV 39H,#0
;        MOV DPTR,#FLASH_DD_ADDRESS
;       MOV R2,#1
;       MOV R0,#39H
;       LCALL FLASH_WRITE

        MOV         EE240X_AD,#1H      ;设器件的三位可编程地址
           MOV         EE240X_SUBA,#0  ;读
          MOV         EE240X_NUMBYT,#8
          MOV         EE240X_RDA,#3BH
          LCALL       EE240x_RDNBYT
          lcall timl
          lcall timl
          lcall timl

         MOV         EE240X_AD,#1H      ;设器件的三位可编程地址
           MOV         EE240X_SUBA,#8  ;读
          MOV         EE240X_NUMBYT,#8
          MOV         EE240X_RDA,#43H
          LCALL       EE240x_RDNBYT
          lcall timl
          lcall timl
          lcall timl

         MOV         EE240X_AD,#1H      ;设器件的三位可编程地址
           MOV         EE240X_SUBA,#16  ;读
          MOV         EE240X_NUMBYT,#8
          MOV         EE240X_RDA,#4BH
          LCALL       EE240x_RDNBYT
          lcall timl
          lcall timl
          lcall timl

         MOV         EE240X_AD,#1H      ;设器件的三位可编程地址
           MOV         EE240X_SUBA,#24  ;读
          MOV         EE240X_NUMBYT,#8
          MOV         EE240X_RDA,#53H
          LCALL       EE240x_RDNBYT
          lcall timl
          lcall timl
          lcall timl
          lcall timl

         MOV         EE240X_AD,#1H      ;设器件的三位可编程地址
           MOV         EE240X_SUBA,#32  ;读
          MOV         EE240X_NUMBYT,#10
          MOV         EE240X_RDA,#5BH
          LCALL       EE240x_RDNBYT
          lcall timl
          lcall timl
          lcall timl

;	LCALL RD1
;LCALL XYT86   ;加密效验，不对置1EH

;rpl:	MOV R0,#80H	;读累计 (从48T86中读出）
;	MOV 72H,#83
;	MOV R1,#36
;RCS4:	MOV TIME_ADDR,72H
;         LCALL RTC_READ
;        MOV A,TIME_DATA
;	 MOV @R0,A
;         INC R0
;         INC 72H
;         DJNZ R1,RCS4
;LJMP REDJ
;lcall pl1
;jmp $


           MOV         EE240X_AD,#1H      ;设器件的三位可编程地址
           MOV         EE240X_SUBA,#65;65;16  ;读单价
          MOV         EE240X_NUMBYT,#12;8
          MOV         EE240X_RDA,#0C4H
          LCALL       EE240x_RDNBYT
          lcall timl
          lcall timl
          lcall timl
            MOV         EE240X_AD,#3H      ;设器件的三位可编程地址
            MOV         EE240X_SUBA,#0  ;读总累计
            MOV         EE240X_NUMBYT,#16  ;读2字节数据
            MOV         EE240X_RDA,#80H     ;设接收缓冲区首址
            LCALL       EE240X_RDNBYT    ;读出数据
          lcall timl
          lcall timl
          lcall timl
          lcall timl
            MOV         EE240X_AD,#3H      ;设器件的三位可编程地址
            MOV         EE240X_SUBA,#16  ;读总累计
            MOV         EE240X_NUMBYT,#14  ;读2字节数据
            MOV         EE240X_RDA,#90H     ;设接收缓冲区首址
            LCALL       EE240X_RDNBYT    ;读出数据
          lcall timl
          lcall timl
          lcall timl
          lcall timl
            MOV         EE240X_AD,#3H      ;设器件的三位可编程地址
            MOV         EE240X_SUBA,#30  ;读总累计
            MOV         EE240X_NUMBYT,#6  ;读2字节数据
            MOV         EE240X_RDA,#9EH     ;设接收缓冲区首址
            LCALL       EE240X_RDNBYT    ;读出数据
          lcall timl
          lcall timl
          lcall timl
          lcall timl
            MOV         EE240X_AD,#3H      ;设器件的三位可编程地址
            MOV         EE240X_SUBA,#40  ;读总累计
            MOV         EE240X_NUMBYT,#5  ;读2字节数据
            MOV         EE240X_RDA,#76H     ;设接收缓冲区首址
            LCALL       EE240X_RDNBYT    ;读出数据
          lcall timl
          lcall timl
          lcall timl
          lcall timl
     MOV         EE240X_AD,#1H      ;设器件的三位可编程地址
            MOV         EE240X_SUBA,#4H   ;设器件子地址
            MOV         EE240X_NUMBYT,#1  ;写36字节数据
            MOV         EE240X_TDA,#0ddH     ;设发送缓冲区首址
            LCALL       EE240X_RDNBYT    ;写入数据
                lcall timl
          lcall timl
          lcall timl
          lcall timl


MOV 30H,#0
	LCALL TIIL
	LCALL TIIL
	LCALL TIIL
;	LCALL TIIL
MOV 72H,#45H     ;打印机开  #97――关

LCALL SEND_PR
        LCALL SON
MOV A,76H
JZ BXYXS
	MOV 31H,76H
	MOV 32H,77H
	MOV 33H,78H
	MOV 34H,79H
	MOV 10H,#0
        LJMP MN0
BXYXS:  MOV 31H,77H
	MOV 32H,78H
	MOV 33H,79H
	MOV 34H,7AH
	MOV 10H,#3
        SETB 17H
;	MOV DPTR,#MAIN_B;#BXS
;	LCALL ZBXS

MN0:    CLR 0FH
	MOV 3AH,#0H
	MOV 39H,#0H
	MOV 38H,#00H
	MOV 37H,#00H
	MOV 36H,#00H

;JB 2AH,MN1
MOV R1,#0B0H
	MOV R2,#5
DYCLER:MOV @R1,#0
	INC R1
	DJNZ R2,DYCLER
;LJMP MN1
;DISP_LEDNEXTL:LJMP DISP_LEDNEXT
MN1:LJMP MN01
;JB 02H,DISP_LEDNEXT
;       JB 2CH,DISP_LEDNEXT

;MOV R1,#0D7H
;MOV A,@R1
;INC A
;MOV @R1,A
;CJNE A,#0B0H,MN01
;LCALL SEND_WD

NOP
NOP
NOP
;NOP
;NOP
;JnB CHECK_POWER,MNPASS
;lcall timl6
;JnB CHECK_POWER,MNPASS
;lcall timl
;lcall timl
;JnB CHECK_POWER,MNPASS
;LCALL SON
;LCALL SON
;LCALL TIML6
;CLR GJ;关掉电池继电器
;setb kj;

;MNPASS:MOV R1,#0D7H
;MOV A,#0
;MOV @R1,A

;DISP_LEDNEXT: 	JB 02H,MN01
;	JB 0FH,MN01
;	JB 22H,MN01
MN001:CLR 0FH
MN01:;LCALL DISPNUM
      LCALL DISP_SMG
      mov c,IN_YK
         jb IN_YK,fyqd1
mn5:    LCALL GK
	JNB 00H,MN2
	JB 0EH,MN2
	JNB 17H,CPD
	CLR 17H
	MOV 10H,#00H
CPD:    SETB 0FH  ;显示数字
;	MOV 35H,3AH
	MOV 34H,39H
	MOV 33H,38H
	MOV 32H,37H
	MOV 31H,36H
MN2:    JNB 01H,MN1
        MOV A,R4
        CLR C
        SUBB A,#79H
        JC GK13
        clr 01h             ;不清当按完功能键接着按数字键时容易乱
        MOV A,R4               ;是第四根线
       JB 02H,MN_22
       MOV DPTR,#0010H
	JMP @A+DPTR
MN_22:  MOV DPTR,#0040H
	JMP @A+DPTR
MN1L:LJMP MN1
GK13:	MOV 18H,R4
	MOV A,#2AH
	XRL A,R4
	JZ MN3
	JB 0EH,MN1L

MN3:    MOV A,18H
	JB 02H,MN4
	MOV DPTR,#0010H         ;键盘散转
	JMP @A+DPTR
MN4:    MOV DPTR,#0040H
	JMP @A+DPTR
DPD:    JB 05H,DPD1
	SETB 05H
	CLR 09H
	;MOV A,#01H
	;MOV R0,#01H
	;MOVX @R0,A
	MOV 10H,#01H
DPD1:   LJMP MN1
FYLD2:  LJMP MN0
fyqd1:jb 02h,fyld2
         MOV A,30H
         CJNE A,#0,YK1L
         MOV 30H,#1
         CLR 00H      ;00H=0；按下功能键标志，不清则打桶后显示不出桶数，跳到按下数字键程序显示数字
         LJMP DC1
YK1L:    CJNE A,#1,YK2L
         LJMP DC1
YK2L:    CJNE A,#2,YK3L
         LJMP DC2
YK3L:    CJNE A,#3,YK4L
         LJMP DC3
YK4L:    CJNE A,#4,YK5L
         LJMP DC4
YK5L:    CJNE A,#5,YK6L
         LJMP DC5
YK6L:    CJNE A,#6,FYLD1
         LJMP DC6
fyld1:  CLR 00H
        MOV 30H,#1
        ljmp DC1

CLER:  ;  JNB 22H,CLERDL
;	CLR 22H
;	CLR 05H
;	MOV COM,#9EH
;	LCALL WRI
;	MOV DAT,#30H
;	LCALL WRD
;	LCALL WRD
;	LJMP MN0
;CLERDL:
   CLR 0FH                 ;清除
	CLR 0EH
	CLR 05H
	CLR 14H
        CLR 22H
        CLR 07H
        MOV 67H,#0
	MOV 10H,#00H
;mov r0,#10h             ;显示板桶数清零
;lcall send_ts
	MOV R0,#3AH
	MOV R1,#10
CLE1:   MOV @R0,#00H
	DEC R0
	DJNZ R1,CLE1
	MOV R1,#0B0H
	MOV R2,#5
CLE3:MOV @R1,#0
	INC R1
	DJNZ R2,CLE3
	MOV R0,#17H
	MOV R1,#8
CLE2:   MOV @R0,#00H
	DEC R0
	DJNZ R1,CLE2
 	MOV R0,#1FH
	MOV R1,#5
CLE2Q:   MOV @R0,#00H
	DEC R0
	DJNZ R1,CLE2Q
        setb p3.2
        JB 02H,D
        JB 23H,D
        JB 2CH,D
CSWCT:        JNB 0CH,CSW
        CLR 0CH
        MOV 30H,#0
        LJMP BT81
CSW:  JNB 0DH,CDCLE
	CLR 0DH
	LJMP BT81
CDCLE:;MOV DPTR,#MAIN_B;#BXS
;LCALL ZBXS
D:      LJMP MN0
DIS_DMM: ;             MOV         EE240X_AD,#1H      ;第一页   ;显示编程密码
         ;  MOV         EE240X_SUBA,#4  ;4-6
         ; MOV         EE240X_NUMBYT,#3
         ; MOV         EE240X_RDA,#32H
         ; LCALL       EE240X_RDNBYT
         ; lcall timgk
         ; lcall timgk
;        MOV R0,#32H
;       MOV DPTR,#FLASH_bcmm_ADDRESS
;       MOV R2,#3
;       LCALL FLASH_READ

;MOV DPTR,#BXBCMM
;LCALL ZBXS
;	MOV COM,#95H
;	MOV R1,#32H
;	MOV R2,#6
;	LCALL DGCS
;	LCALL TIIL
;	LCALL TIIL
;	LCALL TIIL
 ;       LCALL TIIL
;MOV DPTR,#MAIN_B
;LCALL ZBXS
LCALL SON
;	MOV R7,#0FH
 ;       clr p3.2
;	LCALL TIM1
;	SETB P3.2
;LCALL DISP_SMG
;	LCALL TIIL
;;	LCALL TIIL
;	LCALL TIIL
 ;       LCALL TIIL
	mov 37H,#0
	MOV 38H,#0
	MOV 39H,#0
;        MOV 32H,#0
 ;       MOV 33H,#0
  ;      MOV 34H,#0
        LJMP MN0

DIS_DATE:   ;显示设定期限
          ;  MOV         EE240X_AD,#1H      ;第一页   ;显示设定期限
          ; MOV         EE240X_SUBA,#1  ;1-3   读设定限期
          ;MOV         EE240X_NUMBYT,#3
          ;MOV         EE240X_RDA,#32H
          ;LCALL       EE240X_RDNBYT
          ;lcall timgk
          ;lcall timgk
            MOV         EE240X_AD,#5H      ;第一页   ;显示设定期限
           MOV         EE240X_SUBA,#1  ;1-3   读设定限期
          MOV         EE240X_NUMBYT,#3
          MOV         EE240X_RDA,#32H
          LCALL       EE240X_RDNBYT
          lcall timl
          lcall timl
          lcall timl
          lcall timl

;        MOV R0,#32H
;       MOV DPTR,#FLASH_QX_ADDRESS
;       MOV R2,#3
;       LCALL FLASH_READ

;MOV DPTR,#BXSET_QX
;LCALL ZBXS
;	MOV COM,#95H
;	MOV R1,#32H
;	MOV R2,#6
;	LCALL DGCS
;	LCALL TIIL
;	LCALL TIIL
;	LCALL TIIL
 ;       LCALL TIIL
;MOV DPTR,#MAIN_B
;LCALL ZBXS
LCALL SON
	mov 37H,#0
	MOV 38H,#0
	MOV 39H,#0
;        MOV 32H,#0
 ;       MOV 33H,#0
  ;      MOV 34H,#0
        LJMP MN0

;	MOV COM,#84H
;MOV R1,#32H
;MOV R2,#3
;MOV R3,#2
;MOV 1AH,#2DH
;LCALL DISPT
;	CLR 1DH
;	CLR P3.2
;	MOV R7,#0B0H
;	LCALL TIM1
;	SETB P3.2
;	CLR 0FH
;	MOV 37H,#00H
;	MOV 38H,#00H
;	MOV 39H,#00H
;	RET
;	LJMP MN5

;ZHERR:LCALL SON
;LJMP MN0
;ZH:JB 1EH,ZHERR ;超期，无法进入编程
;      JB 0EH,ZHERR
;      MOV  COM,#01H
;        LCALL   WRI
;        LCALL   DELADY
;	MOV COM,#06H
;        LCALL   WRI
;        LCALL   DELADY
;	MOV DPTR,#BMM
;	LCALL HZBXS
;	MOV R1,#0B1H
;	MOV R2,#3
;QMM:	MOV @R1,#0
;	INC R1
;	DJNZ R2,QMM
;	SETB 23H
;	SETB 02H
;ZHQU:	LJMP MN0
LDJ:	LJMP LD
ALARL:LJMP ALAR
WRBCMM:	JNB 0FH,ALARL
	CLR 0FH
        MOV A,37H
        CJNE A,#90H,WBCMM1
        MOV A,38H
        CJNE A,#77H,WBCMM1
        MOV A,39H
        CJNE A,#66H,WBCMM1
        LJMP ALAR
WBCMM1:     MOV         EE240X_AD,#1H      ;设器件的三位可编程地址
            MOV         EE240X_SUBA,#4H   ;设器件子地址
            MOV         EE240X_NUMBYT,#3  ;写36字节数据
            MOV         EE240X_TDA,#37H     ;设发送缓冲区首址
            LCALL       EE240X_WRNBYT    ;写入数据
           lcall timgk
          lcall timgk
MOV R1,#0D8H
MOV A,#0
MOV @R1,A
;MOV DPTR,#MMZR
;LCALL ZBXS
;	LCALL TIIL
;	LCALL TIIL
;	LCALL TIIL
 ;       LCALL TIIL
;MOV DPTR,#MAIN_B
;LCALL ZBXS
MOV 31H,#066H
;LCALL DISP_SMG
;	MOV R7,#0FH
 ;       clr p3.2
;	LCALL TIM1
;	SETB P3.2
	mov 37H,#0
	MOV 38H,#0
	MOV 39H,#0
LCALL SON
        LJMP MN0
DATE:	JNB 0FH,ALAR
;   JB 02H,LDJ		;设定期限
;	JNB 0FH,DIS_DATE	;ALAR
	CLR 0FH

;            MOV         EE240X_AD,#1H      ;设器件的三位可编程地址
 ;           MOV         EE240X_SUBA,#1H   ;设器件子地址
  ;          MOV         EE240X_NUMBYT,#3  ;写36字节数据
   ;         MOV         EE240X_TDA,#37H     ;设发送缓冲区首址
    ;        LCALL       EE240X_WRNBYT    ;写入数据
     ;      lcall timgk
      ;    lcall timgk
            MOV         EE240X_AD,#5H      ;设器件的三位可编程地址
            MOV         EE240X_SUBA,#1H   ;设器件子地址
            MOV         EE240X_NUMBYT,#3  ;写36字节数据
            MOV         EE240X_TDA,#37H     ;设发送缓冲区首址
            LCALL       EE240X_WRNBYT    ;写入数据
           lcall timl
          lcall timl
          lcall timl
          lcall timl
          mov 72h,#0bdh
            MOV         EE240X_AD,#5H      ;设器件的三位可编程地址
            MOV         EE240X_SUBA,#10H   ;设器件子地址
            MOV         EE240X_NUMBYT,#1  ;写36字节数据
            MOV         EE240X_TDA,#72H     ;设发送缓冲区首址
            LCALL       EE240X_WRNBYT    ;写入数据
           lcall timl
          lcall timl
          lcall timl
          lcall timl


;	MOV 72H,#C12887_QX_ADDRESS
;	MOV R1,#37H
;WR6:    MOV TIME_ADDR,72h
;        MOV TIME_DATA,@R1
;        LCALL RTC_WRITE
;	INC 72H
;	INC R1
;	CJNE R1,#3AH,WR6

;	MOV 72H,#59		;93C46(66)中存已写入标志（1）
;	MOV 73H,#0BDH
;	LCALL WRITE0

;        MOV TIME_ADDR,#C12887_QXSET1_ADDRESS
 ;         MOV TIME_DATA,#0BDH
  ;        LCALL RTC_WRITE

	MOV R7,#0FH
;	CLR C
	CLR 1FH
 LCALL SON
	mov 37H,#0
	MOV 38H,#0
	MOV 39H,#0
;	LCALL DISPNUM
DMJ:	LJMP MN0
XYT86TO:MOV R0,#0D0H   ;读8031时间
	MOV 72H,#69                ;48T86(#69,#70,#71)
	MOV R1,#3

RCSXTO:	MOV TIME_ADDR,72H
         LCALL RTC_READ
        MOV A,TIME_DATA
	 MOV @R0,A
         INC 72H
         INC R0
         DJNZ R1,RCSXTO
CLR C
MOV R0,#0D0H
MOV A,@R0
MOV B,A
INC R0
MOV A,@R0
ADD A,B
MOV B,A
INC R0
MOV A,@R0
SUBB A,B
XRL A,#64H
JNZ XYERRTO
AJMP XYOKTO
XYERRTO:SETB 0EH
XYOKTO:RET
;PAP1:   JB 1EH,DMJ
;	JNB 18H,PF
;	LJMP MN0
;PAPE:   JNB 18H,PER
;	CLR 18H
;	CLR 09H
;PF:     MOV 1FH,#0AH            ;走纸
;	MOV 1EH,#0AH
;	MOV 1DH,#10H
;	LCALL PR
;	CLR 08H
;	LJMP MN0
;PER:    SETB 18H
;	CLR P3.3
;	LCALL TIML
;	SETB P3.3
;	LJMP MN0
ALAR:   SETB 0EH
	CLR p3.2
;lcall son
	LJMP MN0
;BT9:    JNB 0CH,ALAR
;	CLR 0CH
;	LJMP BT8
TIIL:   MOV R0,#24H
TL:     LCALL TIML
	LCALL TIML
	DJNZ R0,TL
	RET
;XCBXS:MOV COM,#82H	;显示位置
;LCALL WRI
;MOV 30H,2FH
;MOV A,30H			;*路参数
;ANL A,#0FH
;ADD A,#30H
;MOV DAT,A
;LCALL WRD
;MOV DAT,#20H
;LCALL WRD
;MOV DAT,#0C2H
;LCALL WRD
;MOV DAT,#0B7H
;LCALL WRD
;MOV DAT,#0B2H
;LCALL WRD
;MOV DAT,#0CEH
;LCALL WRD
;MOV DAT,#0CAH
;LCALL WRD
;MOV DAT,#0FDH
;LCALL WRD
;LCALL DELADY
;MOV DPTR,#BXCX
;LCALL HZBXS
;RET
XC_DL:	MOV A,#01H
	CJNE A,39H,XC_DCU1
	MOV 2EH,#4DH
	MOV 2DH,#3BH
	MOV 2CH,#59H
        MOV 2BH,#0C4H
        MOV 2FH,#1
	LJMP XC_DCU
XC_DCU1:   INC A
	CJNE A,39H,XC_DCU2
	MOV 2EH,#4FH
	MOV 2DH,#3EH
	MOV 2CH,#5BH
        MOV 2BH,#0C6H
MOV 2FH,#2
	LJMP XC_DCU
XC_DCU2:   INC A
	CJNE A,39H,XC_DCU3
	MOV 2EH,#51H
	MOV 2DH,#41H
	MOV 2CH,#5DH
        MOV 2BH,#0C8H
MOV 2FH,#3
	LJMP XC_DCU
XC_DCU3:   INC A
	CJNE A,39H,XC_DCU4
	MOV 2EH,#53H
	MOV 2DH,#44H
	MOV 2CH,#5FH
        MOV 2BH,#0CAH
MOV 2FH,#4
	LJMP XC_DCU
XC_DCU4:   INC A
	CJNE A,39H,XC_DCU5
	MOV 2EH,#55H
	MOV 2DH,#47H
	MOV 2CH,#61H
        MOV 2BH,#0CCH
MOV 2FH,#5
	LJMP XC_DCU
XC0L:LCALL SON
	MOV 35H,#0
	MOV 34H,#0
	MOV 33H,#0
	MOV 32H,#0
	MOV 31H,#0
	MOV 10H,#0
	MOV 3AH,#0
	MOV 39H,#0
	MOV 38H,#0
	MOV 37H,#0
	MOV 36H,#0
LJMP MN0
XC_DCU5:INC A
	CJNE A,39H,XC0L
	MOV 2EH,#57H
	MOV 2DH,#4AH
	MOV 2CH,#63H
        MOV 2BH,#0CEH
MOV 2FH,#6
XC_DCU:;MOV DPTR,#BXCX2
;LCALL ZBXS
;MOV COM,#80H	;显示位置
;LCALL WRI
;MOV 30H,2FH
;MOV A,30H			;*路参数
;ANL A,#0FH
;ADD A,#30H
;MOV DAT,A
;LCALL WRD
;MOV DAT,#23H
;LCALL WRD
;  	MOV R0,2EH
;	MOV 33H,@R0
;	INC R0
;	MOV 34H,@R0
;	INC R0
;	MOV 32H,#0
;	MOV 2EH,R0
;	MOV 10H,#5
;	MOV R1,#32H
;	MOV COM,#84H
;	MOV R2,#6
;	LCALL DGCS
;	MOV R0,2DH
;	MOV 32H,@R0
;	INC R0
;	MOV 33H,@R0
;	INC R0
;	MOV 34H,@R0
;	INC R0
;	MOV 2DH,R0
;	MOV 10H,#6
;	MOV COM,#94H
;	MOV R1,#32H
;	MOV R2,#6
;	LCALL DGCS
 ;
;	MOV R0,2CH
;	MOV 33H,@R0
;	INC R0
;	MOV 34H,@R0
;	INC R0
;	MOV 2CH,R0
;	MOV 10H,#3
;	MOV R1,#33H
;	MOV COM,#8DH
;	MOV R2,#4
;	LCALL DGCS
 ;
;	MOV R0,2BH
;	MOV 33H,@R0
;	INC R0
;	MOV 34H,@R0
;	INC R0
;	MOV 2BH,R0
;	MOV 10H,#3
;	MOV R1,#33H
;	MOV COM,#9DH
;	MOV R2,#4
;	LCALL DGCS
        MOV A,2FH
	SWAP A
	MOV 30H,A
	MOV 31H,30H
        ORL 31H,#0FH

	MOV R0,2EH
	MOV 33H,@R0
	INC R0
	MOV 34H,@R0
        ORL 32H,#0F0H
	INC R0
	MOV 2EH,R0
	MOV 10H,#5
	LCALL DISP_SMG
MOV A,#01H		;扫第一根行线
MOV R0,#JP_SEL			;键盘地址02H
MOVX @R0,A
lCALL TIML
MOV R0,#JP_READ
MOVX A,@R0
CJNE A,#10H, xccon1;
LJMP JMCLER2
xccon1:	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
        LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
;LCALL SON
	MOV R0,2DH
	MOV 32H,@R0
	INC R0
	MOV 33H,@R0
	INC R0
	MOV 34H,@R0
	INC R0
	MOV 2DH,R0
	MOV 10H,#6
	LCALL DISP_SMG
MOV A,#01H		;扫第一根行线
MOV R0,#02H		;键盘地址02H
MOVX @R0,A
lCALL TIML
MOV R0,#02H
MOVX A,@R0
CJNE A,#10H, xccon2;
LJMP JMCLER2

xccon2:	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
        LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
;LCALL SON
	MOV R0,2CH
        MOV 32H,#0FFH
	MOV 33H,@R0
	INC R0
	MOV 34H,@R0
	INC R0
	MOV 2CH,R0
	MOV 10H,#3
	LCALL DISP_SMG
MOV A,#01H		;扫第一根行线
MOV R0,#02H		;键盘地址02H
MOVX @R0,A
lCALL TIML
MOV R0,#02H
MOVX A,@R0
CJNE A,#10H, xccon3;
LJMP JMCLER2

xccon3:	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
        LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
;LCALL SON
	MOV R0,2BH
        MOV 32H,#0FFH
	MOV 33H,@R0
	INC R0
	MOV 34H,@R0
	INC R0
	MOV 2BH,R0
	MOV 10H,#3
	LCALL DISP_SMG
MOV A,#01H		;扫第一根行线
MOV R0,#02H		;键盘地址02H
MOVX @R0,A
lCALL TIML
MOV R0,#02H
MOVX A,@R0
CJNE A,#10H, xccon4;
LJMP JMCLER2

xccon4:	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
        LCALL SON

JMCLER2:	MOV 34H,#0
	MOV 33H,#0
	MOV 32H,#0
	MOV 31H,#0
	MOV 10H,#0
	CLR 05H
;        LCALL JLXS
CLR 0FH
        LJMP MN0
XC_DLL:LJMP XC_DL
XC:
JB 0FH,XC_DLL
LCALL TIML
LCALL TIML
LCALL TIML
XC0:   MOV 2FH,#01	;显示参数
	MOV 2EH,#4DH
	MOV 2DH,#3BH
	MOV 2CH,#59H
        MOV 2BH,#0C4H
;MOV DPTR,#BXCX2
;LCALL ZBXS

xc2:NOP
;MOV COM,#80H	;显示位置
;LCALL WRI
;MOV 30H,2FH
;MOV A,30H			;*路参数
;ANL A,#0FH
;ADD A,#30H
;MOV DAT,A
;LCALL WRD
;MOV DAT,#23H
;LCALL WRD
 ; 	MOV R0,2EH
;	MOV 33H,@R0
;	INC R0
;	MOV 34H,@R0
;	INC R0
;	MOV 32H,#0
;	MOV 2EH,R0
;	MOV 10H,#5
;	MOV R1,#32H
;;	MOV COM,#84H
;	MOV R2,#6
;	LCALL DGCS
;	MOV R0,2DH
;	MOV 32H,@R0
;	INC R0
;	MOV 33H,@R0
;	INC R0
;	MOV 34H,@R0
;	INC R0
;	MOV 2DH,R0
;	MOV 10H,#6
;	MOV COM,#94H
;	MOV R1,#32H
;	MOV R2,#6
;	LCALL DGCS

;	MOV R0,2CH
;	MOV 33H,@R0
;	INC R0
;	MOV 34H,@R0
;	INC R0
;	MOV 2CH,R0
;	MOV 10H,#3
;	MOV R1,#33H
;	MOV COM,#8DH
;	MOV R2,#4
;	LCALL DGCS

;	MOV R0,2BH
;	MOV 33H,@R0
;	INC R0
;	MOV 34H,@R0
;	INC R0
;	MOV 2BH,R0
;	MOV 10H,#3
;	MOV R1,#33H
;	MOV COM,#9DH
;	MOV R2,#4
;	LCALL DGCS
        MOV A,2FH
	SWAP A
	MOV 30H,A
	MOV 31H,30H
        ORL 31H,#0FH

	MOV R0,2EH
	MOV 33H,@R0
	INC R0
	MOV 34H,@R0
        MOV 32H,#0
        ORL 32H,#0F0H
	INC R0
	MOV 2EH,R0
	MOV 10H,#5
	LCALL DISP_SMG
MOV A,#01H		;扫第一根行线
MOV R0,#JP_SEL		;键盘地址02H
MOVX @R0,A
lCALL TIML
MOV R0,#JP_READ
MOVX A,@R0
CJNE A,#10H, XCCONT;
LJMP JMCLER
JMCLERL:LJMP JMCLER

XCCONT:	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6

;LCALL SON
	MOV R0,2DH
	MOV 32H,@R0
	INC R0
	MOV 33H,@R0
	INC R0
	MOV 34H,@R0
	INC R0
	MOV 2DH,R0
	MOV 10H,#6
	LCALL DISP_SMG
MOV A,#01H		;扫第一根行线
MOV R0,#JP_SEL		;键盘地址02H
MOVX @R0,A
lCALL TIML
MOV R0,#JP_READ
MOVX A,@R0
CJNE A,#10H, xccont2;
LJMP JMCLER
xcCONT2:LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
        LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6

;LCALL SON
	MOV R0,2CH
        MOV 32H,#0FFH
	MOV 33H,@R0
	INC R0
	MOV 34H,@R0
	INC R0
	MOV 2CH,R0
	MOV 10H,#3
	LCALL DISP_SMG
MOV A,#01H		;扫第一根行线
MOV R0,#JP_SEL		;键盘地址02H
MOVX @R0,A
lCALL TIML
MOV R0,#JP_READ
MOVX A,@R0
CJNE A,#10H,xcCONT3
LJMP JMCLER;
xcCONT3:LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
        LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6

;LCALL SON
	MOV R0,2BH
        MOV 32H,#0FFH
	MOV 33H,@R0
	INC R0
	MOV 34H,@R0
	INC R0
	MOV 2BH,R0
	MOV 10H,#3

	LCALL DISP_SMG
MOV A,#01H		;扫第一根行线
MOV R0,#JP_SEL		;键盘地址02H
MOVX @R0,A
lCALL TIML
MOV R0,#JP_READ
MOVX A,@R0
CJNE A,#10H,xcCONT4
LJMP JMCLER;

xcCONT4:LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
        LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6

;LCALL SON
XCNEXT: LCALL SON
	MOV A,2FH
	ADD A,#01H
	MOV 2FH,A
	MOV R0,2FH
	CJNE R0,#6,XC2L

	MOV R0,#0ddH
        MOV 32H,#0FFH
	MOV 33H,#0ffh
	mOV 34H,@R0
	MOV 10H,#0

	LCALL DISP_SMG
        LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
        LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
LCALL TIML6
	LCALL TIML6
;MOV DPTR,#BXYS
;LCALL ZBXS
;MOV R1,#0A4H
;mov 33h,@r1
;	MOV COM,#97H
;	MOV R2,#2
;mov 10h,#0
;MOV R1,#33H
;LCALL DGCS
;LCALL TIML
;LCALL TIML
JMCLER:	MOV 35H,#0
	MOV 34H,#0
	MOV 33H,#0
	MOV 32H,#0
	MOV 31H,#0
	MOV 10H,#0
	CLR 05H
;LCALL JLXS
SC4:    ljmp mn0;LJMP SWC4
XC2L:LJMP XC2
;JLXS:;MOV DPTR,#MAIN_B;#BXS
;BGSJB: ;	MOV DPTR,#BGSJ		;修改参数菜单
;	LCALL ZBXS
;RET

;BGCS:	MOV DPTR,#BGCSB		;修改参数菜单
;	LCALL ZBXS
;RET
;BCSSET:	MOV DPTR,#BPGSEL		;编程菜单
;	LCALL ZBXS
;RET
;SWBC:	JNB 23H,MDSET
;	CLR 23H
;	CLR 02H
;mov 10h,#0
;clr 20h
;LCALL JLXS
;	LJMP MN0
;LJMQT:CLR 2CH
;LCALL JLXS
;LJMP MN0
;MDSET:JNB 25H,DLSET	;修改参数
;		CLR 25H
;mov 10h,#0
;clr 20h
;	LCALL BGCS
;	SETB 2BH
;	LJMP MN0
;DLSET:JNB 26H,YLSET
;mov 10h,#0
;clr 20h
;	 CLR 26H
;	LCALL BGCS
;	SETB 2BH
;	LJMP MN0
;YLSET:JNB 27H,QRQSET
;	CLR 27H
;	LCALL BGCS
;	SETB 2BH
;	LJMP MN0
;YSSET:JNB 28H,GCQUIT
;	CLR 28H
;	ACALL BCSSET
;	SETB 24H
;	LJMP MN0
;QRQSET:JNB 2EH,QUSJSE
;	CLR 2EH
;	LCALL BGSJB
;	SETB 28H
;	LJMP MN0
;QUSJSE:JNB 2FH,QSJSET
;	CLR 2FH
;	LCALL BGSJB
;	SETB 28H
;	LJMP MN0
;QSJSET:JNB 29H,YSSET
;	CLR 29H
;	LCALL BGCS
;	SETB 24H
;	LJMP MN0
;YSSET:JNB 28H,GCQUIT
;	CLR 28H
;	LCALL BCSSET
;	SETB 24H
;	LJMP MN0
;GCQUIT:JNB 2BH,SWCDUP0
;	CLR 2BH
;	LCALL BCSSET
;	SETB 24H
;	LJMP MN0
;SWCDUP0:JNB 2AH,SWCDUP1
;	CLR 2AH
 ;       MOV 35H,#0
  ;      MOV 34H,#0
   ;     MOV 33H,#0
    ;    MOV 32H,#0
     ;   MOV 31H,#0
;	LCALL BCSSET
;	SETB 24H
;	LJMP MN0
;SWCDUP1:JNB 2DH,SWCDUP
;	CLR 2DH
;	LCALL BCSSET
;	SETB 24H
;	LJMP MN0
;SWCDUP:JNB 24H,QPTC
;	CLR 24H
;	CLR 02H
;QPTC:MOV DPTR,#MAIN_B;#BXS
;LCALL ZBXS
;mov 33h,#0
;LJMP MN0
swczz:Ljmp swcz
WRDATE:LJMP DATE
;LJMQTL:LJMP LJMQT
;SWBCL:LJMP SWBC

SWC_QUIT:JB 0FH,SWC2
         LJMP BT11
SWC:JB 02H,SWC_QUIT	;编程状态
	JB 1FH,WRDATE	;置入期限
        MOV R1,#0D8H    ;改编程密码
        MOV A,@R1
        CJNE A,#0A2H,SWNUMK
        LJMP WRBCMM
SWNUMK:	JB 0FH,SWC_BC	;有数字键按下
    CLR 09H
;JB 2CH,LJMQTL		;累计键按下
;SWCD:    JNB 22H,SWCT
;	CLR 22H
;	CLR 05H
;	MOV COM,#9EH
;	LCALL WRI
;	MOV DAT,#30H
;	LCALL WRD
;	LCALL WRD
	LJMP MN0
;SC4L:LJMP SWCZ  ;SC4
;SWWW:JNB 02H,SC4L
;LJMP BT11
;SWCT:        JNB 0CH,SWWW4
;        CLR 0CH
;        LJMP MN0
;SWWW4:  JNB 0DH,SWWCS
;	LJMP MN0
;SWWCS: LCALL TIML6
;LCALL TIML6
;LCALL TIML6
;LCALL TIML6
;LCALL TIML6
;LCALL TIML6
;mov a,#04h
;MOV R0,#02H
;MOVX @R0,A
;lCALL TIML
;MOV R0,#02H
;MOVX A,@R0
;CJNE A,#08H,xcfh
;LJMP XC
;XCFH:LJMP MN0
;JB 0FH,SWWW
;        LJMP XC
;SCS:nop
 ;   MOV A,1FH
	;CJNE A,#31H,SWC2
	;MOV A,1EH
	;CJNE A,#80H,SWC2
	;MOV A,1DH
	;CJNE A,#89H,SWC2
	;MOV A,#00H
;MOV R1,#5
;MOV R0,#9EH
;QZLJ:MOV @R0,A
;INC R0
;DJNZ R1,QZLJ
;	MOV 72H,#94
;	MOV 73H,A
;WR0:     LCALL WRITE0
;	INC 72H
;	MOV A,72H
;	CJNE A,#99,WR0
;	MOV 35H,#0
;	MOV 34H,#0
;	MOV 33H,#0
;	MOV 32H,#0
;	MOV 31H,#0
;	MOV R2,#0CH
;	MOV R0,#3CH
;CTOL:   MOV @R0,#0
;	DEC R0
;	DJNZ R2,CTOL
;	CLR P3.3
;	MOV R7,#9FH
;	LCALL TIM1
;	SETB P3.3
;	LJMP BT11
SWC2:   MOV A,39H
	JZ  CWS
	CLR 02H
	MOV 31H,#5FH
	MOV 32H,#0FFH
	MOV 33H,#0FFH
	MOV 34H,#0FFH
        MOV 36H,#0
        MOV 37H,#0
        MOV 38H,#0
        MOV 39H,#0
;	MOV 35H,#0FFH
        clr 0fh
        LCALL SON
CWS:    LJMP MN1
;SWC4:   MOV A,1FH
;	CJNE A,#18H,SWC1
;	MOV A,1EH
;	CJNE A,#40H,SWC1
;	JB 1EH,SWJJ
;	LJMP DPRJJ
SWJJ:LCALL SON
	LJMP MN0
sWC1:	Ljmp swcz
swc_bc:MOV A,39H
	CJNE A,#14H,SWC_BC3
	MOV A,38H
	CJNE A,#80H,SWC_BC3
	JB 1EH,SWJJ
	MOV 31H,#8FH
	MOV 32H,#0FFH
	MOV 33H,#0FFH
	MOV 34H,#0FFH
;	MOV 35H,#0FFH
	SETB 02H
        LCALL SON
SW2:    LJMP MN0
SWCZLL: LJMP SWCZ
DPRJJ:	LJMP DPRJ
SWC_BC3: MOV A,39H
	CJNE A,#16H,SWCZLL
	MOV A,38H
	CJNE A,#01H,SWCZLL
	MOV A,37H
	CJNE A,#26H,SWCZLL
MOV R2,#6
MOV R1,#3BH
WDLJ:MOV A,#0
MOV @R1,A
INC R1
MOV A,#12H
MOV @R1,A
INC R1
MOV A,#48H
MOV @R1,A
INC R1
DJNZ R2,WDLJ

MOV R2,#6
MOV R1,#4DH
WDLJ2:MOV A,#91H
MOV @R1,A
INC R1
MOV A,#96H
MOV @R1,A
INC R1
DJNZ R2,WDLJ2

MOV R2,#6
MOV R1,#59H
WDLJ0:MOV A,#0H
MOV @R1,A
INC R1
MOV A,#1H
MOV @R1,A
INC R1
DJNZ R2,WDLJ0

            MOV         EE240X_AD,#1H
            MOV         EE240X_SUBA,#0
            MOV         EE240X_NUMBYT,#16;8
            MOV         EE240X_TDA,#3BH
            LCALL       EE240X_WRNBYT
          lcall timl
          lcall timl
          lcall timl
          lcall timl
          lcall timl
          lcall timl
          lcall timl

            MOV         EE240X_AD,#1H
            MOV         EE240X_SUBA,#16;8
            MOV         EE240X_NUMBYT,#16;8
            MOV         EE240X_TDA,#4bh;43H
            LCALL       EE240X_WRNBYT
          lcall timl
          lcall timl
          lcall timl
          lcall timl
          lcall timl
          lcall timl
          lcall timl
            MOV         EE240X_AD,#1H
            MOV         EE240X_SUBA,#32;16
            MOV         EE240X_NUMBYT,#10;8
            MOV         EE240X_TDA,#5bh;4BH
            LCALL       EE240X_WRNBYT
          lcall timl
          lcall timl
          lcall timl
          lcall timl
          lcall timl
          lcall timl
          lcall timl


          lcall timgk
MOV R2,#6
MOV R1,#0C4H
WDLJ3:MOV A,#6H
MOV @R1,A
INC R1
MOV A,#80H
MOV @R1,A
INC R1
DJNZ R2,WDLJ3
            MOV         EE240X_AD,#1H
            MOV         EE240X_SUBA,#65;#20
            MOV         EE240X_NUMBYT,#12
            MOV         EE240X_TDA,#0C4H
            LCALL       EE240X_WRNBYT
       lcall timl
       lcall timl
       lcall timl
       lcall timl
          lcall timl
          lcall timl
          lcall timl
;	JB 1EH,SWJJ
	MOV 31H,#22H
	MOV 32H,#0FFH
	MOV 33H,#0FFH
	MOV 34H,#0FFH
        LCALL SON
        ljmp mn0
SWCZL:LJMP SWCZ
;swc_bc2:
;  ;       MOV         EE240X_AD,#1H      ;设器件的三位可编程地址
;  ;         MOV         EE240X_SUBA,#4  ;读
;  ;        MOV         EE240X_NUMBYT,#3
;  ;        MOV         EE240X_RDA,#2DH
;  ;        LCALL       EE240X_RDNBYT
;  ;        lcall timgk
;  ;        lcall timgk
;        MOV R0,#2DH
;       MOV DPTR,#FLASH_BCMM_ADDRESS   ;读编程密码
;       MOV R2,#3
;       LCALL FLASH_READ

;MOV R1,#37H
;MOV R0,#2DH
;	MOV A,@R1
;	XRL A,@R0
 ;       JNZ SWCZL;LJERR
;	INC R1
 ;       INC R0
;	MOV A,@R1

;	XRL A,@R0
 ;       JNZ SWCZL;LJERR
;	INC R1
 ;       INC R0
;	MOV A,@R1
 ;       XRL A,@R0
  ;      JNZ SWCZL;LJERR
;;	CLR 23H
;	JB 1EH,SWJJ
;	MOV 31H,#8FH
;	MOV 32H,#0FFH
;	MOV 33H,#0FFH
;	MOV 34H,#0FFH
;	SETB 02H
 ;       LCALL SON
  ;      LJMP    MN0
SWCZ: 	MOV A,39H		;置入期限
	CJNE A,#72H,SWCQ
	MOV A,38H
	CJNE A,#34H,SWCQ
	MOV A,37H
	CJNE A,#98H,SWCQ
        MOV         EE240X_AD,#5H      ;设器件的三位可编程地址
        MOV         EE240X_SUBA,#10;65;16  ;读单价
          MOV         EE240X_NUMBYT,#1;8
          MOV         EE240X_RDA,#72H
          LCALL       EE240x_RDNBYT
          lcall timl
          lcall timl
          lcall timl
          mov a,72h
        CJNE A,#0BDH,SWQ
	LJMP ALAR
SWQ:	SETB 1FH
	LJMP SWJJ
SWCQ:   MOV A,39H		;解除期限
	CJNE A,#85H,sxMM;SWC3
	MOV A,38H
	CJNE A,#71H,sxMM;SWC3
	MOV A,37H
	CJNE A,#34H,sxMM;SWC3
        MOV 69H,#99H
        MOV 6AH,#99H
        MOV 6BH,#99H
;WRQ:    MOV DPTR,#FLASH_QX_ADDRESS
;       MOV R2,#3
;       MOV R0,#69H
;       LCALL FLASH_WRITE
            MOV         EE240X_AD,#5H
            MOV         EE240X_SUBA,#1;8
            MOV         EE240X_NUMBYT,#3;8
            MOV         EE240X_TDA,#69h;43H
            LCALL       EE240X_WRNBYT
          lcall timl
          lcall timl
          lcall timl
          lcall timl


;            MOV         EE240X_AD,#01H      ;设器件的三位可编程地址
;            MOV         EE240X_SUBA ,#01H   ;设器件子地址
;            MOV         EE240X_NUMBYT,#3  ;写36字节数据
;            MOV         EE240X_TDA,#69H     ;设发送缓冲区首址
;            LCALL       EE240X_WRNBYT    ;写入数据
;           lcall timgk
;          lcall timgk
	CLR 1EH
        mov 72h,#0
          MOV         EE240X_AD,#5H      ;
           MOV         EE240X_SUBA,#10  ;1-3   读设定限期
          MOV         EE240X_NUMBYT,#1
            MOV         EE240X_TDA,#72h;43H
            LCALL       EE240X_WRNBYT
          lcall timl
          lcall timl
          lcall timl
          lcall timl
          mov 72h,#0abh
          MOV         EE240X_AD,#5H      ;
           MOV         EE240X_SUBA,#11  ;1-3   读设定限期
          MOV         EE240X_NUMBYT,#1
            MOV         EE240X_TDA,#72h;43H
            LCALL       EE240X_WRNBYT
          lcall timl
          lcall timl
          lcall timl
          lcall timl
	LCALL SON
	LJMP GOOD1

SXMM:  MOV A,39H
	CJNE A,#66H,sx99
	MOV A,38H
	CJNE A,#77H,sx99
	MOV A,37H
	CJNE A,#90H,sx99

        MOV R1,#0D8H
        MOV A,#0A2H
        MOV @R1,A
;MOV DPTR,#SRMM
;LCALL ZBXS
;	LCALL TIIL
;	LCALL TIIL
;	LCALL TIIL
 ;       LCALL TIIL
  ;      LCALL SON
;MOV DPTR,#MAIN_B
;LCALL ZBXS
       MOV 31H,#22H
	mov 37H,#0H
	MOV 38H,#0
	MOV 39H,#0
LCALL SON
        LJMP MN0

SX99:  MOV A,39H		;解除期限
       MOV R0,#0A6H
       MOV B,@R0
	CJNE A,B,sx77

	MOV A,38H
        INC R0
        MOV B,@R0
	CJNE A,B,sx77
	MOV A,37H
        INC R0
        MOV B,@R0
	CJNE A,B,sx77
        MOV 69H,#99H
        MOV 6AH,#99H
        MOV 6BH,#99H
            MOV         EE240X_AD,#05H      ;设器件的三位可编程地址
            MOV         EE240X_SUBA ,#01H   ;设器件子地址
            MOV         EE240X_NUMBYT,#3  ;写3字节数据
            MOV         EE240X_TDA,#69H     ;设发送缓冲区首址
            LCALL       EE240X_WRNBYT    ;写入数据

;            MOV         EE240X_AD,#01H      ;设器件的三位可编程地址
;            MOV         EE240X_SUBA ,#01H   ;设器件子地址
;            MOV         EE240X_NUMBYT,#3  ;写3字节数据
;            MOV         EE240X_TDA,#69H     ;设发送缓冲区首址
;            LCALL       EE240X_WRNBYT    ;写入数据
;       MOV DPTR,#FLASH_QX_ADDRESS
;       MOV R2,#3
;       MOV R0,#69H
;       LCALL FLASH_WRITE
            MOV         EE240X_AD,#05H      ;设器件的三位可编程地址
            MOV         EE240X_SUBA ,#10H   ;设器件子地址
            MOV         EE240X_NUMBYT,#1  ;写3字节数据
            MOV         EE240X_TDA,#72H     ;设发送缓冲区首址
            LCALL       EE240X_WRNBYT    ;写入数据
           lcall timl
          lcall timl
           lcall timl
          lcall timl

        mov 72h,#0abh
            MOV         EE240X_AD,#05H      ;设器件的三位可编程地址
            MOV         EE240X_SUBA ,#11H   ;设器件子地址
            MOV         EE240X_NUMBYT,#1  ;写3字节数据
            MOV         EE240X_TDA,#72H     ;设发送缓冲区首址
            LCALL       EE240X_WRNBYT    ;写入数据
           lcall timl
          lcall timl
           lcall timl
          lcall timl

;MOV 72H,#c12887_QX_ADDRESS
;	MOV R1,#69H
;RDWQX2:   MOV TIME_ADDR,72h
;          MOV TIME_DATA,@R1
;          LCALL RTC_WRITE
;	INC 72H
;	INC R1
;      CJNE R1,#6CH,RDWQX2

           lcall timgk
          lcall timgk
	CLR 1EH
	LCALL SON
	LJMP GOOD1

SXDAL:LJMP SXDA
SX77:MOV A,39H		;解除期限
       MOV R0,#0A9H
       MOV B,@R0
	CJNE A,B,sxDAL
	MOV A,38H
        INC R0
        MOV B,@R0
	CJNE A,B,sxDAL
	MOV A,37H
        INC R0
        MOV B,@R0
	CJNE A,B,sxDAL
mov r0,#34h
lcall get1302_rq
        MOV A,33H
        CJNE A,#12H,NNJ1
        INC 32H

        LJMP SXSR
NNJ1:   INC 33H

SXSR:   MOV 69H,32H
        MOV 6AH,33H
        MOV 6BH,34H
;            MOV         EE240X_AD,#01H      ;设器件的三位可编程地址
;            MOV         EE240X_SUBA ,#01H   ;设器件子地址
;            MOV         EE240X_NUMBYT,#3  ;写36字节数据
;            MOV         EE240X_TDA,#69H     ;设发送缓冲区首址
;            LCALL       EE240X_WRNBYT    ;写入数据
;          lcall timgk
;          lcall timgk
;       MOV DPTR,#FLASH_QX_ADDRESS
;       MOV R2,#3
;       MOV R0,#69H
;       LCALL FLASH_WRITE
            MOV         EE240X_AD,#05H      ;设器件的三位可编程地址
            MOV         EE240X_SUBA ,#01H   ;设器件子地址
            MOV         EE240X_NUMBYT,#3  ;写36字节数据
            MOV         EE240X_TDA,#69H     ;设发送缓冲区首址
            LCALL       EE240X_WRNBYT    ;写入数据
          lcall timl
          lcall timl
          lcall timl
          lcall timl

	CLR 1EH
	LCALL SON
	LJMP GOOD
SW22L:LJMP SW22


Sxda:   MOV A,39H		;查看期限
	CJNE A,#63H,SW_DMM
	MOV A,38H
	CJNE A,#9H,SW_DMM
	MOV A,37H
	CJNE A,#00H,SW_DMM
        LJMP  DIS_DATE
;	LJMP MN5
SW_DMM:   MOV A,39H		;查看编程密码
	CJNE A,#76H,SW_CMM
	MOV A,38H
	CJNE A,#98H,SW_CMM
	MOV A,37H
	CJNE A,#00H,SW_CMM
	LJMP DIS_DMM
SW_CMM:   MOV A,39H		;查看编程密码
	CJNE A,#66H,SWC3
	MOV A,38H
	CJNE A,#33H,SWC3
	MOV A,37H
	CJNE A,#11H,SWC3

       MOV 32H,#88H
       MOV 33H,#88H
       MOV 34H,#88H
;       MOV         EE240X_AD,#1H      ;设器件的三位可编程地址
;            MOV         EE240X_SUBA,#4H   ;设器件子地址
;            MOV         EE240X_NUMBYT,#3  ;写36字节数据
;            MOV         EE240X_TDA,#32H     ;设发送缓冲区首址
;            LCALL       EE240X_WRNBYT    ;写入数据
       MOV DPTR,#FLASH_BCMM_ADDRESS
       MOV R2,#3
       MOV R0,#3DH
       LCALL FLASH_WRITE

;           lcall timgk
;          lcall timgk
          LCALL SON
       MOV 32H,#0H
       MOV 33H,#0H
       MOV 34H,#0H
       LJMP MN0
SWC3:   MOV A,39H
	CJNE A,#42H,SWC8
	MOV A,38H
	CJNE A,#40H,SWC8
	JB 1EH,SWJJL
	SETB 18H
        MOV 72H,#97H       ;打印机关
LCALL SEND_PR
LCALL TIIL
       MOV 72H,#97H
LCALL SEND_PR

clr 0fh
        lcall son
	LJMP BT11
sw22:	ljmp sw2
SWJJL:LJMP SWJJ
SWJ2:	LJMP MN0
SWC8:   MOV A,1FH
	CJNE A,#27H,SW22
	MOV A,1EH
	CJNE A,#10H,SW22
	MOV A,1DH
	CJNE A,#95H,SW22
	JB 1EH,SWJ2
	MOV A,#00H
	MOV 37H,A
	MOV 38H,A
	MOV 39H,A
;	MOV 72H,#7
;	MOV 73H,A
;WR11:   LCALL WRITE0
;	INC 72H
;	MOV A,72H
;	CJNE A,#10,WR11
	LJMP BT11
CPAL:   LJMP ALAR
LD11:   LJMP LD1
CP:     JNB 0FH,CPAL
	CLR 09H
	MOV A,10H
	JNZ LD11
        MOV R1,#32H;#0B1H
	MOV 1cH,@R1
        INC R1
	MOV 1DH,@R1
        INC R1
	MOV 1eH,@R1
        MOV 1BH,#0
        MOV 1FH,#0
	SETB 10H
;        MOV 31H,#09FH
         clr 0fh
	LJMP MN001
QQD: JNB 0FH,LD1
	JNB 6DH,QQD1
QQD1: LJMP MN0
QD:  JNB 0FH,LD1             ;p20
	MOV R7,10H
	MOV A,R7
	JZ LD1
	DEC R7
	MOV A,R7
	JZ LD1
	CLR C
	SUBB A,#05H
	JNC LD1
	SETB 11H
QD1: MOV A,#04H
	XRL A,R7
	JZ VD1
	MOV R1,#37H
	MOV R0,#38H
	MOV 18H,#03H
	LCALL RSD
	INC R7
	ANL 39H,#0F0H
	LJMP QD1
VD:     JNB 0FH,LD1             ;v
	MOV R7,10H
	MOV A,R7
	JZ VD2
	DEC R7
	MOV A,R7
	JZ VD2
	CLR C
	SUBB A,#06H
	JNC LD1
VD2:    SETB 12H
VD3:    MOV A,#05H
	XRL A,R7
	JZ VD1
	MOV R1,#37H
	MOV R0,#38H
	MOV 18H,#03H
	LCALL RSD
	ANL 39H,#0F0H
	INC R7
	LJMP VD3
VD1:    MOV 0FH,39H
	MOV 0EH,38H
	MOV 0DH,37H
	JB 13H,PDZ
 	MOV A,0FH
	JNZ PDZ
	MOV A,0EH
	JNZ PDZ
	MOV A,0DH
	JZ FF
PDZ:    CLR 05H
	SETB 17H
        LJMP MN0
LD1:    LJMP ALAR
LD:     JNB 0FH,LD1
	MOV R7,10H
	MOV A,R7
	JZ LD2
	DEC R7
	MOV A,R7
	JZ LD2
	CLR C
	SUBB A,#03H
	JNC LD1
LD2:    SETB 13H
LD3:    MOV A,#02H
	XRL A,R7
	JZ VD1
	MOV R1,#37H
	MOV R0,#38H
	MOV 18H,#03H
	LCALL RSD
	ANL 39H,#0F0H
	INC R7
	LJMP LD3
DJ1:    LJMP ALAR
DJ:     JNB 0FH,DJ1
	MOV R7,10H
	MOV A,R7
	JZ DJ2
	DEC R7
	MOV A,R7
	JZ DJ2
	CLR C
	SUBB A,#03H
	JNC DJ1
DJ2:    SETB 29H        ; 按下单价键
DJ3:    MOV A,#02H
	XRL A,R7
	JZ VD1
	MOV R1,#37H
	MOV R0,#38H
	MOV 18H,#03H
	LCALL RSD
	ANL 39H,#0F0H
	INC R7
	LJMP DJ3
FF:     LJMP ALAR
D1:     MOV 30H,#01H
        MOV B,#10H
	MOV R1,#3BH
	MOV R2,#4DH
	MOV R3,#59H
      ;  MOV R5,#0C4H
      MOV DAT,#0C4H
	LJMP CCC
D2:     MOV 30H,#02H
        MOV B,#20H
	MOV R1,#3EH
	MOV R2,#4FH
	MOV R3,#5BH
;        MOV R5,#0C6H
      MOV DAT,#0C6H
	LJMP CCC
D3:     MOV 30H,#03H
        MOV B,#40H
	MOV R1,#41H
	MOV R2,#51H
	MOV R3,#5DH
;        MOV R5,#0C8H
      MOV DAT,#0C8H
	LJMP CCC
D4:     MOV 30H,#04H
        MOV B,#80H
	MOV R1,#44H
	MOV R2,#53H
	MOV R3,#5FH
;        MOV R5,#0CAH
      MOV DAT,#0CAH
	LJMP CCC
D5:  MOV 30H,#05H
	MOV R1,#47H
	MOV R2,#55H
	MOV R3,#61H
;        MOV R5,#0CCH
      MOV DAT,#0CCH
	LJMP CCC
BB1L:LJMP BB1
D6:jnb 0fh,ff
clr 0fh
     MOV         EE240X_AD,#1H      ;设器件的三位可编程地址
            MOV         EE240X_SUBA,#4H   ;设器件子地址
            MOV         EE240X_NUMBYT,#1  ;写36字节数据
            MOV         EE240X_TDA,#39H     ;设发送缓冲区首址
            LCALL       EE240X_WRNBYT    ;写入数据
           lcall timgk
          lcall timgk
mov a,39h
MOV R1,#0DdH
MOV @R1,A
MOV 31H,#066H
	MOV 39H,#0
LCALL SON
        LJMP MN0


;MOV 30H,#06H
;	MOV R1,#4AH
;	MOV R2,#57H
;	MOV R3,#63H
;        MOV R5,#0CEH
;      MOV DAT,#0CEH
CCC:;JB 29H,LD1
;JNB 26H,BB1L
    JNB 12H,BB1L
;MOV A,R1
;mov r4,A
;LCALL VD
;MOV A,R4
;MOV R1,A

;	MOV A,#0B0H
;MOV A,0DH
;ANL A,#0FH      ;清除高位，只保留小数点后的数
;MOV 0DH,A

	MOV A,#0B0H
	MOV @R1,0DH
	INC R1
D100:   MOV 22H,#00H
	MOV @R1,0EH
	INC R1
	MOV @R1,0FH


	MOV A,30H
        SWAP A
        ORL A,#0FH
	MOV 31H,A


	SETB 17H
; MOV R0,#0ACH
; MOV A,@R0
; XRL A,#39H
; JZ WCS2L
;	MOV 72H,#14

            MOV         EE240X_AD,#1H
            MOV         EE240X_SUBA,#0
            MOV         EE240X_NUMBYT,#16;8
            MOV         EE240X_TDA,#3BH
            LCALL       EE240X_WRNBYT
          lcall timl
          lcall timl
          lcall timl
          lcall timl
            MOV         EE240X_AD,#1H
            MOV         EE240X_SUBA,#16;8
            MOV         EE240X_NUMBYT,#16;8
            MOV         EE240X_TDA,#4bh;43H
            LCALL       EE240X_WRNBYT
          lcall timl
          lcall timl
          lcall timl
          lcall timl
            MOV         EE240X_AD,#1H
            MOV         EE240X_SUBA,#32;16
            MOV         EE240X_NUMBYT,#10;8
            MOV         EE240X_TDA,#5bh;4BH
            LCALL       EE240X_WRNBYT
          lcall timl
          lcall timl
          lcall timl
          lcall timl
            MOV         EE240X_AD,#1H
           MOV         EE240X_SUBA,#65;#20
            MOV         EE240X_NUMBYT,#12
            MOV         EE240X_TDA,#0C4H
            LCALL       EE240X_WRNBYT
       lcall timl
       lcall timl

 ;      MOV DPTR,#FLASH_CS1_ADDRESS
 ;      MOV R2,#42
 ;      MOV R0,#3BH
 ;      LCALL FLASH_WRITE
 ;      lcall timgk

;            MOV         EE240X_AD,#2H
;            MOV         EE240X_SUBA,#0
;            MOV         EE240X_NUMBYT,#8
;            MOV         EE240X_TDA,#3BH
;            LCALL       EE240X_WRNBYT

;          lcall timgk
;       lcall timgk
;          lcall timgk
;            MOV         EE240X_AD,#2H
;            MOV         EE240X_SUBA,#8
;            MOV         EE240X_NUMBYT,#8
;            MOV         EE240X_TDA,#43H
;            LCALL       EE240X_WRNBYT
;       lcall timgk
;          lcall timgk
;       lcall timgk
;          lcall timgk
;            MOV         EE240X_AD,#2H
;            MOV         EE240X_SUBA,#16
;            MOV         EE240X_NUMBYT,#8
;            MOV         EE240X_TDA,#4BH
;            LCALL       EE240X_WRNBYT
;       lcall timgk
;          lcall timgk
;                 lcall timgk
;          lcall timgk
;            MOV         EE240X_AD,#2H
;            MOV         EE240X_SUBA,#24
;            MOV         EE240X_NUMBYT,#8
;            MOV         EE240X_TDA,#53H
;            LCALL       EE240X_WRNBYT
;       lcall timgk
;          lcall timgk
;                 lcall timgk
;          lcall timgk
;            MOV         EE240X_AD,#2H
;            MOV         EE240X_SUBA,#32
;            MOV         EE240X_NUMBYT,#8;#10
;            MOV         EE240X_TDA,#5BH
;            LCALL       EE240X_WRNBYT
;       lcall timgk
;          lcall timgk
;                 lcall timgk
;          lcall timgk
;            MOV         EE240X_AD,#2H
;            MOV         EE240X_SUBA,#40;#32
;            MOV         EE240X_NUMBYT,#2
;            MOV         EE240X_TDA,#63H;#5BH
;            LCALL       EE240X_WRNBYT
;       lcall timgk
;          lcall timgk
;                 lcall timgk
          lcall timgk

;	MOV R0,#3BH
;RD4:   MOV TIME_ADDR,72h
;          MOV TIME_DATA,@R0
;          LCALL RTC_WRITE
;	INC 72H
;	INC R0
;      CJNE R0,#65H,RD4
;LJMP MN0

; MOV DPTR,#FLASH_DJ1_ADDRESS
;       MOV R2,#12
;       MOV R0,#0C4H
;       LCALL FLASH_WRITE
;        lcall timgk
;       lcall timgk
          lcall timgk
          lcall timgk
;          LJMP WCSOVER
;WCS2L:       MOV DPTR,#FLASH_CS2_ADDRESS
;       MOV R2,#42
;       MOV R0,#3BH
;       LCALL FLASH_WRITE
;          lcall timgk
;          lcall timgk

;MOV DPTR,#FLASH_DJ2_ADDRESS
;       MOV R2,#12
;       MOV R0,#0C4H
;       LCALL FLASH_WRITE

;            MOV         EE240X_AD,#1H
 ;           MOV         EE240X_SUBA,#16;#20
  ;          MOV         EE240X_NUMBYT,#8
   ;         MOV         EE240X_TDA,#0C4H
    ;        LCALL       EE240X_WRNBYT
     ;  lcall timgk
      ;    lcall timgk
       ;lcall timgk
        ;  lcall timgk
         ;   MOV         EE240X_AD,#1H
          ;  MOV         EE240X_SUBA,#24;#20
           ; MOV         EE240X_NUMBYT,#4
            ;MOV         EE240X_TDA,#0CCH
;            LCALL       EE240X_WRNBYT
 ;      lcall timgk
  ;        lcall timgk
   ;    lcall timgk
    ;      lcall timgk
WCSOVER:CLR 05H
;MOV 10H,#0

LCALL SON
LCALL TIML
mov 37h,#0
MOV 38H,#0
MOV 39H,#0

;mov 31h,#0
;MOV 32H,#0
;MOV 33H,#0
;mov 34h,#0
;MOV 35H,#0
;JB 25H,GMDLD
;JB 26H,GDLLD
;JB 27H,GYLLD
;JB 29H,GDJLD
LJMP MN0

;GMDLD:LJMP GMD
;GDLLD:LJMP GDL
;GYLLD:LJMP GYL
;GDJLD:LJMP GDJ
DPL2L:LJMP DPL2
BB1: ;JNB 25H,DPL2
JNB 11H,DPL2L
	MOV R1,02H
	MOV A,#0C0H
	LJMP D100

;LCALL QD
;MOV R1,02H
;	LJMP D100
DPL2:;JNB 27H,DPL20
;LCALL LD
JNB 13H,DPL20;3
	MOV R1,03H
	MOV A,#0A0H
	LJMP D100

;MOV R1,03H
;	LJMP D100
DPL20:JNB 29H,DPL3
;LCALL LD
       MOV R1,DAT;05H
	LJMP D100
DPL9:   LJMP LD1
DPL3:   JNB 10H,DPL9	;10=1,脉冲计数标志
;	MOV A,B
	CLR C
;	MOV A,#01H
;	CJNE A,30H,DPL5
;CLR JDQ_1
;	LJMP D200
;DPL5:   INC A
;	CJNE A,30H,DPL6
;CLR JDQ_1
;	LJMP D200
;DPL6:   INC A
;	CJNE A,30H,DPL7
;CLR JDQ_1
;	LJMP D200
;DPL4:   LJMP LD1
;DPL7:   INC A
;	CJNE A,30H,DPLL5
;CLR JDQ_1
;	LJMP D200
;DPLL5:INC A
;CJNE A,30H,DPLL6
;CLR JDQ_1
;LJMP D200
;DPLL6:INC A
;CJNE A,30H,DPL4
;CLR JDQ_1
;CLR LED_QD
SETB LED_QD
;//////////////////////////////
;MOV R0,#0ACH  ;选1路还是2路
;MOV A,@R0
;XRL A,#39H
;JNZ JDQSE1
;CLR JDQ_2
;ljmp d200
JDQSE1: CLR JDQ_1
;////////////////////////////
D200:;MOV COM,#90H
     ;    LCALL WRI
      ;   MOV DPTR,#BDMC
      ;   LCALL HZBXS
;        MOV 76H,#00H
	MOV 77H,#00H
	MOV 78H,#00H
	MOV 79H,#00H
	SETB TR0
	CLR TF0
DPL8:   MOV TH0,#0FFH
	MOV TL0,#0FFH
	JNB P3.2,INTC
	JNB TF0,DPL8
	CLR TF0
	MOV A,79H
	ADD A,#01H
	DA A
	MOV 79H,A
	MOV A,78H
	ADDC A,#00H
	DA A
	MOV 78H,A
	MOV A,77H
	ADDC A,#00H
	DA A
	MOV 77H,A
;	MOV A,76H
;	ADDC A,#00H
;	DA A
;	MOV 76H,A

	MOV 34H,79H
	MOV 33H,78H
	MOV 32H,77H

;	MOV 31H,76H
;	MOV 10H,#00H
;        MOV R1,#32H
 ;       MOV R2,#3
  ;      MOV COM,#93H
   ;     LCALL DISNW0
;	LCALL DISPNUM
        LCALL DISP_SMG
	MOV A,79H
	XRL A,1EH
	JNZ DPL8
	MOV A,78H
	XRL A,1DH
	JNZ DPL8
	MOV A,77H
	XRL A,1CH
	JNZ DPL8
;	MOV A,76H
;	XRL A,1BH
;	JNZ DPL8
INTC:   SETB JDQ_1
        SETB JDQ_2
;SETB LED_QD
clr LED_QD
	SETB ET0
	MOV TH0,#0FFH
	MOV TL0,#0FFH
	MOV R2,#050
TMPC:   MOV R7,#0FFH
	LCALL TIM1
	DJNZ R2,TMPC
	CLR ET0
;	MOV 10H,#00H

;        MOV R1,#0B1H
;	MOV @R1,77H
 ;       INC R1
;	MOV @R1,78H
;        INC R1
;	MOV @R1,79H
	MOV 32H,77H
	MOV 33H,78H
	MOV 34H,79H
;	MOV 1CH,29H

;	MOV 72H,#119
;	MOV 73H,76H
;	LCALL WRITE0
            MOV         EE240X_AD,#3H
            MOV         EE240X_SUBA,#40
            MOV         EE240X_NUMBYT,#5
            MOV         EE240X_TDA,#76h
            LCALL       EE240X_WRNBYT
       lcall timl
          lcall timl
       lcall timl
          lcall timl

 ;       MOV 73H,7AH
  ;      INC 72H
   ;     LCALL WRITE0
	JB 18H,HH
LCALL SON
MOV R1,#0BBH
MOV R0,#77H
MOV R2,#3
MCDYS:MOV A,@R0
MOV @R1,A
INC R1
INC R0
DJNZ R2,MCDYS
MOV R1,#0BBH
MOV DPTR,#PDMC
LCALL PRINT
lcall timl6
LCALL PTD
lcall timl6
MOV DPTR,#PPM
LCALL PRINT
;        MOV R1,#0B1H
 ;       MOV R2,#3
  ;      MOV COM,#93H
   ;     LCALL DISNW0
LJMP HH
	MOV 07H,79H
	MOV 06H,78H
	MOV 05H,77H
	MOV 04H,#0AAH
	MOV 03H,#0AAH
	MOV 02H,30H
	LCALL PRM
	LCALL PRR
	MOV 1FH,#0AH
	MOV 1EH,#0AH
	LCALL PR
 LCALL PRDATE
       	MOV 22H,#00H
HH:        LJMP MN0
JTPI:   LJMP TPI
TMI0:   CLR 09H
	JNB 02H,JTPI
	CLR ET0
	PUSH PSW
	PUSH 0E0H
	MOV A,79H
	ADD A,#01H
	DA A
	MOV 79H,A
	MOV A,78H
	ADDC A,#00H
	DA A
	MOV 78H,A
	MOV A,77H
	ADDC A,#00H
	DA A
	MOV 77H,A
;	MOV A,76H
;	ADDC A,#00H
;	DA A
;	MOV 76H,A
	MOV TH0,#0FFH
	MOV TL0,#0FFH
	POP 0E0H
	POP PSW
	SETB ET0
	RETI
PPD:    JB 0FH,PPD1
         JB 22H,DMJ1
        JB 02H,DMJ1
PAP1:   JB 1EH,DMJ1
	JNB 18H,PF
DMJ1:	LJMP MN0

PAPE:   JNB 18H,PER
	CLR 18H
	CLR 09H
PF:     MOV 1FH,#0AH            ;走纸
	MOV 1EH,#0AH
	MOV 1DH,#10H
	LCALL PR
	CLR 08H
	LJMP MN0
PER:    SETB 18H
	CLR P3.2
	LCALL TIML
	SETB P3.2
	LJMP MN0
PPD1:   LJMP DPD
JJJ:    LJMP alar;DCLT
DMN:LCALL SON
LJMP MN0
D1L:LJMP D1
DC1:JB 02H,D1L
   JB 1EH,DMN
	CLR 22H
	MOV 30H,#01H
	;CLR 1BH
	JB 0CH,BT3
	JNB 07H,JJJ	;未有定量标志，转温度
	JB 0FH,DC1_CS	;未按数字键，报警
        MOV 74H,#0
        MOV 75H,#99H;#1
        AJMP DC1_F
DC1_CS:	MOV 74H,#00H
	MOV R1,#39H
	MOV 75H,@R1
DC1_F:	SETB 0CH
	MOV R1,#0BBH
	MOV @R1,30H
BT3: 	MOV A,#10H
	LJMP D400
DCLTL:LJMP ALAR
DC2:	JB 1EH,DMN
	CLR 22H
	 MOV 30H,#02H
	JB 0cH,BT32
	JNB 07H,DCLTL
	JB 0FH,DC1_CS	;未按数字键，报警
        MOV 74H,#0
        MOV 75H,#99H;#1
        AJMP DC2_F
DC2_CS:	MOV 74H,#00H
	MOV R1,#39H
	MOV 75H,@R1
DC2_F:	SETB 0cH
	MOV R1,#0BBH
	MOV @R1,30H
BT32:	MOV A,#20H
	LJMP D400
DC31:   LJMP ALAR
DC3:   JB 1EH,DMN
       CLR 22H
	MOV 30H,#03H
	JB 0CH,BT33
       JNB 07H,DCLTL
	JB 0FH,DC3_CS	;未按数字键，报警
        MOV 74H,#0
        MOV 75H,#99H;#1;#99H
        AJMP DC3_F
DC3_CS:	MOV 74H,#00H
	MOV R1,#39H
	MOV 75H,@R1
DC3_F:	SETB 0cH
	MOV R1,#0BBH
	MOV @R1,30H
BT33:	MOV A,#40H
	LJMP D400
DCL1L:LJMP DCL1
DC1D:LJMP DC10
DC4:   JB 1EH,DMNL
	CLR 22H
	MOV 30H,#04H
	;CLR 1BH
	JB 0CH,BT34
	JNB 07H,DCLTL
	JB 0FH,DC4_CS
        MOV 74H,#0
        MOV 75H,#99H;#1;#99H
        lJMP DC4_F
DC4_CS: MOV 74h,#0
	MOV R1,#39H
	MOV 75H,@R1
DC4_F:	SETB 0CH
	MOV R1,#0BBH
	MOV @R1,30H
BT34:	MOV A,#80H
	LJMP D400
DMNN:LJMP DMN
JJJJ:LJMP ALAR;JJJ
DCLT:LJMP ALAR;DCL
DMNL:LJMP DMN
DC5:   JB 1EH,DMNN
CLR 22H
	MOV 30H,#05H
	;CLR 1BH
	JB 0CH,BT35
	JNB 07H,JJJJ
	JB 0FH,DC5_CS
        MOV 74H,#0
        MOV 75H,#99H;#1;#99H
        LJMP DC5_F
DC5_CS:	MOV 74H,#00H
	MOV R1,#39H
	MOV 75H,@R1
DC5_F:	SETB 0CH
	MOV R1,#0BBH
	MOV @R1,30H
BT35:	MOV A,#10H
	LJMP D400
DC1DL2:LJMP DC10
DC6:	MOV R0,#0ddH
        MOV 32H,#0FFH
	MOV 33H,#0ffh
	mOV 34H,@R0
	MOV 10H,#0
	LCALL DISP_SMG
LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
ljmp mn0
;JB 1EH,DMNN
;       CLR 22H;
;	MOV 30H,#06H
;	JB 0CH,BT36
;	JNB 07H,JJJJ
;	JB 0FH,DC6_CS
 ;       MOV 74H,#0
  ;      MOV 75H,#99H;#1;#99H
 ;       LJMP DC6_F
DC6_CS:	MOV 74H,#00H
	MOV R1,#39H
	MOV 75H,@R1
DC6_F:        SETB 0CH
	MOV R1,#0BBH
	MOV @R1,30H
BT36:   MOV A,#10H
	LJMP D400
DC10:   CLR 07H
	CLR 0FH
;SETB LED_QD
clr LED_QD
        SETB JDQ_1
        SETB JDQ_2
DCL1:   LJMP ALAR
DCTD:   LJMP TD
DCL:    JB 14H,DCTD	;转温度
	LJMP ALAR
D400:NOP
;lcall XYT86TO;   二次密码效验
;
;CLR LED_QD
SETB LED_QD
;////////////////////////////////
;MOV R0,#0ACH  ;选1路还是2路
;MOV A,@R0
;XRL A,#39H
;JNZ JDQSEL1
;CLR JDQ_2
;ljmp D400LJ
JDQSEL1: CLR JDQ_1
;////////////////////////////////
;    CLR P1.4
D400LJ:     	LCALL RS


;MOV COM,#98H
;lcall wri
;MOV DPTR,#tsxs1
;MOV R1,#0
;MOV R2,#12
;lCALL SDZF
;MOV COM,#9fH
;lcall wri
;MOV DPTR,#tsxs2
;MOV R1,#0
;MOV R2,#2
;lCALL SDZF
;	JB 0EH,DC1DL2
;   	MOV R0,#02H
;	MOVX @R0,A
	MOV R0,#07H	;07h,0804读写
	MOVX @R0,A
	LCALL Q20S
 ;   LJMP WZFF              ;启泵时更新液晶屏，容易受电源干扰而变乱，不更新为好
;MOV DPTR,#BXS ;振荡频率越快越不稳定，6倍频显示板和液晶都能跑数而不丢脉冲，但液晶显示容易乱
;	LCALL HZBXS
;MOV COM,#98H
;lcall wri
;MOV DPTR,#tsxs
;MOV R1,#0
;MOV R2,#8
;LCALL SDZF
;MOV COM,#8EH
;LCALL WRI
;MOV R1,#75H
;MOV R2,#1
;LCALL DISNW0
;MOV COM,#9EH
;LCALL WRI
;MOV R1,#74H
;MOV R2,#1
;LCALL DISNW0

WZFF:	SETB 04H
	MOV R0,#7FH
	MOV R1,#0AH
DCL2:   MOV @R0,#00H
	DEC R0
	DJNZ R1,DCL2
	MOV A,#01H
	CJNE A,30H,DCU1
	MOV R0,#59H
	LJMP DCU
DCU1:   INC A
	CJNE A,30H,DCU2
	MOV R0,#5BH
	LJMP DCU
DCU2:   INC A
	CJNE A,30H,DCU3
	MOV R0,#5DH
	LJMP DCU
DCU3:   INC A
	CJNE A,30H,DCU4
	MOV R0,#5FH
	LJMP DCU
DCU4:   INC A
	CJNE A,30H,DCU5
	MOV R0,#61H
	AJMP DCU
DCU5:   MOV R0,#63H
DCU:    MOV 79H,@R0
	INC R0
	MOV 7AH,@R0
;     MOV JS_COUNT,#30d	;设脉冲等待时间
     MOV TL0,#0FFH
     MOV TH0,#0FFH
     MOV SCON,#0D8H;#50H
     MOV PCON,#80H
	mov th1,#0FFH;#0fAh
	mov tl1,#0FFH;#0fAh
;     MOV TH1,#0H
;     MOV TL1,#0H
     SETB TR1
 ;   SETB ET1
     SETB ET0
     SETB EX0
     SETB TR0

pau: jnb 1ah,dcl3
    LJMP ZTSM
;DCL4J:    CLR 1CH
 ;         LJMP DCL33
PQ2L:LJMP PQ2
PQ3L:LJMP PQ3
ZTSM:JB IN_YK,ZTQD           ;按下遥控启动
 MOV A,#04H		;扫第一根行线
MOV R0,#JP_SEL		;键盘地址02H
MOVX @R0,A
lCALL TIML
MOV P0,#0FFH
MOV R0,#JP_READ
MOVX A,@R0
CJNE A,#02H, pq2L;	;1#
Ljmp ztqd
PQ2:CJNE A,#04H, pq3L		;2#
Ljmp ztqd
pq3:CJNE A,#08H, pq4		;3#
Ljmp ztqd
pq4:MOV A,#02H		;扫第二根行线
MOV R0,#JP_SEL
MOVX @R0,A
lCALL TIML
MOV P0,#0FFH
MOV R0,#JP_READ
MOVX A,@R0
CJNE A,#02H, pq5		;4#
Ljmp ztqd
pq5:CJNE A,#04H, pd6;dcl3;pd6	;5#
Ljmp ztqd
pd6:CJNE A,#08H, dcl3	;6#
;;dc6p:jnb 1ah,
ztqd:clr 1ah
;MOV R0,#0ACH
;MOV A,@R0
;XRL A,#39H
;JNZ KB_1
;CLR JDQ_2
;AJMP KB_OVE
KB_1:CLR JDQ_1
KB_OVE:;CLR LED_QD
SETB LED_QD
setb et0

;DCL33:MOV 2eH,#03H
;CSJ2:MOV 72H,#0E0H
;CSJ1:MOV 73H,#0FFH
;CSJ0:NOP
;NOP
;NOP
;NOP
;NOP
;NOP
;DCL3:   JNB 04H,DCL0
;        JB 1CH,DCL4J
;	jb 1ah,pau
;DJNZ 73H,CSJ0
;DJNZ 72H,CSJ1
;DJNZ 2eH,CSJ2
;CLR 0CH
;setb LED_QD
;setb JDQ_1
;setb JDQ_2
;	CLR TR0
;	CLR ET0
;	CLR EX1
;	CLR 04H
;setb  CHECK_POWER
;lcall timl6
;lcall timl6
;lcall timl6
;lcall timl6
;lcall timl6
;lcall timl6
;lcall timl6
;lcall timl6
;lcall timl6
;lcall timl6
;lcall timl6
;lcall timl6
;lcall timl6
;lcall timl6
;lcall timl6
;lcall timl6
;lcall timl6
;lcall timl6
;JnB CHECK_POWER,DCL0
;lcall timl6
;lcall timl6
;JnB CHECK_POWER,DCL0
;lcall timl6
;lcall timl6
;JnB CHECK_POWER,DCL0
;MOV R1,#0D9H
;MOV @R1,#09DH

;CLR GJ;关掉电池继电器
;setb kj;
;	LCALL TIIL
;        LCALL TIIL

DCL3:   JB 04H,pau

DCL0:;   MOV R0,#84H
	MOV R1,30H
	CJNE R1,#01H,DCL4
MOV R0,#0D5H
MOV R1,#0C4H
MOV A,@R1
MOV @R0,A
INC R0
INC R1
MOV A,@R1
MOV @R0,A
   MOV R0,#84H
	LJMP DCAD
DCL4:	CJNE R1,#02H,DCL5
MOV R0,#0D5H
MOV R1,#0C6H
MOV A,@R1
MOV @R0,A
INC R0
INC R1
MOV A,@R1
MOV @R0,A

   MOV R0,#89H
	LJMP DCAD
DCL5:  ; MOV R0,#8EH
	CJNE R1,#03H,DCL6
MOV R0,#0D5H
MOV R1,#0C8H
MOV A,@R1
MOV @R0,A
INC R0
INC R1
MOV A,@R1
MOV @R0,A

   MOV R0,#8EH
	LJMP DCAD
DCL6:   MOV R0,#93H
	CJNE R1,#04H,DCL7
MOV R0,#0D5H
MOV R1,#0CAH
MOV A,@R1
MOV @R0,A
INC R0
INC R1
MOV A,@R1
MOV @R0,A

   MOV R0,#93H
	LJMP DCAD
DCL7:   MOV R0,#98H
	CJNE R1,#05H,DCL8
MOV R0,#0D5H
MOV R1,#0CCH
MOV A,@R1
MOV @R0,A
INC R0
INC R1
MOV A,@R1
MOV @R0,A

   MOV R0,#98H
	LJMP DCAD
dcl8:	mov R0,#9DH
MOV R0,#0D5H
MOV R1,#0CEH
MOV A,@R1
MOV @R0,A
INC R0
INC R1
MOV A,@R1
MOV @R0,A

   MOV R0,#9DH
DCAD:   MOV R1,#7AH
	MOV R2,#05H
	CLR C
DCA1:   MOV A,@R0
	ADDC A,@R1
	DA A
	MOV @R0,A
	DEC R0
	DEC R1
	DJNZ R2,DCA1
	MOV R0,#0A3H
	MOV R1,#7AH
	MOV R2,#05H
	CLR C
DCA2:   MOV A,@R0
	ADDC A,@R1
	DA A
	MOV @R0,A
	DEC R0
	DEC R1
	DJNZ R2,DCA2
	MOV A,@R0
	ADDC A,#00H
	DA A
	MOV @R0,A
	CLR C
	MOV R0,#71H	;6DH-71H，当次计量数
	MOV R1,#7AH
	MOV R2,#05H
DBL1:   MOV A,@R0
	ADDC A,@R1
	DA A
	MOV @R0,A
	DEC R0
	DEC R1
	DJNZ R2,DBL1
;      MOV R0,#0ACH
;      MOV A,@R0
;      XRL A,#39H
;      JZ WLJ2LL
;      LJMP WLJ1L
;WLJ2LL:LJMP WLJ2L
;WLJ1L:       MOV DPTR,#FLASH_FLJ1_ADDRESS
;       MOV R2,#30
;       MOV R0,#80H
;       LCALL FLASH_WRITE
            MOV         EE240X_AD,#3H
            MOV         EE240X_SUBA,#0
            MOV         EE240X_NUMBYT,#16
            MOV         EE240X_TDA,#80h
            LCALL       EE240X_WRNBYT
       lcall timl
          lcall timl
       lcall timl
          lcall timl
            MOV         EE240X_AD,#3H
            MOV         EE240X_SUBA,#16
            MOV         EE240X_NUMBYT,#14
            MOV         EE240X_TDA,#90h
            LCALL       EE240X_WRNBYT
       lcall timl
          lcall timl
       lcall timl
          lcall timl
            MOV         EE240X_AD,#3H
            MOV         EE240X_SUBA,#30
            MOV         EE240X_NUMBYT,#6
            MOV         EE240X_TDA,#9eh
            LCALL       EE240X_WRNBYT
       lcall timl
          lcall timl
       lcall timl
          lcall timl


;	MOV 72H,#83	;写日累计
;	MOV R0,#80H
;WR1:   MOV TIME_ADDR,72H
;          MOV TIME_DATA,@R0
;          LCALL RTC_WRITE
;	INC 72H
;	INC R0
;	CJNE R0,#9EH,WR1
        lcall timgk
       lcall timgk
;       MOV DPTR,#FLASH_ZLJ1_ADDRESS
;       MOV R2,#6
;       MOV R0,#9EH
;       LCALL FLASH_WRITE

;	MOV 72H,#113		;写总累计
;	MOV R0,#9EH
;WR2:   MOV TIME_ADDR,72H
;          MOV TIME_DATA,@R0
;          LCALL RTC_WRITE
;	INC 72H
;	INC R0
;	CJNE R0,#0A4H,WR2

;WWC:       MOV DPTR,#FLASH_ZHJLZ1_ADDRESS
;       MOV R2,#5
;       MOV R0,#6DH
;       LCALL FLASH_WRITE



            MOV         EE240X_AD,#3H
            MOV         EE240X_SUBA,#40
            MOV         EE240X_NUMBYT,#5
            MOV         EE240X_TDA,#76h
            LCALL       EE240X_WRNBYT
       lcall timl
          lcall timl
       lcall timl
          lcall timl

; 	MOV 72H,#C12887_ZHJLZ_ADDRESS		;写最后值
;	MOV R1,#6DH
;WRZ:MOV TIME_ADDR,72H
;         MOV TIME_DATA,@R1
;       LCALL RTC_WRITE
;	INC 72H
;	INC R1
;	CJNE R1,#72H,WRZ
 ;ljmp wljover
;       MOV DPTR,#FLASH_JSDY1_ADDRESS
;       MOV R2,#5
;       MOV R0,#76H
;       LCALL FLASH_WRITE

WLJOVER:	JNB 15H,DBL2
	CLR 15H
	MOV PCON,#02H
BT22:  LJMP BT11
;BT16L:LJMP BT16
DBL2:  JB 0CH,BT22
;       JB 0DH,BT16L
	;MOV A,#01H
	;XRL A,30H
	;JNZ DCLL4
	;LJMP BT81
;DCLL4:MOV A,#04H
;	XRL A,30H
;	JNZ DCLL
BT8:nop
;MOV DPTR,#PPM
;LCALL PRINT
;mov dptr,#pzz	;走纸
;LCALL PRINT
;jnb 0bh,BT81
;MOV COM,#88H	;显示停泵提示1
;LCALL WRI
;MOV DPTR,#TB1
;MOV R1,#0
;MOV R2,#16
;LCALL SDZF
;MOV COM,#98H	;显示停泵提示2
;LCALL WRI
;MOV DPTR,#TB2
;MOV R1,#0
;MOV R2,#16
;LCALL SDZF
;SETB P1.4
;;ajmp BT81
;csbxs:	MOV DPTR,#BXS
;	LCALL HZBXS
;	NOP
;       MOV 07H,5CH
;       LJMP BTDY
BT81:  NOP
;DCLL: mov 07h,#0aah
 ;     MOV 06H,74H
;	MOV A,#00H
;	MOV 05H,#0AAH    ;
 ;       MOV R1,#0BBH      ;第一桶路号
  ;     MOV 04H,@R1
;	MOV 03H,A
;	MOV 02H,A
;	MOV 10H,#00H
;	MOV 1FH,#00H
;	MOV 1EH,#0AH
;	LCALL PRM
;	LCALL PRR
;	LCALL PR
 ;       MOV 07H,71H
;	MOV 06H,70H
;	MOV 05H,6FH
;	MOV 04H,6EH
;	MOV 03H,6DH
;	MOV 02H,#0AAH
;	MOV 1FH,#07H
;	MOV 1EH,#0AH
;	MOV 10H,#03H
;	LCALL PRM
;	LCALL PRR
;	LCALL PR
 ;
JE:MOV R0,#0D5H
MOV 65H,@R0
INC R0
MOV 66H,@R0

MOV 07H,71H
MOV 06H,70H
MOV 05H,6FH
MOV 04H,6EH
MOV 03H,#0
MOV 02H,#0
LCALL MULN
 ;        MOV 07H,0eH
  ;       MOV 06H,0dH
   ;      MOV 05H,0cH
    ;     MOV 04H,0BH
     ;    MOV 03H,0AH
      ;   MOV 02H,#0
       ;  MOV 1FH,#05H
        ; MOV 10H,#03H
         ;LCALL PRM
;         LCALL PRR
 ;        LCALL PR
PYW:MOV R1,#0BBH    ;打印已打\未打次数
MOV @R1,75H
mov r1,#0bch
mov @r1,74h
	MOV DPTR,#PJLZ2
	MOV R1,#0BBH
	LCALL PRINT
lcall timl6
LCALL TIML6
mov r1,#0bbh           ;打印单次计量值
mov @r1,76h
INC R1
MOV @R1,77H
INC R1
MOV @R1,78H
INC R1
MOV @R1,79H
INC R1
MOV @R1,7AH
	MOV DPTR,#PDCJL
	MOV R1,#0BBH
	LCALL PRINT
lcall timl6
LCALL TIML6
MOV R0,#0D5H                       ;
MOV A,@R0
JNZ PR_DJ
MOV R0,#0D6H
MOV A,@R0
JNZ PR_DJ
LJMP PR_ZFY
PR_DJ:MOV R1,#0BBH                  ;打单价
MOV R0,#0D5H
MOV A,@R0
MOV @R1,A
INC R0
INC R1
MOV A,@R0
MOV @R1,A
	MOV DPTR,#PDJ
	MOV R1,#0BBH
	LCALL PRINT
lcall timl6
LCALL TIML6
PR_ZFY:MOV R1,#0BBH                     ;总计量值
DCLL:  MOV @R1,6DH
	INC R1
	MOV @R1,6EH
	INC R1
	MOV @R1,6FH
	INC R1
	MOV @R1,70H
	INC R1
	MOV @R1,71H
;	MOV DPTR,#PJLZ
	MOV DPTR,#PZFY
	MOV R1,#0BBH
	LCALL PRINT
lcall timl6
LCALL TIML6
MOV R0,#0D5H
MOV A,@R0
JNZ PR_ZJE
MOV R0,#0D6H
MOV A,@R0
JNZ PR_ZJE
LJMP PR_SJ

PR_ZJE:MOV R1,#0BBH                          ;总金额
  MOV @R1,0AH
	INC R1
	MOV @R1,0BH
	INC R1
	MOV @R1,0CH
	INC R1
	MOV @R1,0DH
	INC R1
	MOV @R1,0EH
	MOV DPTR,#PJE
	MOV R1,#0BBH
	LCALL PRINT
lcall timl6
LCALL TIML6
;LCALL PRDATE
PR_SJ:LCALL PTD	;打印时间
;lcall timl6
;LCALL TIML6
;MOV DPTR,#PHG
;LCALL PRINT
;LCALL TIML6
;lcall timl6
MOV DPTR,#PPM
LCALL PRINT
LCALL TIML6
LCALL TIML6
;mov dptr,#pzz	;走纸
;LCALL PRINT
;jb 0bh,BTEQ
;MOV COM,#88H	;显示停泵提示1
;LCALL WRI
;MOV DPTR,#TB1
;MOV R1,#0
;MOV R2,#16
;LCALL SDZF
;MOV COM,#98H	;显示停泵提示2
;LCALL WRI
;MOV DPTR,#TB2
;MOV R1,#0
;MOV R2,#16
;LCALL SDZF
;ajmp bteq
csbxs:;	MOV DPTR,#MAIN_B;#BXS
;	LCALL HZBXS
BTEQ:;MOV A,6

	MOV 31H,6DH
	MOV 32H,6EH
	MOV 33H,6FH
	MOV 34H,70H
;	MOV 35H,71H
	CLR 05H
mov 10h,#0;	MOV 10H,#3;#0
	MOV R0,#71H
	MOV R2,#05H
BT7:   MOV @R0,#00H
	DEC R0
	DJNZ R2,BT7
MOV 39H,#0
MOV 38H,#0
MOV 37H,#0
MOV 36H,#0
MOV 3AH,#0
BT1:    CLR 07h
AJMP BT11
;BT16:LCALL SON
;CLR 07H    ;读定时单元
;MOV R1,#0A4H
;MOV A,@R1
;MOV R2,A

;BT16X:NOP
;CSJJC:MOV A,#01H		;扫第一根行线
;MOV R0,#02H		;键盘地址02H
;MOVX @R0,A
;lCALL TIML
;MOV R0,#02H
;MOVX A,@R0
;XRL A,#10H              ;清除键
;JZ QU6JL
;LCALL TIML6
;CSJJC2:MOV A,#01H		;扫第一根行线
;MOV R0,#02H		;键盘地址02H
;MOVX @R0,A
;lCALL TIML
;MOV R0,#02H
;MOVX A,@R0
;XRL A,#10H              ;清除键
;JZ QU6JL
;lcall timl6
;DJNZ R2,BT16X


;LJMP DC6
;QU6JL:  CLR 0DH
;        LJMP BT81
BT11: LCALL SON
	CLR 07H
;	CLR 1BH
;	MOV DPTR,#BXS
;	LCALL HZBXS
	LJMP MN001
;KEYCLR:NOP
;KCLR:MOV @R1,#0
;INC R1
;DJNZ R2,KCLR
;RET

;GRQ: MOV R1,#0B1H
;MOV R2,#3
;ACALL KEYCLR
;	MOV DPTR,#XGRQ
;	LCALL ZBXS
;SETB 2EH
;LJMP MN0
;GSJ: MOV R1,#0B1H
;MOV R2,#3
;ACALL KEYCLR
;	MOV DPTR,#XGSJ
;	LCALL ZBXS
;SETB 2FH
;LJMP MN0
;SJSEL:MOV R1,#0B4H
;	MOV A,@R1
;	CJNE A,#1,MSJC12
;	LJMP GRQ			;GMD
;MSJC12:CJNE A,#2,MSJC13
;	LJMP GSJ
;MSJC13:NOP
;	LJMP MN0
;CSSET:MOV R1,#0B4H
;	MOV A,@R1
;	CJNE A,#1,MUGC12
;	LJMP GMD			;GMD
;MUGC12:CJNE A,#2,MUGC13
;	LJMP GDL
;MUGC13:CJNE A,#3,MUGC14
;	LJMP GYL
;MUGC14:CJNE A,#4,MUGC15
;        LJMP GDJ      ;

;MUGC15:	LJMP MN0
;GMD:    MOV DPTR,#BGMD           ;改密度
;	LCALL ZBXS
;SETB 25H
;LJMP MN0
;GDL: 	MOV DPTR,#BGDL        ;改当量
;	LCALL ZBXS
;SETB 26H
;LJMP MN0

INRQ0:LJMP ALAR
INRQ:MOV R1,#0B1H
MOV A,@R1
JZ INRQ0
INC R1
MOV A,@R1
JZ INRQ0
MOV R1,#0B1H
MOV 33H,@R1
INC R1
MOV 34H,@R1
INC R1
MOV 35H,@R1
CLR 2EH
SETB 28H
LJMP DATE_EDIT

INSJ:MOV R1,#0B1H
MOV A,@R1
JZ INRQ0
MOV R1,#0B1H
MOV 34H,@R1
INC R1
MOV 35H,@R1
CLR 2FH
SETB 28H
LJMP TIME_EDIT

;DYSE:MOV R1,#0B4H       ;开打印
;	MOV A,@R1
;	CJNE A,#1,DYSE2
;	CLR 18H
;MOV DPTR,#PRI_OPEN
;LCALL ZBXS
;	LCALL TIIL
;	LCALL TIIL
;	LCALL TIIL
 ;       LCALL TIIL
;LJMP DYSE3
;DYSE2:CJNE A,#2,DYSE7     ;关打印
;SETB 18H
;MOV DPTR,#PRI_CLOSE
;LCALL ZBXS
;	LCALL TIIL
;	LCALL TIIL
;	LCALL TIIL
 ;       LCALL TIIL
;LJMP DYSE3
;DYSE7:CJNE A,#3,DYSE71;DYSE4;dyse8      ;选1路
 ;          SETB P4.3
  ;         MOV R0,#0ACH
   ;        MOV A,#06DH
    ;       MOV @R0,A
     ;       MOV         EE240X_AD,#1H      ;设器件的三位可编程地址
      ;      MOV         EE240X_SUBA,#10   ;设器件子地址

;            MOV         EE240X_NUMBYT,#1  ;写36字节数据
 ;           MOV         EE240X_TDA,#0ACH     ;设发送缓冲区首址
  ;          LCALL       EE240X_WRNBYT    ;写入数据
   ;        lcall timgk
    ;      lcall timgk
;MOV DPTR,#OPEN_1
;LCALL ZBXS
;	LCALL TIIL
;	LCALL TIIL
;	LCALL TIIL
 ;       LCALL TIIL
;***********************************************
;原打参数程序
;;MOV DPTR,#PCS
;;MOV R1,#
;;        MOV 29H,DPL
;;        MOV 28H,DPH

;lcall mpep1
;LCALL DPR
;LCALL MPEP

;;MOV DPTR,#PPM           ;走纸
;;LCALL PRINT
;***********************************************
;LJMP DYSE3
;DYSE71:CJNE A,#4,DYSE4     ;选2路
 ;          CLR P4.3
  ;         MOV R0,#0ACH
   ;        MOV A,#039H
    ;       MOV @R0,A
     ;       MOV         EE240X_AD,#1H      ;设器件的三位可编程地址
      ;      MOV         EE240X_SUBA ,#10   ;设器件子地址
       ;
        ;    MOV         EE240X_NUMBYT,#1  ;写36字节数据
         ;   MOV         EE240X_TDA,#0ACH     ;设发送缓冲区首址
          ;  LCALL       EE240X_WRNBYT    ;写入数据
           ;lcall timgk
;          lcall timgk
;MOV DPTR,#OPEN_2
;LCALL ZBXS
;	LCALL TIIL
;	LCALL TIIL
;	LCALL TIIL
 ;       LCALL TIIL
; ;       LCALL SON
;***********************************************
;原打参数程序
;DYSE8:CJNE A,#4,DYSE4     ;打累计
;LCALL PL1
;LCALL PTD

;MOV R1,#80H
;MOV R2,#36
;QLJ8:MOV @R1,#0
;INC R1
;DJNZ R2,QLJ8
;	MOV 72H,#70
;	MOV 73H,#0
;	MOV R1,#36
;WR48:     LCALL WRITE0
;	INC 72H
;	DJNZ R1,WR48

;MOV DPTR,#PPM
;LCALL PRINT
;AJMP DYSE3
;************************************************
;LJMP DYSE3
;DYSE4:MOV R1,#0B4H
;MOV @R1,#0
;AJMP DYSE5
;DYSE3:LCALL SON
;CLR 2DH
;MOV DPTR,#BPGSEL
;LCALL ZBXS
;SETB 24H
;DYSE5:LJMP MN0
;GDJ: 	MOV DPTR,#BGDJ        ;改单价
;	LCALL ZBXS
;SETB 29H
;LJMP MN0
;GYL:    MOV DPTR,#BGYL        ;改余量
;	LCALL ZBXS
;SETB 27H
;LJMP MN0
;XGYS: 	MOV DPTR,#BGYS     ;改延时
;	LCALL ZBXS
;MOV R1,#0A4H
;mov 33h,@r1
;	MOV COM,#8BH
;	MOV R2,#2
;mov 10h,#0
;MOV R1,#33H
;LCALL DGCS
;SETB 29H
;LJMP MN0
;CSYS:MOV R0,#0B0H
;	MOV R1,#0A4H
;	MOV A,@R0
;	MOV @R1,A
;	MOV 72H,#124		;写延时时间到111中
 ;    MOV A,@R0
;	MOV 73H,A
;   MOV TIME_ADDR,#124
 ;         MOV TIME_DATA,73H
  ;        LCALL RTC_WRITE


;MOV R1,#0A4H
;mov 33h,@r1
;	MOV COM,#8BH
;	MOV R2,#2
;mov 10h,#0
;MOV R1,#33H
;LCALL DGCS
;lcall son
;MOV 33H,#0
;mov 38h,#0
;mov r1,#0b0h
;mov @r1,#0
;SETB 29h
;LJMP MN0
;GMC: MOV  COM,#01H           ;打脉冲
;        LCALL   WRI
;        LCALL   DELADY
;	MOV DPTR,#BGMC
;	LCALL HZBXS
;SETB 2AH
;LJMP MN0
;ENMU1:MOV R1,#0B4H
;	MOV A,@R1
;	CJNE A,#1,MU12
;	MOV DPTR,#BGCSB
;	LCALL ZBXS
;	SETB 2BH
;	LJMP MN0
;MU12:CJNE A,#2,MU13
 ;          MOV         EE240X_AD,#1H      ;第一页
  ;         MOV         EE240X_SUBA,#1  ;1-3   读设定限期
   ;       MOV         EE240X_NUMBYT,#3
    ;      MOV         EE240X_RDA,#28H
     ;     LCALL       EE240X_RDNBYT
      ;    lcall timgk
       ;   lcall timgk

;		MOV A,28H
;		xrl a,#99h
;		jz t_next
 ;                LCALL SON
  ;                LJMP MN0


;T_NEXT:	MOV DPTR,#BGSJ
;	LCALL ZBXS
;SETB 28H
;LJMP MN0
;MU13:CJNE A,#3,MU14
;GMC:
;	MOV DPTR,#BGMC
;	LCALL ZBXS
 ;       SETB 2AH
;	LJMP MN0
;MU14:CJNE A,#4,MU15
;	MOV DPTR,#BDYSET
;	LCALL ZBXS
;SETB 2DH
;LJMP MN0
;MU15:MOV R1,#0B4H
;MOV @R1,#0
;LJMP MN0
BGKG:;JB 2CH,LJJYL
LCALL TIML6
LCALL TIML6
;LCALL TIML6
;LCALL TIML6
;mov a,#04h
;MOV R0,#02H
;MOVX @R0,A
;lCALL TIML
;MOV R0,#02H
;MOVX A,@R0
;CJNE A,#02H,bgfh
;cpl 0ah
;mov c,0ah
CLR C
MOV C,P4.0
JC BG_CLOSE
SETB P4.0
LJMP BGFH
BG_CLOSE:CLR P4.0
LJMP BGFH
bgfh:LJMP MN0
;ENMU1L:LJMP ENMU1
;CSSETL:LJMP CSSET
;DYSEL:LJMP DYSE
;CSYSL:LJMP CSYS
;LJJYL:LJMP LJJY
;SJSELL:LJMP SJSEL
;INRQL:LJMP INRQ
;INSJL:LJMP INSJ
;ENBJ:LJMP ALAR
;ENTER:NOP
;JB 2AH,ENBJ
;JB 29H,CSYSL
;JB 2BH,CSSETL
;JB 2EH,INRQL
;JB 2FH,INSJL
;JB 28H,SJSELL
;JB 2DH,DYSEL	;开OR关
;JB 24H,ENMU1l
;JB 2CH,LJJYL
;JB 23H,MMJY
;	LJMP ENBJ
;MMJY:	MOV R1,#0B1H
;	MOV A,@R1
;	CJNE A,#18H,LJ_TO
;	INC R1
;	MOV A,@R1
;	CJNE A,#80H,LJ_TO
;	INC R1
;	MOV A,@R1
;	CJNE A,#14H,LJ_TO
;	CLR 23H
;	SETB 02H
;	SETB 24H	;菜单选择1
;	MOV DPTR,#BPGSEL
;	LCALL ZBXS
;	LJMP MN0
;LJ_TO:
;         MOV         EE240X_AD,#1H      ;设器件的三位可编程地址
  ;         MOV         EE240X_SUBA,#4  ;读
 ;         MOV         EE240X_NUMBYT,#3
;          MOV         EE240X_RDA,#2DH
 ;         LCALL       EE240X_RDNBYT
  ;        lcall timgk
   ;       lcall timgk
;MOV R1,#0B1H
;MOV R0,#2DH
;	MOV A,@R1
;	XRL A,@R0
 ;       JNZ LJERR
;	INC R1
 ;       INC R0
;	MOV A,@R1

;	XRL A,@R0
 ;       JNZ LJERR
;	INC R1
 ;       INC R0
;	MOV A,@R1
 ;       XRL A,@R0
  ;      JNZ LJERR
;	CLR 23H
;	SETB 02H
;	SETB 24H	;菜单选择1
;	LJMP MN0
;LJERR:NOP
;	CLR 23H
;	CLR 02H
;LCALL SON
;MOV DPTR,#MAIN_B;#BXS
;LCALL ZBXS
;LJMP MN0
;MMERR:NOP
;CLR 2CH
;LCALL SON
;MOV DPTR,#MAIN_B;#BXS
;LCALL ZBXS
;LJMP MN0
;LJJY:	MOV R1,#0B1H
;	MOV A,@R1
;	CJNE A,#96H,MMERR
;	INC R1
;	MOV A,@R1
;	CJNE A,#73H,MMERR
;	INC R1
;	MOV A,@R1
;	CJNE A,#20H,MMERR
;	CLR 2CH
;lcall pl1
;clr 2ch
;LCALL SON
;MOV DPTR,#MAIN_B;#BXS
;LCALL ZBXS
;ljmp mn0
MMERR:LJMP ALAR
PLXSL:LJMP PLXS
PTOL:   JNB 0FH,PRRLJ
        MOV R1,#37H
	MOV A,@R1
	CJNE A,#89H,MMERR
	INC R1
	MOV A,@R1
	CJNE A,#80H,MMERR
	INC R1
	MOV A,@R1
	CJNE A,#52H,MMERR
        LCALL PCZLJ
        LCALL SON
CLR 0FH
MOV 32H,#0
MOV 33H,#0
MOV 34H,#0
MOV 37H,#0
MOV 38H,#0
MOV 39H,#0
        LJMP MN0
PRRLJ:lcall pl1
LCALL SON
MOV 32H,#0
MOV 33H,#0
MOV 34H,#0
MOV 37H,#0
MOV 38H,#0
MOV 39H,#0
LJMP MN0
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;字轮打印累计
;PL1:    MOV 30H,#01H            ;累计
;	MOV 65h,#80H
;	MOV 1FH,#0AH
;	MOV 1EH,#0AH
;	MOV 10H,#03
;pto1:   MOV R0,65h
;        MOV 03H,@R0
;	INC R0
;	MOV 04H,@R0
;	INC R0
;	MOV 05H,@R0
;	INC R0
;	MOV 06H,@R0
;	INC R0
;	MOV 07H,@R0
 ;       MOV A,30H
  ;    ORL A,#0A0H
   ;    SWAP A
    ;   MOV 02H,A
     ;  MOV 10H,#3
;       INC R0
 ;       MOV 65h,R0
  ;      LCALL PRM
;	LCALL PRR
;	LCALL PR
;	INC 30H
;	MOV A,#07H
;	XRL A,30H
;	JNZ PTO1
 ;       MOV R0,#0A3H
  ;      MOV 07H,@R0
   ;     DEC R0
;	MOV 06H,@R0
 ;       DEC R0
  ;      MOV 05H,@R0
;        DEC R0
;	MOV 04H,@R0
 ;       DEC R0
;	MOV 03H,@R0
 ;       DEC R0
;	MOV 02H,@R0
 ;       MOV 10H,#03H
;	LCALL PRM
;	LCALL PRR
;	LCALL PR

;SETB 14H
;LCALL PRDATE
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

;MOV DPTR,#PPM
;LCALL PRINT
;	MOV DPTR,#BLJ1               1-3
;	LCALL ZBXS
;mov 10h,#3
;MOV COM,#83H
;MOV R1,#80H
;MOV R2,#5
;;LCALL DISNW0
;lcall dispnum
;MOV COM,#93H
;MOV R1,#85H
;MOV R2,#5
;;LCALL DISNW0
;lcall dispnum
;MOV COM,#8BH
;MOV R1,#8AH
;MOV R2,#5
;lcall dispnum
;;LCALL DISNW0
;MOV COM,#9BH
;MOV R1,#8FH
;MOV R2,#5
;lcall dispnum
;;LCALL DISNW0
;LCALL TIIL
;LCALL TIIL
;LCALL TIIL
;LCALL TIIL
;LCALL SON
;	MOV DPTR,#BLJ2            4-6
;	LCALL ZBXS
;MOV COM,#83H
;MOV R1,#94H
;MOV R2,#5
;lcall dispnum
;;LCALL DISNW0
;MOV COM,#93H
;MOV R1,#99H
;MOV R2,#5
;lcall dispnum
;;LCALL DISNW0
;MOV COM,#99H
;MOV R1,#9EH
;MOV R2,#6
;lcall dispnum
;;LCALL DISNW0
;        MOV  COM,#01H
 ;       LCALL   WRI
  ;      LCALL   DELADY
;LCALL TIIL
;LCALL TIIL
;LCALL TIIL
;LCALL SON
;;	MOV DPTR,#BLJ2     ;总累计
;;	LCALL ZBXS
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;MOV R1,#80H
;MOV R2,#36
;QLJ:MOV @R1,#0
;INC R1
;DJNZ R2,QLJ
;	MOV 72H,#83
;	MOV 73H,#0
;	MOV R1,#36
;WR4:   MOV TIME_ADDR,72H
;          MOV TIME_DATA,#0
;          LCALL RTC_WRITE
;	INC 72H
;	DJNZ R1,WR4
;CLR 2CH
;LCALL JLXS
;MOV DPTR,#MAIN_B;#BXS
;	LCALL HZBXS
;	LJMP MN0
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
XYT86:MOV R1,#0D0H
	MOV 72H,#62         ;48T8:(62,63,64,65)
	MOV R7,#4

RCSX:	MOV TIME_ADDR,72H
         LCALL RTC_READ
        MOV A,TIME_DATA
	 MOV @R1,A
         INC 72H
         INC R1
         DJNZ R7,RCSX
CLR C
MOV R0,#0D0H
MOV A,@R0       ; D0+D1-D2?=D3
MOV B,A
INC R0
MOV A,@R0
ADD A,B
MOV B,A
INC R0
MOV A,@R0
SUBB A,B
MOV B,A
INC R0
MOV A,@R0
SUBB A,B
JNZ XYERR
LJMP XYOK
XYERR:SETB 1EH
XYOK:RET
CPLL:LJMP CP
OFN1:   LJMP ALAR
OFN:LCALL TIML6
JB 02H,CPLL
    JNB 0FH,OFN1;OFN_YDL
;    MOV 1FH,#99H
 ;   MOV 1EH,#99H
  ;  MOV 1DH,#99H
   ; MOV 1CH,#99H
    ;MOV 1BH,#99H

 ;    JB 22H,OFN1
  ;  LJMP OFN_QUI
OFN_YDL:        JB 22H,OFN1
                LJMP PHZOP
	Lcall mpep1
       MOV 1FH,3AH
	MOV 1EH,39H
	MOV 1DH,38H
	MOV 1CH,37H
	MOV 1BH,36H
        MOV 67H,#0
	MOV 07H,1FH
	MOV 06H,1EH
	MOV 05H,1DH
	MOV 04H,1CH
	MOV 03H,1BH
	MOV 02H,#00H
	MOV 1FH,#04H
	MOV 1EH,#0AH
        MOV 10H,#03H
 	LCALL PRM
	LCALL PRR
	LCALL PR
	Lcall mpep1
PHZOP:
        mov 67h,#0
        MOV A,10H
        JZ OFNNXS
        XRL A,#03H      ;2位小数
        JNZ OFNXS1
        SETB 0BH
	MOV 1FH,39H
	MOV 1EH,38H
	MOV 1DH,37H
        MOV 1CH,36H
        MOV 1BH,#0
        LJMP OFNPR
OFNXS1: MOV A,10H         ;1位小数
        XRL A,#02H
        JNZ OFNNXS
        SETB 0BH
       MOV R0,#37H
	MOV R1,#36H
	MOV 18H,#04H
	lCALL RSD
	MOV A,#0
	ORL 39H,A
	MOV 1FH,39H
	MOV 1EH,38H
	MOV 1DH,37H
        MOV 1CH,36h
        MOV 1BH,#0
        LJMP OFNPR
OFNNXS: MOV 1EH,39H
	MOV 1DH,38H
	MOV 1CH,37H
        MOV 1BH,36h
        MOV 1FH,#0

OFNPR:	MOV R1,#0BBH
	MOV @R1,1BH
	INC R1
	MOV @R1,1CH
	INC R1
	MOV @R1,1DH
	INC R1
	MOV @R1,1EH
	INC R1
	MOV @R1,1FH
	MOV DPTR,#PDL
	MOV R1,#0BBH
	LCALL PRINT
        LCALL TIML6

        MOV 07H,39H
        MOV 06H,38H
        MOV 05H,37H
        MOV 04H,36H
        MOV 03H,#0
        MOV 02H,#0
        MOV 24H,#0
        mov r0,#0ddh
        mov a,@r0

;        MOV 25H,a
         mov 25h,#90h
        LCALL MULN
        MOV 4AH,0CH
        MOV 4BH,0DH
        MOV 4CH,0EH

OFNSUB:
         MOV R1,#0DAH                      ;此为按百分比打大流值,送至0DAH-0DCH
         MOV @R1,4AH
         INC R1
         MOV @R1,4BH
         INC R1
         MOV @R1,4CH

	MOV 31H,#0H
	MOV 32H,4aH
	MOV 33H,4bH
	MOV 34H,4cH
	MOV 10H,#0
	LCALL DISP_SMG
        LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
        LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
	LCALL TIML6
LCALL TIML6
	LCALL TIML6


OFN_QUI:	CLR 0FH
JB 0BH,PRDLXS
	MOV 34H,1EH
	MOV 33H,1DH
	MOV 32H,1CH
        MOV 31H,1BH
        MOV 10H,#0
        Ljmp OFNQU
PRDLXS:	MOV 34H,1FH
	MOV 33H,1EH
	MOV 32H,1DH
        MOV 31H,1CH
        MOV 10H,#3


;	MOV 34H,1EH
;	MOV 33H,1DH
;	MOV 32H,1CH
;	MOV 31H,1BH
;	MOV R0,#0B0H
;	MOV @R0,#0
OFNQU:  MOV 67H,#0
;SETB 0AH
	SETB 07H
        CLR 05H
	SETB 22H	;22H=1,按过定量键，该输桶数
        CLR 0BH
	LJMP MN0
TDJM:	LJMP MN0
VDJ:	LJMP VD
TDIS:	JB 1EH,TDJM
        JB 0EH,TDJM
	 JB 02H,VDJ
;	  CLR 09H
;LCALL SEND_WD
	MOV R7,#1FH
	CLR C
	MOV P3.2,C
	LCALL TIM1
	SETB P3.2
	CLR 0CH
	CLR 0DH
	LJMP MN0
PINT:   JNB 04H,PIN1            ;掉电
	SETB 15H
;	MOV 72H,#75
;	MOV 73H,#01
 ;  MOV TIME_ADDR,72H
  ;        MOV TIME_DATA,73H
   ;       LCALL RTC_WRITE

;	LCALL WRITE0
	LJMP DCL0
PIN1: ;ljmp pinto
            MOV         EE240X_AD,#3H
            MOV         EE240X_SUBA,#40
            MOV         EE240X_NUMBYT,#5
            MOV         EE240X_TDA,#76h
            LCALL       EE240X_WRNBYT
       lcall timl
          lcall timl
       lcall timl
          lcall timl

;	MOV 72H,#75
;	MOV 73H,#0
;;	LCALL WRITE0
 ;  MOV TIME_ADDR,72H
  ;        MOV TIME_DATA,73H
   ;       LCALL RTC_WRITE

pinto:	MOV PCON,#02H
AIN1:clr ex0
 mov r1,#0dfh
 mov a,#0
 mov @r1,a
;SETB LED_QD
clr LED_QD
SETB JDQ_1
SETB JDQ_2
lcall timl6
LCALL TIML6
LCALL TIML6
lcall timl6
LCALL TIML6
LCALL TIML6
lcall timl6
LCALL TIML6
lcall timl6
LCALL TIML6
LCALL TIML6
lcall timl6
LCALL TIML6
LCALL TIML6
lcall timl6
LCALL TIML6
lcall timl6
LCALL TIML6
LCALL TIML6
lcall timl6
LCALL TIML6
LCALL TIML6
lcall timl6
LCALL TIML6
LCALL TIML6
lcall timl6
LCALL TIML6
LCALL TIML6
lcall timl6
LCALL TIML6

jbc 1ah,stop
setb 1ah
clr et0
setb ex0
Ljmp ain2
stop:CLR EX0
CLR ET0
CLR 04H
;SETB LED_QD
clr LED_QD
setb JDQ_1
SETB JDQ_2
;setb 1bh
MOV A,74H
ADD A,#01H
DA A
MOV 74H,A
CJNE A,75H,AIN2
CLR 0CH
CLR 0DH
AIN2:RETI

;AIN1:   CLR EX1                 ;停止
;	CLR TR1
;	CLR ET0
;	CLR 04H
;	SETB P1.4
;	MOV A,74H
;	ADD A,#01H
;	DA A
;	MOV 74H,A
;	CJNE A,75H,AIN24
;	CLR 0CH
;AIN24:  MOV A,74H
;	ADD A,#01H
;	DA A
 ;       MOV 75H,A
  ;      CJNE A,75H,AIN2
;	CLR 0DH
;AIN2:   RETI
;QDJ:	LJMP QD
;PTOL: NOP
;	JB 02H,QDJ
; 	JNB 18H,PL1
	LJMP MN1
;MPEP:   MOV 1FH,#0AH
;	MOV 1EH,#0AH
;	MOV 1DH,#10H
;	LCALL PR
;	LCALL PR
;	LCALL PR
;	LCALL PR
;	LCALL PR
;	RET
;PTOL:	MOV DPTR,#BMM
	;LCALL ZBXS
	;MOV R1,#0B1H
	;MOV R2,#3
;QMML:	MOV @R1,#0
;	INC R1
;	DJNZ R2,QMML
;	SETB 2CH
;	LJMP MN0
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;热敏
plxs:MOV 30H,#1
      MOV 2EH,#80H
PLXS0:MOV R0,2EH
MOV 31H,@R0
INC R0
MOV 32H,@R0
INC R0
MOV 33H,@R0
INC R0
MOV 34H,@R0
INC R0
INC R0
	MOV 2EH,R0
	MOV 10H,#0
	LCALL DISP_SMG
;MOV A,#01H		;扫第一根行线
;MOV R0,#02H		;键盘地址02H
;MOVX @R0,A
;lCALL TIML
;MOV R0,#02H
;MOVX A,@R0
;CJNE A,#10H, XCCONT;
;LJMP JMCLER
;JMCLERL:LJMP JMCLER

	LCALL TIIL
	LCALL TIIL
	LCALL TIIL
LCALL SON
	INC 30H
	MOV A,#07H
	XRL A,30H
	JNZ PLXS0
MOV R0,#9FH
MOV 31H,@R0
INC R0
MOV 32H,@R0
INC R0
MOV 33H,@R0
INC R0
MOV 34H,@R0
INC R0
	MOV 10H,#0
	LCALL DISP_SMG
	LCALL TIIL
	LCALL TIIL
	LCALL TIIL
LCALL SON
MOV R0,#9EH
MOV A,@R0
JZ PLQ1
MOV 31H,#0
MOV 32H,#0
MOV 33H,#0
MOV 34H,@R0
	MOV 10H,#0
	LCALL DISP_SMG
	LCALL TIIL
	LCALL TIIL
	LCALL TIIL
        LCALL SON
PLQ1:LJMP PLQ0

PL1:JB 18H,PLXS
MOV 30H,#01H            ;累计
	MOV 26H,#80H
	MOV DPTR,#PRLJT
	LCALL PRINT
lcall timl6
PTO1:   MOV R1,#0BBH
	MOV @R1,30H
	INC R1
        MOV R0,26H
        MOV R2,#5
PXH:	MOV A,@R0
	MOV @R1,A
	INC R0
	INC R1
       DJNZ R2,PXH
	MOV 26H,R0
	MOV DPTR,#PRLJ
	MOV R1,#0BBH
	LCALL PRINT
lcall timl6

	INC 30H
	MOV A,#07H
	XRL A,30H
	JNZ PTO1
MOV R1,#0BBH	;总累计
MOV R0,#9EH
MOV R2,#6
ZLJS:MOV A,@R0
MOV @R1,A
INC R0
INC R1
DJNZ R2,ZLJS

MOV R1,#0BBH
MOV DPTR,#PZLJ
LCALL PRINT
lcall timl6
LCALL PTD
lcall timl6
MOV DPTR,#PPM
LCALL PRINT

PLQ0:	MOV R0,#80H
	MOV R1,#30
PTO2:   MOV @R0,#00H
	INC R0
	DJNZ R1,PTO2

;	MOV R0,#9eH
;	MOV R1,#6
;PTO2z:   MOV @R0,#00H
;	INC R0
;	DJNZ R1,PTO2z
;LCALL TIML
            MOV         EE240X_AD,#3H
            MOV         EE240X_SUBA,#0
            MOV         EE240X_NUMBYT,#16
            MOV         EE240X_TDA,#80h
            LCALL       EE240X_WRNBYT
       lcall timl
          lcall timl
       lcall timl
          lcall timl
            MOV         EE240X_AD,#3H
            MOV         EE240X_SUBA,#16
            MOV         EE240X_NUMBYT,#14
            MOV         EE240X_TDA,#90h
            LCALL       EE240X_WRNBYT
       lcall timl
          lcall timl
       lcall timl
          lcall timl

;MOV 72H,#C12887_RLJ_ADDRESS
;	MOV R1,#80H
;RDWQRLJ:   MOV TIME_ADDR,72h
;          MOV TIME_DATA,@R1
;          LCALL RTC_WRITE
;	INC 72H
;	INC R1
 ;     CJNE R1,#9EH,RDWQRLJ

;MOV DPTR,#FLASH_flj1_ADDRESS
;       MOV R2,#30
;       MOV R0,#80H
;       LCALL FLASH_WRITE
;LCALL TIML
;MOV 72H,#C12887_ZLJ_ADDRESS
;	MOV R1,#9EH
;RDWQZLJ:   MOV TIME_ADDR,72h
;          MOV TIME_DATA,@R1
;          LCALL RTC_WRITE
;	INC 72H
;	INC R1
 ;     CJNE R1,#0A4H,RDWQZLJ

;MOV DPTR,#FLASH_zlj1_ADDRESS
;       MOV R2,#6
;       MOV R0,#9eH
;       LCALL FLASH_WRITE
PL1_OVE:RET

PCZLJ:	MOV R0,#9eH
	MOV R1,#6
PTO12z:   MOV @R0,#00H
	INC R0
	DJNZ R1,PTO12z
LCALL TIML
           MOV         EE240X_AD,#3H
            MOV         EE240X_SUBA,#30
            MOV         EE240X_NUMBYT,#6
            MOV         EE240X_TDA,#9eh
            LCALL       EE240X_WRNBYT
       lcall timl
          lcall timl
       lcall timl
          lcall timl

;MOV 72H,#C12887_ZLJ_ADDRESS
;	MOV R1,#9EH
;R1DWQZLJ:   MOV TIME_ADDR,72h
;          MOV TIME_DATA,@R1
;          LCALL RTC_WRITE
;	INC 72H
;	INC R1
;      CJNE R1,#0A4H,R1DWQZLJ
RET

PTD:MOV R1,#0BBH   ;打印时间
PR_DY:
mov r0,#0bdh
lcall get1302_sj
mov r0,#0c0h
lcall get1302_rq


MOV DPTR,#PSJ
MOV R1,#0BBH
LCALL PRINT
	SETB 14H
RET
DPRJ:LJMP DPR
TD:     MOV R0,#07H
	MOVX @R0,A
	LCALL TIML
	LCALL TIML
	LCALL TIML
	LCALL TIML
	LCALL TIML
	LCALL TIML
MOV P0,#0FFH
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
	MOV R0,#07H
	MOVX A,@R0
	MOV 07H,A
	MOV 06H,#00H
	MOV 05H,#00H
	LCALL COMP
	MOV 65H,#00H
	MOV 66H,#25H
	MOV 07H,0DH
	MOV 06H,0CH
	MOV 05H,#00H
	MOV 04H,#00H
	MOV 03H,#00H
	MOV 02H,#00H
	LCALL MULN
;	MOV A,0DH
;	JNZ TD7
	CLR C
	MOV A,0EH
;	ADD A,#80H
;	DA A
;	JNC TD6		;无溢出，为负
	CLR 09H		;正值处理
;	MOV 0EH,A
	MOV B,#0
;	MOV B,#0FFH
TD5:   ; MOV 35H,0FH
;	MOV 34H,0EH
;	MOV 33H,B
        mov 0dh,b
;	MOV 10H,#03H
        JB 1BH,TDQUIT
XSWD:;MOV     R2,#4        ;字符个数
     ;MOV     R1,#0dh;#33H
;     MOV     COM,#93H      ;DD RAM 地址
 ;     MOV 34H,0FH
  ;    MOV 33H,0EH
   ;   MOV 32H,0DH
;	LCALL SEND_WD;DISTD
	CLR 14H
;	SETB 17H
TDQUIT:	RET
;	LJMP MN0
TD6:    MOV 0EH,A	;负值处理
	MOV A,#99H
	CLR C
	SUBB A,0FH
	SETB C
	ADDC A,#00H
	DA A
	MOV 0FH,A
	MOV 16H,C
	CLR C
	MOV A,#99H
	SUBB A,0EH
	MOV C,16H
	ADDC A,#00H
	DA A
        MOV 0EH,A
        MOV B,#0
;	MOV B,#0FFH	;未加负号？
	SETB 09H        ;09h=1,加负号
        MOV 0CH,#09EH
	LJMP TD5
TD7:    CLR 09H		;100度以上
	MOV A,0EH
 	ADD A,#80H
	DA A
	JNC TD8
;	MOV 35H,0EH
;	MOV 34H,A
;	MOV 33H,#1
        MOV 0FH,0EH
        MOV 0EH,A
        MOV 0DH,#1

;	MOV 33H,#0F1H
;	MOV 10H,#3
;	MOV     R2,#4        ;字符个数
;     MOV     R1,#33H
;     MOV     COM,#90H
;	LCALL DISTD
;        clr 14h
;        setb 17h
LJMP XSWD
;	RET
;	LJMP MN0
TD8:    MOV 0EH,A
	MOV B,#0
	LJMP TD5

;DPR:    MOV 30H,#01H	;打印参数
;	MOV 2AH,#4DH
;	MOV 29H,#3BH
;	MOV 28H,#59H
;DPR1:   MOV R0,2AH
;	MOV 06H,@R0
;	INC R0
;	MOV 07H,@R0
;	INC R0
;	MOV 2AH,R0
;	MOV 05H,#0A0H
;	MOV 04H,#0AAH
;	MOV 03H,30H
;	MOV 02H,#00H
;	MOV 10H,#05H
;	MOV 1FH,#0CH
;	MOV 1EH,#0AH
;	LCALL PRM
;	LCALL PRR
;	LCALL PR
;	MOV R0,29H
;	MOV 05H,@R0
;	INC R0
;	MOV 06H,@R0
;	INC R0
;	MOV 07H,@R0
;	INC R0
;	MOV 29H,R0
;	MOV 04H,#00H
;	MOV 03H,#00H
;	MOV 02H,#00H
;	MOV 1FH,#03H
;	MOV 10H,#06H
;	LCALL PRM
;	LCALL PRR
;	LCALL PR
;	MOV R0,28H
;	MOV 06H,@R0
;	INC R0
;	MOV 07H,@R0
;	INC R0
;	MOV 28H,R0
;	MOV 05H,#00H
;	MOV 04H,#00H
;	MOV 03H,#00H
;	MOV 02H,#00H
;	MOV 1FH,#06
;	MOV 10H,#03H
;	LCALL PRM
;	LCALL PRR
;	LCALL PR
;	INC 30H
;	MOV A,#07H
;	XRL A,30H
;	JNZ DPR1



DPR:    MOV 30H,#01H	;打印参数
	MOV 2AH,#4DH
	MOV 29H,#3BH
	MOV 28H,#59H
;        MOV 27H,#0C4H
         MOV 26H,#0C4H
;	MOV R1,#0BBH
DPR1:MOV R1,#0BBH
	MOV A,30H
	MOV @R1,A
	INC R1
   MOV R0,2AH
	MOV A,@R0
	MOV @R1,A
	INC R0
	INC R1
	MOV A,@R0
	MOV @R1,A
	INC R0
	INC R1
	MOV 2AH,R0

	MOV R0,29H
	MOV A,@R0
       orl a,#0f0h        ;当量第一位加”F“，打印时跳过
	MOV @R1,A
	INC R0
	INC R1
	MOV A,@R0
	MOV @R1,A
	INC R0
	INC R1
	MOV A,@R0
	MOV @R1,A
	INC R0
	INC R1
	MOV 29H,R0

	MOV R0,28H
	MOV A,@R0
	MOV @R1,A
	INC R1
	INC R0
	MOV A,@R0
	MOV @R1,A
	INC R0
	INC R1
	MOV 28H,R0

	MOV R0,26H;COM;27H
	MOV A,@R0
	MOV @R1,A
	INC R1
	INC R0
	MOV A,@R0
	MOV @R1,A
	INC R0
	INC R1
	MOV 26H,R0;27H,R0

MOV DPTR,#PCS
MOV R1,#0BBH
LCALL PRINT
lcall timl6
lcall timl6
MOV DPTR,#PPM1
LCALL PRINT
;lcall timl6
	INC 30H
	MOV A,#07H
	XRL A,30H
	JNZ DPR1
;        MOV R0,#0A4H
 ;       MOV A,@R0
  ;      MOV 07H,A
   ;     MOV 06H,#0
    ;    MOV 05H,#0
;	MOV 04H,#00H
;	MOV 03H,#00H
;	MOV 02H,#00H
;	MOV 1FH,#08H
;	MOV 10H,#0H
;	LCALL PRM
;	LCALL PRR
;	LCALL PR
 ;       LCALL MPEP
;MOV R0,#0A4H
;MOV R1,#0BBH
;MOV A,@R0
;MOV @R1,A
;MOV DPTR,#PYS
;LCALL PRINT
          lcall timgk
          lcall timgk
             MOV         EE240X_AD,#1H      ;设器件的三位可编程地址
           MOV         EE240X_SUBA,#65;65;16  ;读单价
          MOV         EE240X_NUMBYT,#12;8
          MOV         EE240X_RDA,#0C4H
          LCALL       EE240x_RDNBYT
          lcall timl
          lcall timl
          lcall timl

;       MOV R0,#0c4H
;       MOV DPTR,#FLASH_dj1_ADDRESS     ; 单价
;       MOV R2,#12
;       LCALL FLASH_READ
 ;         lcall timgk
  ;        lcall timgk

;REDJP:	MOV R0,#0C4H	;读单价 (从48T86中读出）     ;不重读单价第一路就出错！怪;
;	MOV 72H,#31
;	MOV R1,#12
;RCSdP:	MOV TIME_ADDR,72H
 ;        LCALL RTC_READ
  ;      MOV A,TIME_DATA
;	 MOV @R0,A
 ;        INC R0
  ;       INC 72H
   ;      DJNZ R1,RCSdP
          lcall timgk
          lcall timgk
          lcall timgk
       ;   lcall timgk
LCALL PTD	;打印时间
;lcall timl6
MOV DPTR,#PPM
LCALL PRINT
	SETB 14H
ljmp mn0
;	RET

MPEP:   MOV 1FH,#0AH
	MOV 1EH,#0AH
	MOV 1DH,#10H
	LCALL PR
	LCALL PR
	LCALL PR
	LCALL PR
	LCALL PR
	RET
mpep1:  mov 1fh,#0ah
	mov 1eh,#0ah
	mov 1dh,#10h
	lcall pr
	ret
PRDATE:MOV 1FH,#0AH
         MOV 1EH,#0AH
         MOV 07H,#0AAH    ;打印时间
         MOV TIME_ADDR,#02H
	 LCALL RTC_READ
	 MOV 06H,TIME_DATA
	 MOV TIME_ADDR,#04H
	 LCALL RTC_READ
	 MOV 05H,TIME_DATA
	 MOV 04H,#0AAH
	 MOV 03H,#0AAH
	 MOV 02H,#0AAH
	 MOV 10H,#05H
	 LCALL PRM
	 LCALL PRR
         LCALL PR
         MOV 07H,#0AAH  	  ;打印日期
         MOV TIME_ADDR,#07H
         LCALL RTC_READ
         MOV 06H,TIME_DATA
         MOV TIME_ADDR,#08H
         LCALL RTC_READ
         MOV 05H,TIME_DATA
         MOV TIME_ADDR,#09H
         LCALL RTC_READ
         MOV 04H,TIME_DATA
         MOV 03H,#20H
         MOV 02H,#0AAH
         MOV 10H,#00H
         LCALL PRM
         LCALL PRR
         LCALL PR
        SETB 14H
	LCALL MPEP
            RET

PRS1NO: RET
PRS1:   MOV R3,#00H
;	SETB TR1
MOV 2eH,#0FFH
ZS:     MOV 2FH,#90
ZSY:	MOV C,PR11
	JC ZSS
	DJNZ 2FH,ZSY
	DJNZ 2EH,ZS
	LJMP PRS1NO
ZSS:MOV 2EH,#0FFH
ZT:     MOV 2FH,#90
ZTY:MOV C,PR11
	JNC ZTT
	DJNZ 2FH,ZTY
	DJNZ 2EH,ZT
LJMP PRS1NO
ZTT:MOV 2EH,#0FFH
PT:     MOV 2FH,#90
PTY:	MOV C,PR10
	JC PTT
	DJNZ 2FH,PTY
	DJNZ 2EH,PT
	LJMP PRS1NO
PTT:	MOV A,R3
	XRL A,R2
	JZ P40
	INC R3
	MOV 2EH,#0FFH
Y3:	MOV 2FH,#90
Y3Y:    MOV C,PR10
	JNC Y33
	DJNZ 2FH,Y3Y
	DJNZ 2EH,Y3
	LJMP PRS1NO
Y33:    LJMP ZTT;PT
P40:     CLR C
	MOV PR13,C
	MOV R7,#02H
	LCALL TIM1
PRNO:   RET

PR:     JB 18H,PRNO             ;打印子程序
	CLR C
	MOV PR12,C
	MOV R7,#1FH
	LCALL TIM1
	MOV R0,#1FH
PR2:    MOV A,@R0
	MOV R2,A
	DEC R0
	MOV A,@R0
	XRL A,#10H
	JNZ PR1
	LCALL PRS1
	LCALL TIML
	LCALL TIML
	SETB PR13
	SETB PR12
	LCALL TIML
  	RET
PR1:    LCALL PRS1
	SETB PR13
	LJMP PR2
PRM:    MOV R0,#02H
	MOV R1,#12H
PRM1:   MOV A,@R0
	ANL A,#0F0H
	SWAP A
	MOV @R1,A
	MOV A,@R0
	ANL A,#0FH
	INC R1
	MOV @R1,A
	INC R1
	INC R0
	MOV A,R0
	XRL A,#08H
	JNZ PRM1
	RET
PRR:    MOV A,10H
	JZ PRR2
	MOV R1,#1DH
PRR7:   DJNZ 10H,PRR6
	MOV A,#0CH
PRR1:   XCH A,@R1
	DEC R1
	MOV B,A
	MOV A,#11H
	XRL A,R1
	JZ PRR2
	MOV A,B
	lJMP PRR1
PRR2:   MOV R1,#12H
PRR3:   MOV A,@R1
	JNZ PRR4
	MOV @R1,#0AH
	INC R1
	MOV A,#37H
	XRL A,R1
	JNZ PRR3
PRR4:   MOV A,@R1
	XRL A,#0CH
	JNZ PRR5
	DEC R1
	MOV @R1,#00H
PRR5:   DEC R1
	MOV @R1,#10H
	RET
PRR6:   DEC R1
	LJMP PRR7


RTC_READ:SETB AS
NOP
NOP
NOP
         MOV A,TIME_ADDR
         MOV P0,A
CLR RTC_E
NOP
NOP
NOP
NOP
NOP
         CLR AS
NOP
NOP
NOP
NOP
NOP
NOP
NOP

 ;        MOV DPTR,#4006H
 ;        MOVX A,@DPTR
 MOV P0,#0FFH
NOP
NOP
NOP
NOP
NOP
NOP
MOV R0,#06H
MOVX A,@R0
NOP
NOP
NOP
NOP
         MOV TIME_DATA,A
					NOP
					SETB RTC_E
					NOP
					NOP
					NOP
					setb as
MOV P0,#0FFH
         RET
RTC_WRITE:SETB AS
NOP
NOP
NOP
CLR RTC_E
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
          MOV A,TIME_ADDR
          MOV P0,A
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
          CLR AS
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
          MOV A,TIME_DATA
;          MOV DPTR,#4006H
;          MOVX @DPTR,A
MOV R0,#06H
MOVX @R0,A
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
NOP
					SETB RTC_E
					NOP
					NOP
					SETB AS
					NOP
					NOP
NOP
NOP
NOP
MOV P0,#0FFH
          RET
;---------------------------------------------------------------------------------------------------
;设置DS1302初始时间,并启动计时
SET1302_RQ:
        CLR     T_RST
        nop
        NOP
        NOP
        nop
       nop
        NOP
        NOP
        nop
       nop
        NOP
        NOP
        nop
        CLR     T_CLK
        nop
        NOP
        NOP
        nop
       nop
        NOP
        NOP
        nop
       nop
        NOP
        NOP
        nop
        SETB    T_RST
        nop
        nop
       nop
        NOP
        NOP
        nop
       nop
        NOP
        NOP
        nop
 ;       mov B,#90h
 ;       LCALL   INPUTBYTE
 ;       mov B,#0a6h
 ;       LCALL   INPUTBYTE
 ;       nop
 ;       nop
 ;      nop
 ;       NOP
 ;       NOP
 ;       nop
 ;      nop
 ;       NOP
 ;       NOP
 ;       nop

        MOV     B,#8EH          ;写控制命令字
        LCALL   INPUTBYTE
        MOV     B,#00H          ;写保护关闭
        LCALL   INPUTBYTE
        SETB    T_CLK
        nop
        NOP
        NOP
        nop
       nop
        NOP
        NOP
        nop
       nop
        NOP
        NOP
        nop
        CLR     T_RST



;        MOV     R0,#DAY      ;内存中的时间首地址
        MOV     R1,#86H         ;DS1302中的时间首地址
        MOV     R7,#2           ;字节数 ;设置日、月
SETLOOP:
        CLR     T_RST
        nop
        NOP
        NOP
        nop
       nop
        NOP
        NOP
        nop
       nop
        NOP
        NOP
        nop
        CLR     T_CLK
        nop
        NOP
        NOP
        nop
       nop
        NOP
        NOP
        nop
       nop
        NOP
        NOP
        nop
        SETB    T_RST
        nop
        NOP
        NOP
        nop
       nop
        NOP
        NOP
        nop
       nop
        NOP
        NOP
        nop
        MOV     B,R1            ;写命令字
        LCALL   INPUTBYTE
        MOV     A,@R0           ;设置时间
        MOV     B,A
        LCALL   INPUTBYTE
        dec     R0
        INC     R1
        INC     R1
        SETB    T_CLK
        nop
        NOP
        NOP
        nop
       nop
        NOP
        NOP
        nop
       nop
        NOP
        NOP
        nop
        CLR     T_RST
        nop
        NOP
        NOP
        nop
       nop
        NOP
        NOP
        nop
       nop
        NOP
        NOP
        nop
        DJNZ    R7,SETLOOP

;       INC     R0
        INC     R1       ;设置年
        INC     R1
        CLR     T_RST
        nop
        NOP
        NOP
        nop
       nop
        NOP
        NOP
        nop
       nop
        NOP
        NOP
        nop
        CLR     T_CLK
        nop
        NOP
        NOP
        nop
       nop
        NOP
        NOP
        nop
       nop
        NOP
        NOP
        nop
        SETB    T_RST
        nop
        NOP
        NOP
        nop
       nop
        NOP
        NOP
        nop
       nop
        NOP
        NOP
        nop
        MOV     B,R1            ;写命令字
        LCALL   INPUTBYTE
        MOV     A,@R0           ;设置时间
        MOV     B,A
        LCALL   INPUTBYTE
        CLR     T_RST
        nop
        NOP
        NOP
        nop
       nop
        NOP
        NOP
        nop
       nop
        NOP
        NOP
        nop
        CLR     T_CLK
        nop
        NOP
        NOP
        nop
       nop
        NOP
        NOP
        nop
       nop
        NOP
        NOP
        nop
        SETB    T_RST
        nop
        NOP
        NOP
        nop
       nop
        NOP
        NOP
        nop
       nop
        NOP
        NOP
        nop
       MOV     B,#90H
        LCALL   INPUTBYTE
        MOV     B,#0a4H          ;开写保护
        LCALL   INPUTBYTE
      nop
        NOP
        NOP
        nop
       nop
        NOP
        NOP
        nop
             nop
        NOP
        NOP
        nop
       nop
        NOP
        NOP
        nop

        MOV     B,#8EH
        LCALL   INPUTBYTE
        MOV     B,#80H          ;开写保护
        LCALL   INPUTBYTE
        SETB    T_CLK
        nop
        NOP
        NOP
        nop
       nop
        NOP
        NOP
        nop
       nop
        NOP
        NOP
        nop
        CLR     T_RST
        nop
        NOP
        NOP
        nop
       nop
        NOP
        NOP
        nop
       nop
        NOP
        NOP
        nop
        RET


SET1302_SJ:
        CLR     T_RST
        nop
        NOP
        NOP
        nop
       nop
        NOP
        NOP
        nop
       nop
        NOP
        NOP
        nop
        CLR     T_CLK
        nop
        NOP
        NOP
        nop
       nop
        NOP
        NOP
        nop
       nop
        NOP
        NOP
        nop
        SETB    T_RST
        nop
        NOP
        NOP
        nop
       nop
        NOP
        NOP
        nop
       nop
        NOP
        NOP
        nop
;        MOV     B,#90H          ;写控制命令字
;        LCALL   INPUTBYTE
;        MOV     B,#0A6H          ;写保护关闭
;        LCALL   INPUTBYTE
;        nop
;        NOP
;        NOP
;        nop
;       nop
;        NOP
;        NOP
;        nop

        MOV     B,#8EH          ;写控制命令字
        LCALL   INPUTBYTE
        MOV     B,#00H          ;写保护关闭
        LCALL   INPUTBYTE
        SETB    T_CLK
        nop
        NOP
        NOP
        nop
       nop
        NOP
        NOP
        nop
       nop
        NOP
        NOP
        nop
        CLR     T_RST

        MOV     R1,#80H         ;DS1302中的时间首地址
        CLR     T_RST
        nop
        NOP
        NOP
        nop
       nop
        NOP
        NOP
        nop
       nop
        NOP
        NOP
        nop
        CLR     T_CLK
        nop
        NOP
        NOP
        nop
       nop
        NOP
        NOP
        nop
       nop
        NOP
        NOP
        nop
        SETB    T_RST
        nop
        NOP
        NOP
        nop
       nop
        NOP
        NOP
        nop
       nop
        NOP
        NOP
        nop
        MOV     B,R1            ;写命令字
        LCALL   INPUTBYTE
        MOV     A,#0           ;设置时间
        MOV     B,A
        LCALL   INPUTBYTE
        nop
        NOP
        NOP
        nop
       nop
        NOP
        NOP
        nop
       nop
        NOP
        NOP
        nop
        SETB    T_CLK
        nop
        NOP
        NOP
        nop
       nop
        NOP
        NOP
        nop
       nop
        NOP
        NOP
        nop
        CLR     T_RST
        nop
        NOP
        NOP
        nop
       nop
        NOP
        NOP
        nop
       nop
        NOP
        NOP
        nop


  ;      MOV     R0,#MINUTE      ;内存中的时间首地址
        MOV     R1,#82H         ;DS1302中的时间首地址
        MOV     R7,#2           ;字节数 ;设置分 时



SETLOOP2:
        CLR     T_RST
        nop
        NOP
        NOP
        nop
       nop
        NOP
        NOP
        nop
       nop
        NOP
        NOP
        nop
        CLR     T_CLK
        nop
        NOP
        NOP
        nop
       nop
        NOP
        NOP
        nop
       nop
        NOP
        NOP
        nop
        SETB    T_RST
        nop
        NOP
        NOP
        nop
       nop
        NOP
        NOP
        nop
       nop
        NOP
        NOP
        nop
        MOV     B,R1            ;写命令字
        LCALL   INPUTBYTE
        MOV     A,@R0           ;设置时间
        MOV     B,A
        LCALL   INPUTBYTE
        dec     R0
        INC     R1
        INC     R1
        SETB    T_CLK
        nop
        NOP
        NOP
        nop
       nop
        NOP
        NOP
        nop
       nop
        NOP
        NOP
        nop
        CLR     T_RST
        nop
        NOP
        NOP
        nop
       nop
        NOP
        NOP
        nop
       nop
        NOP
        NOP
        nop
        DJNZ    R7,SETLOOP2

        SETB    T_CLK
        nop
        NOP
        NOP
        nop
       nop
        NOP
        NOP
        nop
       nop
        NOP
        NOP
        nop
        CLR     T_RST
        nop
        NOP
        NOP
        nop
       nop
        NOP
        NOP
        nop
       nop
        NOP
        NOP
        nop
       MOV     B,#90H
        LCALL   INPUTBYTE
        MOV     B,#0a4H          ;开写保护
        LCALL   INPUTBYTE
      nop
        NOP
        NOP
        nop
       nop
        NOP
        NOP
        nop
             nop
        NOP
        NOP
        nop
       nop
        NOP
        NOP
        nop
        MOV     B,#8EH
        LCALL   INPUTBYTE
        MOV     B,#80H          ;开写保护
        LCALL   INPUTBYTE
        SETB    T_CLK
        nop
        NOP
        NOP
        nop
       nop
        NOP
        NOP
        nop
       nop
        NOP
        NOP
        nop
        CLR     T_RST
        nop
        NOP
        NOP
        nop
       nop
        NOP
        NOP
        nop
       nop
        NOP
        NOP
        nop

       RET
;---------------------------------------------------------------------------------------------------
;从DS1302读取时间
GET1302_RQ:
;        MOV     R0,#DAY
        MOV     R1,#87H        ;DS1302中读时间的首地址
        MOV     R7,#2
GETLOOP1:
        CLR     T_RST
        nop
        NOP
        NOP
        nop
        nop
        NOP
        NOP
        nop
        nop
        NOP
        NOP
        nop
        nop
        NOP
        NOP
        nop
        nop
        NOP
        NOP
        nop
        nop
        NOP
        NOP
        nop

        CLR     T_CLK
        nop
        NOP
        NOP
        nop
        nop
        NOP
        NOP
        nop
        nop
        NOP
        NOP
        nop
        nop
        NOP
        NOP
        nop
        nop
        NOP
        NOP
        nop
        nop
        NOP
        NOP
        nop

        SETB    T_RST
        nop
        NOP
        NOP
        nop
        nop
        NOP
        NOP
        nop
        nop
        NOP
        NOP
        nop
        nop
        NOP
        NOP
        nop
        nop
        NOP
        NOP
        nop
        nop
        NOP
        NOP
        nop

        MOV     B,R1
        LCALL   INPUTBYTE       ;写命令字
        LCALL   OUTPUTBYTE      ;读时间
        MOV     @R0,A           ;将从DS1302中读取的时间从内存中保存
        DEC     R0              ;修改地址指针
        INC     R1
        INC     R1
        SETB    T_CLK
        nop
        nop
        NOP
        NOP
        nop
        NOP
        NOP
        nop
        nop
        NOP
        NOP
        nop
        nop
        NOP
        NOP
        nop
        nop
        NOP
        NOP
        nop
        nop
        NOP
        NOP
        nop

        CLR     T_RST
        nop
        NOP
        NOP
        nop
        nop
        NOP
        NOP
        nop
        nop
        NOP
        NOP
        nop
        nop
        NOP
        NOP
        nop
        nop
        NOP
        NOP
        nop
        nop
        NOP
        NOP
        nop
        DJNZ    R7,GETLOOP1L
      ljmp gettz
GETLOOP1L:LJMP GETLOOP1
       ; DEC R0
GETTZ:        INC     R1
        INC     R1
        CLR     T_RST
        nop
        NOP
        NOP
        nop
        nop
        NOP
        NOP
        nop
        nop
        NOP
        NOP
        nop
        nop
        NOP
        NOP
        nop
        nop
        NOP
        NOP
        nop
        nop
        NOP
        NOP
        nop

        CLR     T_CLK
        nop
        NOP
        NOP
        nop
        nop
        NOP
        NOP
        nop
        nop
        NOP
        NOP
        nop
        nop
        NOP
        NOP
        nop
        nop
        NOP
        NOP
        nop
        nop
        NOP
        NOP
        nop

        SETB    T_RST
        nop
        NOP
        NOP
        nop
        nop
        NOP
        NOP
        nop
        nop
        NOP
        NOP
        nop
        nop
        NOP
        NOP
        nop
        nop
        NOP
        NOP
        nop
        nop
        NOP
        NOP
        nop

        MOV     B,R1
        LCALL   INPUTBYTE       ;写命令字
        LCALL   OUTPUTBYTE      ;读时间
        MOV     @R0,A           ;将从DS1302中读取的时间从内存中保存
        SETB    T_CLK
        nop
        nop
        nop
        NOP
        NOP
        nop
        nop
        NOP
        NOP
        nop
        nop
        NOP
        NOP
        nop
        nop
        NOP
        NOP
        nop

        CLR     T_RST
        nop
        nop
        nop
        NOP
        NOP
        nop
        nop
        NOP
        NOP
        nop
        nop
        NOP
        NOP
        nop
        nop
        NOP
        NOP
        nop

        RET

GET1302_SJ:
 ;       MOV     R0,#SECOND
        MOV     R1,#81H        ;DS1302中读时间的首地址
        MOV     R7,#3
GETLOOP3:
        CLR     T_RST
        nop
        NOP
        NOP
        nop
        nop
        NOP
        NOP
        nop
        nop
        NOP
        NOP
        nop
        nop
        NOP
        NOP
        nop
        nop
        NOP
        NOP
        nop
        nop
        NOP
        NOP
        nop

        CLR     T_CLK
        nop
        NOP
        NOP
        nop
        nop
        NOP
        NOP
        nop
        nop
        NOP
        NOP
        nop
        nop
        NOP
        NOP
        nop
        nop
        NOP
        NOP
        nop
        nop
        NOP
        NOP
        nop

        SETB    T_RST
        nop
        NOP
        NOP
        nop
        nop
        NOP
        NOP
        nop
        nop
        NOP
        NOP
        nop
        nop
        NOP
        NOP
        nop
        nop
        NOP
        NOP
        nop
        nop
        NOP
        NOP
        nop

        MOV     B,R1
        LCALL   INPUTBYTE       ;写命令字
        LCALL   OUTPUTBYTE      ;读时间
        MOV     @R0,A           ;将从DS1302中读取的时间从内存中保存
        dec     R0              ;修改地址指针
        INC     R1
        INC     R1
        SETB    T_CLK
        nop
        NOP
        NOP
        nop
        nop
        NOP
        NOP
        nop
        nop
        NOP
        NOP
        nop
        nop
        NOP
        NOP
        nop
        nop
        NOP
        NOP
        nop
        nop
        NOP
        NOP
        nop

        CLR     T_RST
        nop
        NOP
        NOP
        nop
        nop
        NOP
        NOP
        nop
        nop
        NOP
        NOP
        nop
        nop
        NOP
        NOP
        nop
        nop
        NOP
        NOP
        nop
        nop
        NOP
        NOP
        nop

        DJNZ    R7,GETLOOP3l

        RET

GETLOOP3L:LJMP GETLOOP3
;---------------------------------------------------------------------------------------------------
;向DS1302写一个字节
INPUTBYTE:
setb T_IO
       NOP
        NOP
        NOP
        NOP
        nop
        NOP
        NOP
        nop
        nop
        NOP
        NOP
        nop
        nop
        NOP
        NOP
        nop
        nop
        NOP
        NOP
        nop
        nop
        NOP
        NOP
        nop
        MOV     R4,#8
INPUTLOOP:

        MOV     A,B
        RRC     A
        MOV     B,A
        MOV     T_IO,C
        SETB    T_CLK
        NOP
        NOP
        NOP
        NOP
        nop
        NOP
        NOP
        nop
        nop
        NOP
        NOP
        nop
        nop
        NOP
        NOP
        nop
        nop
        NOP
        NOP
        nop
        nop
        NOP
        NOP
        nop

        ;NOP
        CLR     T_CLK
        DJNZ    R4,INPUTLOOP
        RET
;---------------------------------------------------------------------------------------------------
;从DS1302读一个字节
OUTPUTBYTE:
        clr     a
        clr     c
        MOV     R4,#8
OUTPUTLOOP:

        NOP
        NOP
        nop
        NOP
        NOP
        nop
        nop
        NOP
        NOP
        nop
        nop
        NOP
        NOP
        nop
        nop
        NOP
        NOP
        nop

        ;NOP
        MOV     C,T_IO
        RRC     A
        SETB    T_CLK
        NOP
        NOP
        NOP
        NOP
        nop
        NOP
        NOP
        nop
        nop
        NOP
        NOP
        nop
        nop
        NOP
        NOP
        nop
        nop
        NOP
        NOP
        nop
        nop
        NOP
        NOP
        nop

;NOP
        CLR     T_CLK
        DJNZ    R4,OUTPUTLOOP
        RET
;RTC_READ:SETB AS
;         MOV A,TIME_ADDR
;         MOV P0,A
;         CLR AS
;         MOV DPTR,#4006H
;         MOVX A,@DPTR
;         MOV TIME_DATA,A
;         RET
;RTC_WRITE:SETB AS
;          MOV A,TIME_ADDR
 ;         MOV P0,A
;          CLR AS
;          MOV A,TIME_DATA
;          MOV DPTR,#4006H
;          MOVX @DPTR,A
;          RET
;DATE_TIME:NOP
;TIME_DATE1: SETB 1DH
;	MOV TIME_ADDR,#0
;         LCALL RTC_READ
 ;        MOV A,TIME_DATA
;	 MOV 1CH,A
;	MOV TIME_ADDR,#2
 ;       LCALL RTC_READ
  ;      MOV A,TIME_DATA
;	MOV 1BH,A
;	MOV TIME_ADDR,#4
;	LCALL RTC_READ
 ;       MOV A,TIME_DATA
;	MOV 1AH,A
;	LCALL DISPNUM
;	LCALL TIML6
;	LCALL TIML6
;	LCALL TIML6
;	LCALL TIML6
;	MOV TIME_ADDR,#7
 ;       LCALL RTC_READ
  ;      MOV A,TIME_DATA
;	MOV 1CH,A
;	MOV TIME_ADDR,#8
 ;       LCALL RTC_READ
 ;       MOV A,TIME_DATA
;	MOV 1BH,A
;	MOV TIME_ADDR,#9
 ;       LCALL RTC_READ
 ;       MOV A,TIME_DATA
;	MOV 1AH,A
;	LCALL DISPNUM
;	LCALL TIML6
;	LCALL TIML6
;	CLR 1DH
;	CLR 0FH
;	MOV 1FH,#00H
;	MOV 1EH,#00H
;	MOV 1DH,#00H
;	LJMP MN0
TIME_EDIT:LJMP TI_WR
MOV R0,#6AH   ;读8031时间
	MOV 72H,#66
	MOV R1,#3
RCS8:	MOV TIME_ADDR,72H
         LCALL RTC_READ
        MOV A,TIME_DATA
	 MOV @R0,A
         INC R0
         INC 72H
         DJNZ R1,RCS8
;	LCALL RD1
	MOV A,6AH
	xrl a,#99h
	jz ti_wr
;		CJNE A,#99H,TI_WR
	CLR 02H
	CLR 2FH
	CLR 28H
	CLR 24H
;MOV DPTR,#MAIN_B;#BXS
;LCALL ZBXS
	LJMP ALAR
TI_WR:	JNB 0FH,TD_ERROR

mov r0,#34h
lcall Set1302_sj

;          MOV TIME_ADDR,#04H	;写小时
;          MOV TIME_DATA,33H
;          LCALL RTC_WRITE
;          MOV TIME_ADDR,#02H	;写分钟
;          MOV TIME_DATA,34H
;          LCALL RTC_WRITE
;          MOV TIME_ADDR,#0H	;写秒
;          MOV TIME_DATA,1FH
;          LCALL RTC_WRITE
	LCALL SON
          CLR 0FH
;MOV DPTR,#BGSJ
;LCALL ZBXS
MOV 35H,#0
MOV 34H,#0
MOV 33H,#0
MOV 32H,#0
MOV 31H,#0
        LJMP MN0
TD_ERROR:LJMP ALAR

;ZBXS:MOV COM,#01H
;LCALL WRI
;LCALL   DELADY
;LCALL HZBXS
;RET
LUHAO_DISP: MOV R0,#0ACH  ;选1路还是2路
            MOV A,@R0
         XRL A,#39H
          JNZ LUHAO_DISP1
         MOV 31H,#2
         LJMP MN0
LUHAO_DISP1:MOV 31H,#1
         LJMP MN0
ZHHUAN_ERROR:LJMP ALAR
ZHUANHUAN:JNB 0FH,LUHAO_DISP
          MOV A,39H
	CJNE A,#21H,ZHHUAN_ERROR
	MOV A,38H
	CJNE A,#43H,ZHHUAN_ERROR
        MOV R0,#0ACH  ;选1路还是2路
            MOV A,@R0
         XRL A,#39H
          JNZ XSBO11
         MOV A,#0
        MOV @R0,A
        MOV 72H,#58H       ;选KG
LCALL SEND_KGL
LCALL TIIL
        MOV 72H,#58H       ;选KG
LCALL SEND_KGL

;         SETB SEL_1OR2
;         mov 31h,#1
        LJMP WMEMO
XSBO11:MOV A,#39H
          MOV @R0,A
 ;         CLR SEL_1OR2
          MOV 72H,#96H       ;选L
LCALL SEND_KGL
LCALL TIIL
        MOV 72H,#96H       ;选L
LCALL SEND_KGL

;          MOV 31H,#2
WMEMO:   ;   MOV         EE240X_AD,#1H      ;设器件的三位可编程地址
         ;   MOV         EE240X_SUBA,#10   ;设器件子地址
         ;   MOV         EE240X_NUMBYT,#1  ;写1字节数据
         ;   MOV         EE240X_TDA,#0ACH     ;设发送缓冲区首址
         ;   LCALL       EE240X_WRNBYT    ;写入数据
         ;  lcall timgk
         ; lcall timgk
         ;  lcall timgk
         ; lcall timgk
;      MOV DPTR,#FLASH_KGL_ADDRESS
;       MOV R2,#1
;       MOV R0,#0ACH
;       LCALL FLASH_WRITE
MOV 72H,#C12887_KGL_ADDRESS
	MOV R1,#0ACH
   MOV TIME_ADDR,72h
          MOV TIME_DATA,@R1
          LCALL RTC_WRITE

          LCALL SON
          LJMP MN0
DATE_EDIT:LJMP DA_WR
MOV R0,#6AH   ;读8031时间
	MOV 72H,#66
	MOV R1,#3
RCS9:	MOV TIME_ADDR,72H
         LCALL RTC_READ
        MOV A,TIME_DATA
	 MOV @R0,A
         INC R0
         INC 72H
         DJNZ R1,RCS9
;	LCALL RD1
		MOV A,6AH
		xrl a,#99h
		jz da_wr
;		CJNE A,#99H,DA_WR
		CLR 02H
;MOV DPTR,#MAIN_B;#BXS
;LCALL ZBXS
	CLR 2EH
	CLR 28H
	CLR 24H
		LJMP ALAR
DA_ERROR:LJMP ALAR
DA_WR:  JNB 0FH,DA_ERROR
MOV R0,#34H
LCALL SET1302_RQ
;          MOV TIME_ADDR,#09H	;写年
;          MOV TIME_DATA,32H
;          LCALL RTC_WRITE
;          MOV TIME_ADDR,#08H	;写月
;          MOV TIME_DATA,33H
;          LCALL RTC_WRITE
;          MOV TIME_ADDR,#07H	;写日
;          MOV TIME_DATA,34H
;          LCALL RTC_WRITE
LCALL SON
          CLR 0FH
;MOV DPTR,#BGSJ
;LCALL ZBXS
MOV 35H,#0
MOV 34H,#0
MOV 33H,#0
MOV 32H,#0
MOV 31H,#0
;	RET
      LJMP MN0
RDT86:
WRT86:          MOV TIME_ADDR,#09H	;写年
          MOV TIME_DATA,33H
          LCALL RTC_WRITE

SON:	CLR P3.2
	MOV R7,#50H
SON1:   MOV R6,#0FFH
SON2:   NOP
;	NOP
	NOP
	DJNZ R6,SON2
	DJNZ R7,SON1
	SETB P3.2
	RET
;SSMO:MOV 69H,#1AH
;SSMO1:	MOV 72H,#13
;	MOV R0,#40H
;WMO:    MOV 73H,@R0
;	LCALL WRITE
;	INC 72H
;	INC R0
;        CJNE R0,#45H,WMO
;	DJNZ 69H,SSMO1
;	RET

;2004.11.19调通
;***********************EE240X.ASM****************************
;程序包功能:实现对EEPROM 240X或铁电存储器240X的多字节读写操作,包含子程序EE240X_WRNBYT,EE240X_RDNBYT,
;          EE240X_CRDNBYT.
;说明:1,本程序包适用的芯片有2401,2402,2404,2408,2416.
;     2,本程序适用于晶振频率为12MHZ,即单周期指令用时1us的模式,若晶振频率不
;       为12MHZ,则需相应地改变NOP指令的条数.
;     3,此程序调用了文件VI2C.ASM中的子程序.
;     4,使用该程序前,用户需定义下列各符号.

;***********************符号定义示例****************************
;           ;常量定义
;           VI2C_SDA	   EQU         P1.0 ;数据线
;           VI2C_SCL	   EQU	       P1.1 ;时钟线

;           ;变量定义
;           EE240X_AD  	   DATA        50H  ;存放器件的三位可编程地址或页地址(0-7)
;           EE240X_SUBA    DATA        51H  ;存放片内寻址字节
;           EE240X_NUMBYT  DATA        52H  ;存放传送的字节数
;           EE240X_TDA     DATA        53H  ;存放发送数据缓冲区首地址
;           EE240X_RDA     DATA        54H  ;存放接收数据缓冲区首地址

;***********************EE240X_WRNBYT*************************
;程序功能:本程序实现对EEPROM 240X或铁电存储器240X给定地址写入N字节数据.
;入口参数: EE240X_AD 存放器件的三位可编程地址或页地址(0-7),EE240X_TDA存放待发送数据缓冲区首址,
;         EE240X_NUMBYT存放待发送数据个数,EE240X_SUBA存放片内寻址字节.
;出口参数:C存放接收到的应答位或非应答位,0表示应答位,1表示非应答位或总线不可用(数据未正常写入).
;占用资源:A,PSW,R0,R1,R3.
;占用堆栈:最大2字节.
;占用标号:EE240X_WRNBYT,EE240X_WLOOP,EE240X_WABORT,VI2C_START,VI2C_ER1,VI2C_OK1,VI2C_STOP,
;        VI2C_TACK,VI2C_TNACK,VI2C_CACK,VI2C_WRBYT,VI2C_WLP.
;子程序调用:VI2C_START,VI2C_STOP,VI2C_CACK,VI2C_WRBYT.

EE240X_WRNBYT:
            MOV         R3,EE240X_NUMBYT ;R3存放待发送字节数
            CALL        VI2C_START       ;发开始信号
            JC          EE240X_WABORT    ;若总线不可用则中止
            MOV         A,EE240X_AD      ;将三位可编程地址或页地址送入累加器
            RL          A                ;左移一位对齐格式
            ORL         A,#0A0H          ;加上固定的高四位地址
            CLR         ACC.0            ;设定为写
            CALL        VI2C_WRBYT       ;发送写器件地址
            CALL        VI2C_CACK        ;检查应答位
            JC          EE240X_WABORT    ;若检测到非应答位则中止
            MOV         A,EE240X_SUBA    ;将片内寻址字节送入累加器
            CALL        VI2C_WRBYT       ;发送
            CALL        VI2C_CACK        ;检查应答位
            JC          EE240X_WABORT    ;若检测到非应答位则中止
            MOV         R1,EE240X_TDA    ;将待发送数据缓冲区首址送R1
EE240X_WLOOP:
            MOV         A,@R1            ;待发送数据送入累加器
            CALL        VI2C_WRBYT       ;发送N字节数据
            CALL        VI2C_CACK        ;检测应答位
            JC          EE240X_WABORT    ;若检测到非应答位则中止
            INC         R1               ;发送数据缓冲区指针调整
            DJNZ        R3,EE240X_WLOOP  ;是否发完?
            CLR         C                ;清错误标志位,正常写入
EE240X_WABORT:
            CALL        VI2C_STOP        ;发送停止位
            RET

;***********************EE240X_RDNBYT***********************
;程序功能:本程序实现从EEPROM 240X或铁电存储器240X给定地址中读出N字节数据.
;入口参数: EE240X_AD 存放器件的三位可编程地址或页地址(0-7),EE240X_RDA存放待接收数据缓冲区首址,
;         EE240X_NUMBYT存放待接收数据个数,EE240X_SUBA存放片内寻址字节.
;出口参数:接收到的数据存放在接收数据缓冲区中,C存放接收到的应答位或非应答位,0表示应答位,
;        1表示非应答位或总线不可用(数据未正常读出)
;占用资源:A,PSW,R0,R1,R3.
;占用堆栈:最大2字节.
;占用标号:EE240X_RDNBYT,EE240X_RLOOP,EE240X_RABORT,EE240X_TACK,VI2C_START,VI2C_ER1,VI2C_OK1,
;        VI2C_STOP,VI2C_TACK,VI2C_TNACK,VI2C_CACK,VI2C_WRBYT,VI2C_WLP,VI2C_RDBYT,VI2C_RLP.
;子程序调用:VI2C_START,VI2C_STOP,VEE240X_TACK,VI2C_TNACK,VI2C_CACK,VI2C_WRBYT,VI2C_RDBYT.

EE240X_RDNBYT:
            MOV         R3,EE240X_NUMBYT ;R3存放待接收字节数
            CALL        VI2C_START       ;发开始信号
            JC          EE240X_RABORT    ;若总线不可用则中止
            MOV         A,EE240X_AD      ;将三位可编程地址或页地址送入累加器
            RL          A                ;左移一位对齐格式
            ORL         A,#0A0H          ;加上固定的高四位地址
            CLR         ACC.0            ;设定为写
            CALL        VI2C_WRBYT       ;发送写器件地址
            CALL        VI2C_CACK        ;检查应答位
            JC          EE240X_RABORT    ;若检测到非应答位则中止
            MOV         A,EE240X_SUBA    ;将片内寻址字节送入累加器
            CALL        VI2C_WRBYT       ;发送
            CALL        VI2C_CACK        ;检查应答位
            JC          EE240X_RABORT    ;若检测到非应答位则中止
            CALL        VI2C_START       ;发开始信号
            JC          EE240X_RABORT    ;若总线不可用则中止
            MOV         A,EE240X_AD      ;将三位可编程地址或页地址送入累加器
            RL          A                ;左移一位对齐格式
            ORL         A,#0A0H          ;加上固定的高四位地址
            SETB        ACC.0            ;设定为读
            CALL        VI2C_WRBYT       ;发送读器件地址
            CALL        VI2C_CACK        ;检查应答位
            JC          EE240X_RABORT    ;若检测到非应答位则中止
            MOV         R1,EE240X_RDA    ;将待接收数据缓冲区首址送R1
EE240X_RLOOP:
            CALL        VI2C_RDBYT       ;接收1字节数据
            MOV         @R1,A            ;送入缓冲区
            DJNZ        R3,EE240X_TACK   ;是否接收完?
            CALL        VI2C_TNACK       ;发送非应答位
            CLR         C                ;清错误标志位,正常读出
EE240X_RABORT:
            CALL        VI2C_STOP        ;发送结束信号
            RET
EE240X_TACK:
            CALL        VI2C_TACK        ;发送应答位
            INC         R1               ;接收数据缓冲区指针调整
            JMP         EE240X_RLOOP

;***********************EE240X_CRDNBYT***********************
;程序功能:本程序实现从EEPROM 240X或铁电存储器240X当前地址中读出N字节数据.
;入口参数: EE240X_AD 存放器件的三位可编程地址或页地址(0-7),EE240X_RDA存放待接收数据缓冲区首址,
;         EE240X_NUMBYT存放待接收数据个数.
;出口参数:接收到的数据存放在接收数据缓冲区中,C存放接收到的应答位或非应答位,0表示应答位,
;        1表示非应答位或总线不可用(数据未正常读出)
;占用资源:A,PSW,R0,R1,R3.
;占用堆栈:最大2字节.
;占用标号:EE240X_CRDNBYT,EE240X_CRLOOP,EE240X_CRABORT,EE240X_CTACK,VI2C_START,VI2C_ER1,VI2C_OK1,
;        VI2C_STOP,VI2C_TACK,VI2C_TNACK,VI2C_CACK,VI2C_WRBYT,VI2C_WLP,VI2C_RDBYT,VI2C_RLP.
;子程序调用:VI2C_START,VI2C_STOP,VEE240X_TACK,VI2C_TNACK,VI2C_CACK,VI2C_WRBYT,VI2C_RDBYT.

EE240X_CRDNBYT:
            MOV         R3,EE240X_NUMBYT ;R3存放待接收字节数
            CALL        VI2C_START       ;发开始信号
            JC          EE240X_CRABORT   ;若总线不可用则中止
            MOV         A,EE240X_AD      ;将三位可编程地址或页地址送入累加器
            RL          A                ;左移一位对齐格式
            ORL         A,#0A0H          ;加上固定的高四位地址
            SETB        ACC.0            ;设定为读
            CALL        VI2C_WRBYT       ;发送读器件地址
            CALL        VI2C_CACK        ;检查应答位
            JC          EE240X_CRABORT   ;若检测到非应答位则中止
            MOV         R1,EE240X_RDA    ;将待接收数据缓冲区首址送R1
EE240X_CRLOOP:
            CALL        VI2C_RDBYT       ;接收1字节数据
            MOV         @R1,A            ;送入缓冲区
            DJNZ        R3,EE240X_CTACK  ;是否接收完?
            CALL        VI2C_TNACK       ;发送非应答位
            CLR         C                ;清错误标志位,正常读出
EE240X_CRABORT:
            CALL        VI2C_STOP        ;发送结束信号
            RET
EE240X_CTACK:
            CALL        VI2C_TACK        ;发送应答位
            INC         R1               ;接收数据缓冲区指针调整
            JMP         EE240X_CRLOOP


VI2C_START: SETB        VI2C_SDA
	        SETB        VI2C_SCL
            ;判断总线是否可用
            JNB         VI2C_SDA,VI2C_ER1 ;不为高则跳转
            JNB         VI2C_SCL,VI2C_ER1 ;不为高则跳转

                                         ;启动建立时间大于0.6us (start setup time)
            CLR         VI2C_SDA         ;保证启动保持时间大于0.6us (start hold time)
LCALL DEL_NOP
            CLR         VI2C_SCL
            CLR         C                ;清错误标志位(总线可用)
	        SJMP        VI2C_OK1
VI2C_ER1:   SETB        C                ;置错误标志位(总线不可用)
VI2C_OK1:   RET

VI2C_STOP: CLR         VI2C_SDA
LCALL DEL_NOP
           SETB        VI2C_SCL
LCALL DEL_NOP
           SETB        VI2C_SDA
           RET


VI2C_TACK: CLR         VI2C_SDA         ;发送应答位
LCALL DEL_NOP
           SETB        VI2C_SCL         ;产生一个时钟周期
LCALL DEL_NOP
           CLR         VI2C_SCL
           RET


VI2C_TNACK:SETB        VI2C_SDA         ;发送非应答位
LCALL DEL_NOP                                        ;以及数据建立时间大于100ns(data in setup time)
           SETB        VI2C_SCL         ;产生一个时钟周期
LCALL DEL_NOP
           CLR         VI2C_SCL
           RET


VI2C_CACK:  SETB        VI2C_SDA         ;置VI2C_SDA为输入方式
LCALL DEL_NOP
            SETB        VI2C_SCL
LCALL DEL_NOP

            MOV         C,VI2C_SDA       ;接收应答位
            CLR         VI2C_SCL         ;拉低时钟线
            RET

VI2C_WRBYT: MOV         R0,#08H          ;计8位
VI2C_WLP:   RLC         A
            MOV         VI2C_SDA,C
LCALL DEL_NOP
            SETB        VI2C_SCL         ;产生一个时钟周期
LCALL DEL_NOP                                         ;保证SCL高电平时间大于0.6us(clock pulse width high)
	        CLR         VI2C_SCL         ;拉低时钟线以便再次发送
            DJNZ        R0,VI2C_WLP      ;是否发完8位
            RET

VI2C_RDBYT: MOV         R0,#08H          ;计数8位
            SETB        VI2C_SDA         ;置1以便输入
VI2C_RLP:  LCALL DEL_NOP
           			                     ;以及保证tAA大于0.1us(clock low to data out valid)																	 ;以及数据建立时间大于100ns(data in setup time)
            SETB        VI2C_SCL         ;拉高时钟线,以便输入
                                         ;保证SCL高电平时间大于0.6us(clock pulse width high)
            MOV         C,VI2C_SDA
            RLC         A
            CLR         VI2C_SCL         ;拉低时钟线,以便发送器发送
            DJNZ        R0,VI2C_RLP
            RET

DELAYNMS:   MOV	R7,#0F9H                 ;1us
DELAYNMS_LOOP:
              NOP                          ;保证SCL低电平时间大于1.2us(clock pulse width low)
            NOP
            NOP
            NOP                             ;以及保证tAA大于0.1us(clock low to data out valid)            DJNZ	R7,DELAYNMS_LOOP     ;2us
            NOP
            NOP                          ;保证SCL低电平时间大于1.2us(clock pulse width low)
            NOP
            NOP
            NOP                             ;以及保证tAA大于0.1us(clock low to data out valid)
	        DJNZ	DELAYMS_NUM,DELAYNMS ;2us
	        RET
DEL_NOP:    MOV R7,#15
DEL_NOP1:            NOP
            DJNZ R7,DEL_NOP1                   ;保证SCL低电平时间大于1.2us(clock pulse width low)
RET

MIN0:    MOV DPTR,#B1
    MOV R1,#12
MIN:CLR A
MOVC A,@A+DPTR
LCALL PRINTB
INC DPTR
 DJNZ R1,MIN
 MOV A,#0DH
 LCALL PRINTB
 LCALL TIML6
 SJMP MIN0
RET
PRINTB:
NOP
NOP
JB BUSY,$
  CLR STB
  NOP

 mov r0,#05h
movx @r0,a
  NOP
;
  NOP
  NOP
  NOP
  NOP
  NOP
  NOP
  NOP
  NOP
  NOP
  NOP
  NOP
  SETB STB
     NOP
  NOP
  NOP
  NOP
;JB BUSY,$
   RET
BYTE_READ:    MOV ISP_CONTR,#ENABLE_ISP
              MOV ISP_CMD,#ISP_IAP_BYTE_READ
              MOV ISP_ADDRH,DPH
              MOV ISP_ADDRL,DPL
          ;    CLR EA
              MOV ISP_TRIG,#5AH
              MOV ISP_TRIG,#0A5H
              NOP
              MOV A,ISP_DATA
         ;     SETB EA
              LCALL ISP_DISABLE
              RET
BYTE_PROGRAM:    MOV ISP_CONTR,#ENABLE_ISP
              MOV ISP_CMD,#ISP_IAP_BYTE_PROGRAM
              MOV ISP_ADDRH,DPH
              MOV ISP_ADDRL,DPL
              MOV ISP_DATA,A
        ;      CLR EA
              MOV ISP_TRIG,#5AH
              MOV ISP_TRIG,#0A5H
              NOP
        ;      SETB EA
              LCALL ISP_DISABLE
              RET
SECTOR_ERASE: MOV ISP_CONTR,#ENABLE_ISP
              MOV ISP_CMD,#03H
              MOV ISP_ADDRH,DPH
              MOV ISP_ADDRL,DPL
        ;      CLR EA
              MOV ISP_TRIG,#5AH
              MOV ISP_TRIG,#0A5H
              NOP
        ;      SETB EA
              LCALL ISP_DISABLE
              RET
ISP_DISABLE: MOV ISP_CONTR,#0
              MOV ISP_CMD,#0
              MOV ISP_TRIG,#0
              MOV ISP_ADDRH,#0FFH
              MOV ISP_ADDRL,#0FFH
              RET
;r0-要写入的数据地址，R2-数据个数,DPTR:2800 OR 2A00 OR 2C00
FLASH_WRITE:		CLR EA;//禁止中断
                        LCALL SECTOR_ERASE;//擦除

;		MOV R0,#0A0H
;		MOV R2,#23H
WLSS:		MOV A,@R0
                LCALL BYTE_PROGRAM
		INC DPTR
		INC R0
		DJNZ R2,WLSS
                LCALL ISP_DISABLE
		SETB EA
		RET
;r0-要存入的数据地址，R2-数据个数,DPTR-2800 OR 2A00 OR 2C00
FLASH_READ:;MOV R0,#0A0H
       ;        MOV R2,#0
LRSS:;MOV A,R2
LCALL BYTE_READ
MOV @R0,A
INC DPTR
INC R0
DJNZ R2,LRSS
;INC R2

;MOV A,R2
;CJNE A,#23H,LRSS
                LCALL ISP_DISABLE

RET
lnopys:NOP
 NOP
 NOP
  NOP
 NOP
 NOP
ret
UART2_INIT:PUSH ACC
           MOV S2CON,#50H
           MOV BRT,#0ffh;#RELOAD_COUNT
           MOV AUXR,#11H ;#11h
           MOV IE2,#01H
           SETB EA
           POP ACC
           RET
SEND_UART_TWO:PUSH ACC
              MOV IE2,#0H
              MOV A,S2CON
              ANL A,#0FDH
              MOV S2CON,A
              MOV S2SBUF,11H
UART2_SEND_WAIT: MOV A,S2CON
                 ANL A,#02H
                 CJNE A,#02H,UART2_SEND_WAIT
                 MOV A,S2CON
                 ANL A,#0FDH
                 MOV S2CON,A
                 MOV IE2,#01H
                 POP ACC
                 RET
UART_TWO_INTERPUT_RECE:
                 PUSH ACC
                 MOV A,S2CON
                 ANL A,#01H
                 CJNE A,#01H,CLEAR_S2T1_RETI
                 MOV A,S2CON
                 ANL A,#0FEH
                 MOV S2CON,A
                 MOV 11H,S2SBUF
                 INC 11H
                 LCALL SEND_UART_TWO
                 POP ACC
                 RET
 CLEAR_S2T1_RETI: MOV A,S2CON
                 ANL A,#0FDH
                 MOV S2CON,A
                 POP ACC
                 RETI

RCS: ;       MOV R0,#28H
       ;MOV DPTR,#FLASH_ZHJLZ2_ADDRESS     ;
       ;MOV R2,#3
       ;LCALL FLASH_READ

        ;  lcall timgk
        ;  lcall timgk
;        MOV         EE240X_AD,#2H      ;设器件的三位可编程地址
;           MOV         EE240X_SUBA,#50;44  ;读
;          MOV         EE240X_NUMBYT,#5;4
;          MOV         EE240X_RDA,#76H
;          LCALL       EE240X_RDNBYT
lcall timl6
        MOV         EE240X_AD,#0H      ;设器件的三位可编程地址
           MOV         EE240X_SUBA,#0  ;读
          MOV         EE240X_NUMBYT,#8
          MOV         EE240X_RDA,#3BH
          LCALL       EE240x_RDNBYT
          lcall timl

         MOV         EE240X_AD,#0H      ;设器件的三位可编程地址
           MOV         EE240X_SUBA,#8  ;读
          MOV         EE240X_NUMBYT,#8
          MOV         EE240X_RDA,#43H
          LCALL       EE240x_RDNBYT
          lcall timl

         MOV         EE240X_AD,#0H      ;设器件的三位可编程地址
           MOV         EE240X_SUBA,#16  ;读
          MOV         EE240X_NUMBYT,#8
          MOV         EE240X_RDA,#4BH
          LCALL       EE240x_RDNBYT
          lcall timl
         MOV         EE240X_AD,#0H      ;设器件的三位可编程地址
           MOV         EE240X_SUBA,#24  ;读
          MOV         EE240X_NUMBYT,#8
          MOV         EE240X_RDA,#53H
          LCALL       EE240x_RDNBYT
          lcall timl
         MOV         EE240X_AD,#0H      ;设器件的三位可编程地址
           MOV         EE240X_SUBA,#32  ;读
          MOV         EE240X_NUMBYT,#10
          MOV         EE240X_RDA,#5BH
          LCALL       EE240x_RDNBYT
          lcall timl
;	LCALL RD1
;LCALL XYT86   ;加密效验，不对置1EH

;rpl:	MOV R0,#80H	;读累计 (从48T86中读出）
;	MOV 72H,#83
;	MOV R1,#36
;RCS4:	MOV TIME_ADDR,72H
;         LCALL RTC_READ
;        MOV A,TIME_DATA
;	 MOV @R0,A
;         INC R0
;         INC 72H
;         DJNZ R1,RCS4
;LJMP REDJ
;lcall pl1
;jmp $


         lcall timgk
          lcall timgk
 ;           MOV         EE240X_AD,#3H      ;设器件的三位可编程地址
 ;           MOV         EE240X_SUBA,#0  ;读总累计
 ;           MOV         EE240X_NUMBYT,#16  ;读2字节数据
 ;           MOV         EE240X_RDA,#80H     ;设接收缓冲区首址
 ;           LCALL       EE240X_RDNBYT    ;读出数据
 ;         lcall timgk
 ;         lcall timgk
 ;         lcall timgk
 ;         lcall timgk
  ;          MOV         EE240X_AD,#3H      ;设器件的三位可编程地址
  ;          MOV         EE240X_SUBA,#16  ;读总累计
  ;          MOV         EE240X_NUMBYT,#14  ;读2字节数据
  ;          MOV         EE240X_RDA,#90H     ;设接收缓冲区首址
  ;          LCALL       EE240X_RDNBYT    ;读出数据
  ;        lcall timgk
  ;        lcall timgk
  ;        lcall timgk
  ;        lcall timgk
  ;          MOV         EE240X_AD,#3H      ;设器件的三位可编程地址
  ;          MOV         EE240X_SUBA,#30  ;读总累计
  ;          MOV         EE240X_NUMBYT,#6  ;读2字节数据
  ;          MOV         EE240X_RDA,#9EH     ;设接收缓冲区首址
  ;          LCALL       EE240X_RDNBYT    ;读出数据
  ;        lcall timgk
  ;        lcall timgk
  ;        lcall timgk
  ;        lcall timgk
REDJ:            MOV         EE240X_AD,#1H      ;设器件的三位可编程地址
           MOV         EE240X_SUBA,#16  ;读单价
          MOV         EE240X_NUMBYT,#8
          MOV         EE240X_RDA,#0C4H
          LCALL       EE240x_RDNBYT
          lcall timl
      MOV         EE240X_AD,#1H      ;设器件的三位可编程地址
           MOV         EE240X_SUBA,#24  ;读单价
          MOV         EE240X_NUMBYT,#4
          MOV         EE240X_RDA,#0CcH
          LCALL       EE240x_RDNBYT
          lcall timl
    ;       MOV         EE240X_AD,#1H      ;设器件的三位可编程地址
    ;       MOV         EE240X_SUBA,#10  ;读
    ;      MOV         EE240X_NUMBYT,#1
    ;      MOV         EE240X_RDA,#0ACH
    ;      LCALL       EE240X_RDNBYT
    ;      lcall timgk
    ;      lcall timgk
    ;      lcall timgk
    ;      lcall timgk
;        MOV R0,#03BH
;       MOV DPTR,#FLASH_CS2_ADDRESS     ;
;       MOV R2,#42
;       LCALL FLASH_READ
;LCALL XYT86   ;加密效验，不对置1EH
         lcall timl

;       MOV R0,#080H
;       MOV DPTR,#FLASH_flj2_ADDRESS     ; 分累计
;       MOV R2,#36
;       LCALL FLASH_READ

         lcall timl
 ;     MOV R0,#09eH
  ;     MOV DPTR,#FLASH_zlj2_ADDRESS     ; 分累计
   ;    MOV R2,#6
    ;   LCALL FLASH_READ

   ;       lcall timgk
   ;       lcall timgk

  ;     MOV R0,#0c4H
  ;     MOV DPTR,#FLASH_dj2_ADDRESS     ; 单价
  ;     MOV R2,#12
  ;     LCALL FLASH_READ
  ;        lcall timgk
  ;        lcall timgk

 ;      MOV R0,#076H
 ;      MOV DPTR,#FLASH_JSDY2_ADDRESS     ; 读计数单元
 ;      MOV R2,#5
 ;      LCALL FLASH_READ
 ;        lcall timgk
 ;         lcall timgk

rcsover2:RET

;汉字表与TAI_P3秒停泵无汉显备2相同
 B1:DB 0B6H,0A8H,0C1H,0BFH,0B6H,0A8H,0C1H,0BFH,0B6H,0A8H,0C1H,0BFH,0B6H,0A8H,0C1H,0BFH
 PCS:DB 5	;打参数
DB 13,0,0C2H,0B7H,0C3H,0DCH,0B6H,0C8H,3AH,30H,2EH,0,0,0DH
DB 15,20H,20H,20H,20H,0B5H,0B1H,0C1H,0BFH,3AH,30h,2EH,0,0,0,0DH
DB 13,20H,20H,20H,20H,0D3H,0E0H,0C1H,0BFH,3AH,0,2EH,0,0DH
DB 13,20H,20H,20H,20H,0B5H,0A5H,0BCH,0DBH,3AH,0,2EH,0,0DH
DB 1,0AH
PYS:DB 2       ;打时间
DB 13,30H,36H,0C2H,0B7H,0D1H,0D3H,0CAH,0B1H,3AH,0,0C3H,0EBH,0DH
DB 1,0AH
PRLJT:DB 2     ;;打日累计头
DB 13,20,20H,20H,20H,20H,20H,0C8H,0D5H,0C0H,0DBH,0BCH,0C6H,0DH
DB 1,0AH
PZLJT:DB 2      ;;打总累计头
DB 13,20,20H,20H,20H,20H,20H,0D7H,0DCH,0C0H,0DBH,0BCH,0C6H,0DH
DB 1,0AH
PRLJ:DB 2	;打日累计
DB 11,0H,0C2H,0B7H,3AH,0,0,0,0,2EH,0,0DH
DB 2,0AH,0AH
PZLJ:DB 2	;打总累计
DB 10,20H,20H,0,0,0,0,0,2EH,0,0DH
DB 2,0AH,0AH
;YDWD:DB 0D3H,0A6H,0B4H,0F2H,3AH,20H,20H,20H,0D2H,0D1H,0B4H,0F2H,3AH,20H,20H,20H	;已打未打
;YD:DB 0CDH,0B0H,0CAH,0FDH,3AH,20H,20H,20H	;桶数
;WD:DB 0D2H,0D1H,0B4H,0F2H,3AH,20H,20H,20H	;未打
PSJ:DB 3	;打时间
DB 12,20H,20H,0,0CAH,0B1H,0,0B7H,0D6H,0,0C3H,0EBH,0DH
DB 12,20H,20H,0,0C4H,0EAH,0,0D4H,0C2H,0,0C8H,0D5H,0DH
DB 2,0AH,0AH

PDL:DB 1	;打定量
DB 16,0b5h,0A5H,0B4H,0CEH,0B6H,0A8H,0C1H,0BFH,3AH,0,0,0,0,2EH,0,0DH;,0ah,0ah
;DB 2,0AH,0AH
PJLZ:DB 3	;打计量值
DB 14,0c2h,0B7h,0BAH,0C5H,3AH,0,20H,0CDH,0B0H,0CAH,0FDH,3AH,0,0DH
DB 12,0B8H,0B6H,0D3H,0CDH,3AH,0,0,0,0,2EH,0,0DH
DB 2,0AH,0AH
PJLZ2:DB 3	;打计量值
;DB 14,0c2h,0B7h,0BAH,0C5H,3AH,0,20H,0CDH,0B0H,0CAH,0FDH,3AH,0,0DH
DB 11,0C9H,0E8H,0B6H,0A8H,0B4H,0CEH,0CAH,0FDH,3AH,0,0DH;设定次数：
db 11,0cah,0B5H,0B4H,0F2H,0B4H,0CEH,0CAH,0FDH,3AH,0,0DH;实打次数：
;DB 12,0d7h,0dch,0B8H,0B6H,3AH,0,0,0,0,2EH,0,0DH  ; 总付：
DB 2,0AH,0AH
PZFY:DB 1
DB 16,0d7h,0dch,0BCH,0C6H,0C1H,0BFH,0D6H,0B5H,3AH,0,0,0,0,2EH,0,0DH  ; 总计量值：

PDCJL:DB 1
DB 16,0b5h,0A5H,0B4H,0CEH,0BCH,0C6H,0C1H,0BFH,3AH,0,0,0,0,2EH,0,0DH;单次
PDJ:DB 2
DB 13,0b5h,0A5H,0bch,0dbh,3AH,20H,20H,20H,20H,0,2EH,0,0DH;单价
DB 2,0AH,0AH
PJE:DB 2
DB 16,0d7h,0dch,0bdh,0f0h,0b6h,0eeh,3AH,20h,20h,0,0,0,0,2EH,0,0DH;总金额
DB 2,0AH,0AH
PHG:DB 2
DB 29,0A9H,0A4H,0A9H,0A4H,0A9H,0A4H,0A9H,0A4H,0A9H,0A4H,0A9H,0A4H,0A9H,0A4H,0A9H,0A4H,0A9H,0A4H,0A9H,0A4H,0A9H,0A4H,0A9H,0A4H,0A9H,0A4H,0A9H,0A4H,0DH
DB 2,0AH,0AH
PHG2:DB 2
DB 13,2DH,2DH,2DH,2DH,2DH,2DH,2DH,2DH,2DH,2DH,2DH,2DH,0DH
DB 2,0AH,0AH

PDMC:DB 1        ;打脉冲
DB 9,0C2H,0F6H,0B3H,0E5H,3AH,0,0,0,0DH
ppm:DB 2          ;走纸
DB 2,20H,0AH
DB 2,20H,0AH
ppm1:DB 1          ;走纸
DB 2,20H,0AH
END

